// angular.module is a global place for creating, registering and retrieving Angular modules
// 'ifiske' is the name of this angular module (also set in a <body> attribute in index.html)
// the 2nd parameter is an array of 'requires'
// 'ifiske.controllers' is found in controllers.js

angular.module('ifiske', [
    'ionic',
    'ifiske.controllers',
    'ifiske.directives',
    'ifiske.api',
    'ifiske.db',
    'ifiske.utils',
    'ifiske.update',
    'ifiske.filters',
    'ionic.ion.headerShrink',
    'ngCordova',
    'systemBrowser',
    'ngCordovaSms',
    'ngMessages',
    'ImgCache',
    'leaflet-directive',
    'tabSlideBox'
])

.constant('$ionicLoadingConfig', {
    template: '<ion-spinner></ion-spinner>'
    // hideOnStateChange: true
})
.run(['$ionicPlatform', 'Update', 'ImgCache', function($ionicPlatform, Update, ImgCache) {
    $ionicPlatform.ready(function() {
        // Hide the accessory bar above the keyboard for form inputs
        if (window.ionic && window.ionic.Keyboard) {
            window.ionic.Keyboard.hideKeyboardAccessoryBar(true);
        }
        if (window.StatusBar) {
            // org.apache.cordova.statusbar required
            window.StatusBar.styleDefault();
        }

        ImgCache.$init();
        Update.update();
    });
}])

.config([
    '$stateProvider',
    '$urlRouterProvider',
    '$ionicConfigProvider',
    'ImgCacheProvider',
    function($stateProvider, $urlRouterProvider, $ionicConfigProvider, ImgCacheProvider) {

        ImgCacheProvider.setOptions({
            debug: false,
            usePersistentCache: true
        });
        ImgCacheProvider.manualInit = true;

        //Disable swipe to go back since it is bugged
        $ionicConfigProvider.views.swipeBackEnabled(false);

        // Cache views in the forward stack
        $ionicConfigProvider.views.forwardCache(true);

        // Clear back button default text
        $ionicConfigProvider.backButton.previousTitleText(false).text('');

        // Tabs position
        $ionicConfigProvider.tabs.position('bottom');

        /**
         * Ionic uses AngularUI Router. Learn more here:
         * https://github.com/angular-ui/ui-router
         */

        var defaultUrl = '/app/login';
        if (window.localStorage.getItem('session')) {
            defaultUrl = '/app/home';
        }
        $urlRouterProvider.otherwise(defaultUrl);

        $stateProvider

        .state('app', {
            url: '/app',
            //abstract: true,
            templateUrl: 'components/menu/menu.html',
            controller: 'MenuCtrl'
        })

        .state('app.login', {
            url: '/login',
            templateUrl: 'components/login/login.html',
            controller: 'LoginCtrl'
        })

        // Account recovery
        .state('app.recover', {
            url: '/recover',
            templateUrl: 'components/recover/recover.html',
            controller: 'RecoverCtrl'
        })
        .state('app.recover.lostpassword', {
            url: '/lostpassword',
            templateUrl: 'components/recover/lostpassword.html'
        })
        .state('app.recover.resetpassword', {
            url: '/resetpassword',
            templateUrl: 'components/recover/resetpassword.html'
        })

        // Account registration
        .state('app.register', {
            url: '/register',
            templateUrl: 'components/register/register.html',
            controller: 'RegisterCtrl'
        })
        .state('app.register.details', {
            url: '/details',
            templateUrl: 'components/register/register_details.html'
        })
        .state('app.register.verify', {
            url: '/verify',
            templateUrl: 'components/register/register_verify.html'
        })

        //
        .state('app.home', {
            url: '/home',
            templateUrl: 'components/home/home.html',
            controller: 'HomeCtrl'
        })
        .state('app.info', {
            url: '/info',
            templateUrl: 'components/info/info.html'
        })

        .state('app.bugs', {
            url: '/info',
            templateUrl: 'components/menu/report.html'
        })
        .state('app.contact', {
            url: '/contact',
            templateUrl: 'components/contact/contact.html',
            controller: 'ContactCtrl'
        })
        .state('app.legal', {
            url: '/legal',
            templateUrl: 'components/legal/legal.html',
            controller: 'LegalCtrl'
        })
        .state('app.about', {
            url: '/about',
            templateUrl: 'components/about/about.html',
            controller: 'AboutCtrl'
        })
        .state('app.userinfo', {
            url: '/userinfo',
            controller: 'UserCtrl',
            templateUrl: 'components/user/user.html',
        })
        .state('app.find_areas', {
            url: '/find_areas',
            views: {
                '@app': {
                    templateUrl: 'components/find_areas/tabs.html',
                },
                'counties@app.find_areas': {
                    templateUrl: 'components/find_areas/counties.html',
                    controller: 'CountiesCtrl'
                },
                'favorites@app.find_areas': {
                    templateUrl: 'components/find_areas/favorites.html',
                    controller: 'FavoritesCtrl'
                }
            }
        })
        .state('app.areas', {
            url: '/areas',
            params: {'id': false, 'county': false, 'search': ''},
            templateUrl: 'components/area_list/area_list.html',
            controller: 'AreasCtrl'
        })
        .state('app.cards', {
            url: '/cards',
            templateUrl: 'components/user_cards/user_cards.html',
            controller: 'UserCardsCtrl'
        })
        .state('app.favorites', {
            url: '/favorites',
            templateUrl: 'components/favorites/favorites.html'
        })
        .state('app.fishes', {
            url: '/fishes',
            templateUrl: 'components/fishes/fishes.html',
            controller: 'FishesCtrl'
        })
        .state('app.fishdetail', {
            url: '/fishdetail/:id',
            params: {'id': false, 'fish': false},
            templateUrl: 'components/fish_detail/fish_detail.html',
            controller: 'FishDetailCtrl'
        })
        .state('app.map', {
            url: '/map',
            templateUrl: 'components/map/map.html',
            controller: 'MapCtrl'
        })
        .state('app.techniques', {
            url: '/techniques',
            templateUrl: 'components/techniques/techniques.html',
            controller: 'TechniquesCtrl'
        })
        .state('app.techniquedetail', {
            url: '/techniquedetail/:id',
            params: {'id': false, 'tech': false},
            templateUrl: 'components/technique_detail/technique_detail.html',
            controller: 'TechniqueDetailCtrl'
        })
        .state('app.news', {
            url: '/news',
            templateUrl: 'components/news/news.html',
            controller: 'NewsCtrl'
        })
        .state('app.newsitem', {
            url: '/news/:id',
            params: {'item': false, 'id': false},
            templateUrl: 'components/news/newsitem.html',
            controller: 'NewsItemCtrl'
        })

        .state('app.area', {
            url: '/area/:id',
            views: {
                '@app': {
                    templateUrl: 'components/area/area.html',
                    controller: 'AreaCtrl',
                },
                'info@app.area': {
                    templateUrl: 'components/area/info.html',
                    controller: 'AreaInfoCtrl'
                },
                'map@app.area': {
                    templateUrl: 'components/area/map.html',
                    controller: 'AreaMapCtrl'
                },
                'fishinfo@app.area': {
                    templateUrl: 'components/area/fish.html',
                    controller: 'AreaFishCtrl'
                },
                'cards@app.area': {
                    templateUrl: 'components/area/cards.html',
                    controller: 'AreaCardsCtrl'
                }
            }
        });
    }]);

angular.module('ifiske.controllers', []);
angular.module('ifiske.directives', []);

angular.module('ifiske.controllers')
.controller('AboutCtrl', [
    '$scope',
    '$cordovaAppVersion',
    '$ionicPlatform',
    '$ionicModal',
    'Update',
    'Licenses',
    function($scope, $cordovaAppVersion, $ionicPlatform, $ionicModal, Update, Licenses) {
        $scope.version = $scope.dbDate = 'Okänt';
        $scope.update = Update;

        $ionicPlatform.ready(function() {
            if (window.cordova) {
                $cordovaAppVersion.getAppVersion().then(function(version) {
                    console.log('iFiske version:', version);
                    $scope.version = version;
                });
            }
            Licenses.get().then(function(data) {
                $scope.licenses = data.data;
            });
            $scope.alert = function(l) {
                var scope = $scope.$new();
                scope.l = l;
                $ionicModal.fromTemplateUrl(
                    'components/about/license_modal.html',
                    {scope: scope}
                ).then(function(modal) {
                    scope.closeModal = function() {
                        modal.hide();
                    };
                    modal.show();
                });

            };

        });
    }
]);

angular.module('ifiske.controllers')
.controller('AreaCardsCtrl', [
    '$scope',
    '$ionicModal',
    'localStorage',
    function($scope, $ionicModal, localStorage) {
        $scope.$on('$ionicView.beforeEnter', function() {
            //Area_Cards
            $scope.smsterms = localStorage.get('sms_terms');
            $scope.predicate = 'so';

            //SMS-modal
            $ionicModal.fromTemplateUrl('components/area/sms_modal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.sms_modal = modal;
            });
            $scope.openModal = function(product) {
                $scope.sms_modal.show();
                $scope.product = product;
            };
            $scope.closeModal = function() {
                $scope.sms_modal.hide();
            };
            $scope.showTerms = function() {
                $scope.showingterms = !$scope.showingterms;
            };
            $scope.showingterms = false;

            //Rules modal
            $ionicModal.fromTemplateUrl('components/area/rules_modal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.rules_modal = modal;
            });
            $scope.openRulesModal = function(product) {
                $scope.rules_modal.show();
                $scope.product = product;
            };
            $scope.closeRulesModal = function() {
                $scope.rules_modal.hide();
            };

            $scope.$on('$destroy', function() {
                $scope.sms_modal.remove();
                $scope.rules_modal.remove();
            });
        });
    }
]);

angular.module('ifiske.controllers')
.controller('AreaCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    '$ionicSlideBoxDelegate',
    function($scope, $stateParams, DB, $ionicSlideBoxDelegate) {
        $scope.image_endpoint = 'http://www.ifiske.se/';

        DB.getArea($stateParams.id)
        .then(function(area) {
            $scope.area = area;
            $scope.$broadcast('ifiske-area');

            area.images.then(function(images) {
                $scope.images = images;
            }, function(err) {
                console.error(err);
            });

            $ionicSlideBoxDelegate.$getByHandle('tabs').update();
            $ionicSlideBoxDelegate.$getByHandle('tabs').enableSlide(false);

            DB.getOrganization(area.orgid)
            .then(function(org) {
                $scope.org = org;
            });
        }, function(err) {
            console.log(err);
        });

        DB.getAreaFishes($stateParams.id)
        .then(function(fishes) {
            $scope.fishes = fishes;
            $ionicSlideBoxDelegate.$getByHandle('tabs').update();
        }, function(err) {
            console.log(err);
        });

        DB.getProductsByArea($stateParams.id)
        .then(function(products) {
            $scope.products = products;
            $ionicSlideBoxDelegate.$getByHandle('tabs').update();
        }, function(err) {
            console.log(err);
        });

    }
]);

angular.module('ifiske.controllers')
.controller('AreaFishCtrl', [
    '$scope',
    function($scope) {
        $scope.sortorder = '-amount';
        $scope.$on('$ionicView.beforeEnter', function() {
        });
    }
]);

angular.module('ifiske.controllers')
.controller('AreaInfoCtrl', [
    '$scope',
    '$ionicSlideBoxDelegate',
    'sessionData',
    '$ionicPopup',
    'Update',
    'API',
    'DB',
    '$ionicPlatform',
    '$cordovaToast',
    function($scope, $ionicSlideBoxDelegate, sessionData, $ionicPopup, Update, API, DB, $ionicPlatform, $cordovaToast) {
        $scope.gotoProducts = function() {
            $ionicSlideBoxDelegate.$getByHandle('tabs').slide(1);
        };
        $scope.$on('$ionicView.beforeEnter', function() {
        });

        $scope.changeFavorite = function() {
            if (sessionData.token) {
                $scope.area.favorite = !$scope.area.favorite;
                var promise;
                if ($scope.area.favorite) {
                    promise = API.user_add_favorite($scope.area.ID).then(function() {
                        Update.update();
                        $ionicPlatform.ready(function() {
                            $cordovaToast.show('Området är nu tillagt i dina favoriter', 'short', 'bottom');
                        });

                    });
                } else {
                    promise = API.user_remove_favorite($scope.area.ID).then(function() {
                        return DB.removeFavorite($scope.area.ID);
                    }).then(function() {
                        $ionicPlatform.ready(function() {
                            $cordovaToast.show('Området är nu borttaget från dina favoriter', 'short', 'bottom');
                        });
                    });
                }
                promise.catch(function(err) {
                    console.log(err);
                });
            } else {
                $ionicPopup.alert({
                    title: 'Du måste vara inloggad för att kunna ha favoriter',
                });
            }
        };
    }
]);

angular.module('ifiske.controllers')
.controller('AreaMapCtrl', [
    '$scope',
    'DB',
    'leafletEvents',
    '$ionicPlatform',
    '$cordovaGeolocation',
    '$cordovaDeviceOrientation',
    '$timeout',
    'localStorage',
    function($scope, DB, leafletEvents, $ionicPlatform, $cordovaGeolocation, $cordovaDeviceOrientation, $timeout, localStorage) {
        function updateMypos(obj) {
            //rotate iconAngle 45 deg since the icon is tilted by default
            obj.iconAngle = (obj.iconAngle | 0) - 45;
            // We need to create a new named element in order for the update to register
            if ($scope.map.markers.mypos2) {
                angular.extend($scope.map.markers.mypos2, obj);
                $scope.map.markers.mypos = $scope.map.markers.mypos2;
                delete $scope.map.markers.mypos2;
            } else {
                angular.extend($scope.map.markers.mypos, obj);
                $scope.map.markers.mypos2 = $scope.map.markers.mypos;
                delete $scope.map.markers.mypos;
            }
        }
        /* might need for ios
           function getMypos() {
           return $scope.map.markers.mypos || $scope.map.markers.mypos2;
           }
           */

        var icons = {};
        var mapboxUrl = 'http://api.tiles.mapbox.com/v4/{maptype}/{z}/{x}/{y}@2x.png?access_token={apikey}';
        var apikey = localStorage.get('mapbox_api');

        var updateMap = function() {
            $scope.map.center = {
                lat: $scope.area.lat,
                lng: $scope.area.lng,
                zoom: Number($scope.area.zoom) ? Number($scope.area.zoom) : 9
            };

            DB.getPoiTypes()
            .then(function(poi_types) {
                for (var i = 0; i < poi_types.length; ++i) {
                    var type = poi_types[i];
                    icons[type.ID] = {
                        iconUrl: $scope.image_endpoint + type.icon,
                        iconAnchor: [16, 37], // point of the icon which will correspond to marker's location
                        popupAnchor: [0, -35],
                    };
                }
                DB.getPois($scope.area.orgid)
                .then(function(pois) {
                    for (var i = 0; i < pois.length; ++i) {
                        var poi = pois[i];

                        $scope.map.markers['poi' + i] = {
                            layer: 'pois',
                            lat: poi.la,
                            lng: poi.lo,
                            icon: icons[poi.type],
                            message: '<h4>' + poi.t + '</h4><p>' + poi.d + '</p>',
                            popupOptions: {
                                maxWidth: window.innerWidth - 50
                            }
                        };
                    }
                    $scope.map.markers.area = {
                        layer: 'pois',
                        lat: $scope.area.lat,
                        lng: $scope.area.lng,
                        message: $scope.area.t
                    };
                }, function(err) {
                    console.error(err);
                });
                DB.getPolygons($scope.area.orgid)
                .then(function(polygons) {
                    $scope.map.paths = polygons.map(function(poly) {
                        return {
                            latlngs: JSON.parse('[' + poly.poly + ']'),
                            color: poly.c,
                            weight: 2,
                            opacity: 0.5,
                            fillColor: poly.c,
                            type: 'polygon'
                        };
                    });
                }, function(err) {
                    console.error(err);
                });

            });
        };
        angular.extend($scope, {
            map: {
                center: {},
                paths: {},

                markers: {
                    mypos: {
                        lat: 0,
                        lng: 0,
                        iconAngle: 0,
                        message: 'Egen position',
                        icon: {
                            type: 'div',
                            iconSize: [40,40],
                            iconAnchor: [20,20],
                            className: 'icon ion-navigate myposition'
                        }
                    }
                },

                layers: {
                    baselayers: {
                        outdoors: {
                            name: 'Utomhus',
                            type: 'xyz',
                            url: mapboxUrl,
                            layerOptions: {
                                maptype: 'mapbox.outdoors',
                                apikey: apikey
                            }
                        },
                        satellite: {
                            name: 'Satellit',
                            type: 'xyz',
                            url: mapboxUrl,
                            layerOptions: {
                                maptype: 'mapbox.satellite',
                                apikey: apikey
                            }
                        }
                    },
                    overlays: {
                        pois: {
                            name: 'Ställen',
                            type: 'markercluster',
                            visible: true,
                            layerParams: {
                                showOnSelector: false,
                                disableClusteringAtZoom: 9,
                                chunkedLoading: true,
                                showCoverageOnHover: false,
                                removeOutsideVisibleBounds: true
                            }
                        }
                    }
                }
            }
        });

        $scope.$on('$ionicView.beforeEnter', function() {
            if ($scope.area) {
                updateMap();
            }
            $scope.$on('ifiske-area', updateMap);

            $ionicPlatform.ready(function() {
                $cordovaGeolocation.watchPosition({
                    frequency: 3000
                }).then(null, function(error) {
                    console.error(error);
                }, function(pos) {
                    $timeout(function() {
                        updateMypos({
                            lat: pos.coords.latitude,
                            lng: pos.coords.longitude
                        });
                    });
                });

                $cordovaDeviceOrientation.watchHeading({
                    frequency: 3000
                }).then(null, function(error) {
                    console.error(error);
                }, function(heading) {
                    $timeout(function() {
                        updateMypos({
                            iconAngle: heading.trueHeading
                        });
                    });
                });
            });

            $scope.navigate = function() {
                //var pos = getMypos(); //might need for ios
                $ionicPlatform.ready(function() {
                    launchnavigator.navigate(
                        [$scope.navto.lat, $scope.navto.lng],
                        null,
                        function() {
                            console.log('Opening navigator');
                        },
                        function(error) {
                            alert('Navigation failed!', error);
                        });
                });
            };

            var enabledEvents = ['popupopen', 'popupclose'];
            $scope.events = {
                enabled: enabledEvents
            };

            $scope.$on('leafletDirectiveMarker.popupopen', function(event, args) {
                //show navtobutton
                $scope.navto = args.model;
            });

            $scope.$on('leafletDirectiveMarker.popupclose', function() {
                //hide navtobutton
                $scope.navto = null;
            });
        });
    }
]);

angular.module('ifiske.controllers')
.controller('AreasCtrl', [
    '$scope',
    '$stateParams',
    '$ionicScrollDelegate',
    'DB',
    function($scope, $stateParams, $ionicScrollDelegate, DB) {

        var copy = $stateParams.search;
        $scope.search = copy;
        $scope.county = $stateParams.county || 'Sökresultat';
        DB.search('', $stateParams.id)
        .then(function(data) {
            $scope.areas = data;
        }, function(err) {
            console.log(err);
        });
        $scope.clearSearch = function() {
            $scope.search = '';
        };
        $scope.scrollTop = function() {
            $ionicScrollDelegate.scrollTop();
        };

    }
]);


angular.module('ifiske.controllers')
.controller('ContactCtrl', ['$scope', '$state', 'localStorage', function($scope, $state, localStorage) {
        $scope.contactInfo = localStorage.get('contactInfo');
}]);

angular.module('ifiske.controllers')
.controller('CountiesCtrl', ['$scope', 'DB', function($scope, DB) {
    DB.getCounties()
    .then(function(data) {
        $scope.counties = data;
    }, function(err) {
        console.log(err);
    });
}])
.controller('FavoritesCtrl', [
    '$scope',
    'DB',
    '$cordovaToast',
    'API',
    '$ionicActionSheet',
    '$ionicPlatform',
    function($scope, DB, $cordovaToast, API, $ionicActionSheet, $ionicPlatform) {
        var initialize = function() {
            DB.getUserFavorites()
            .then(function(data) {
                $scope.favorites = data;
                console.log(data);
            });
        };

        $scope.$on('$ionicView.beforeEnter', initialize);

        var removeFavorite = function(area) {
            API.user_remove_favorite(area.ID).then(function() {
                DB.removeFavorite(area.ID);
                $scope.favorites.splice($scope.favorites.indexOf(area), 1);
                $ionicPlatform.ready(function() {
                    $cordovaToast.show('Området är nu borttaget från dina favoriter', 'short', 'bottom');
                });
            });
        };

        $scope.notify = function(area) {
            console.log(area);
            API.user_set_favorite_notification(area.ID, area.not).then(function() {
                $ionicPlatform.ready(function() {
                    $cordovaToast.show('Notifikationer är ' + (area.not ? 'på' : 'av'),
                                       'short', 'bottom');
                });
            });

        };
        $scope.openPopover = function(area) {
            $ionicActionSheet.show({
                buttons: [
                    {text: area.not ? 'Stäng av notifikationer' : 'Sätt på notifikationer'}
                ],
                destructiveText: 'Ta bort favorit',
                destructiveButtonClicked: function() {
                    removeFavorite(area);
                    return true;
                },
                titleText: 'Ändra din favorit',
                cancelText: 'Gör inget',
                buttonClicked: function() {
                    area.not = !area.not;
                    return true;
                },
                cancel: function() {}
            });
        };
    }
]);

angular.module('ifiske.controllers')
.controller('FishDetailCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    function($scope, $stateParams, DB) {
        $scope.fish = $stateParams.fish;
        $scope.image_endpoint = 'http://www.ifiske.se';
        if (!$scope.fish) {
            DB.getFish($stateParams.id)
            .then(function(data) {
                $scope.fish = data;
            }, function(err) {
                console.log(err);
            });
        }
    }
]);

angular.module('ifiske.controllers')
.controller('FishesCtrl', ['$scope', 'DB', function($scope, DB) {
    $scope.sortorder = 'so';
    $scope.image_endpoint = 'http://www.ifiske.se';
    DB.getFishes()
    .then(function(data) {
        $scope.fishes = data;
        $scope.default_img = data[0].img;
    }, function(err) {
        console.log(err);
    });
}]);

angular.module('ifiske.controllers')
.controller('HomeCtrl', [
    '$scope',
    '$state',
    '$ionicHistory',
    'localStorage',
    'sessionData',
    'Update',
    function($scope, $state, $ionicHistory, localStorage, sessionData, Update) {

        $scope.loggedIn = sessionData;

        $scope.update = Update;

        // Current history stack Id. See area_controller for usage.
        localStorage.set('homeHistoryId', $ionicHistory.currentHistoryId());

        $scope.newsTitle = localStorage.get('NEWS');

        $scope.myFunc = function($event) {
            if ($event.keyCode === 13 && !$event.shiftKey) { //if enter-key
                $state.go('app.areas', {search: $event.srcElement.value});
            }

        };
    }
]);

angular.module('ifiske.controllers')
.controller('LegalCtrl', ['$scope', '$state', 'localStorage', function($scope, $state, localStorage) {
    $scope.tos = localStorage.get('tos');
}]);

angular.module('ifiske.controllers')
.controller('LoginCtrl', [
    '$scope',
    '$state',
    'Update',
    '$ionicLoading',
    '$ionicHistory',
    '$ionicViewSwitcher',
    function($scope, $state, Update, $ionicLoading, $ionicHistory, $ionicViewSwitcher) {

        /**
         * signIn
         * Submit handler for login form. Validates login input.
         * Moves to home view on successful login.
         */
        $scope.signIn = function(loginForm) {
            $ionicLoading.show();

            Update.user_login(loginForm.username.$viewValue, loginForm.password.$viewValue)
            .then(function() {
                $ionicLoading.hide();
                loginForm.$setValidity('loginError', true);
                $ionicViewSwitcher.nextDirection('forward');
                $ionicHistory.nextViewOptions({
                    disableBack: true,
                    historyRoot: true
                });
                $state.go('app.home');
            }, function(error) {
                $ionicLoading.hide();
                loginForm.$setValidity('loginError', false);
                $scope.error = error.response;
            });
        };

        /**
         * skip
         * Skips to the home view. Forces forward transition and sets home as root view.
         */
        $scope.skip = function() {
            $ionicViewSwitcher.nextDirection('forward');
            $ionicHistory.nextViewOptions({
                disableBack: true,
                historyRoot: true
            });
            $state.go('app.home');
        };
    }
]);

angular.module('ifiske.controllers')
.controller('MapCtrl', [
    '$scope',
    'leafletData',
    '$ionicPlatform',
    'DB',
    '$cordovaGeolocation',
    '$cordovaDeviceOrientation',
    '$timeout',
    'localStorage',
    function($scope, leafletData, $ionicPlatform, DB, $cordovaGeolocation, $cordovaDeviceOrientation, $timeout, localStorage) {

        var mapboxUrl = 'http://api.tiles.mapbox.com/v4/{maptype}/{z}/{x}/{y}@2x.png?access_token={apikey}';
        var apikey = localStorage.get('mapbox_api');

        var lc = new L.control.locate({
            follow: false,
            position: 'bottomright',
            keepCurrentZoomLevel: false,
            stopFollowingOnDrag: true,
            remainActive: true,
            onLocationError: function(err) {
                console.error(err);
                $timeout(function() {
                    lc.start(); //try again
                });
            },
            onLocationOutsideMapBounds: function(context) {
                console.log(context);
            },
            locateOptions: {
                maxZoom: 14
            },
            icon: 'icon ion-android-locate'

        });
        angular.extend($scope, {
            center: {
                lat: 62.0,
                lng: 15.0,
                zoom: 9,
                autoDiscover: true
            },
            controls: {
                custom: [
                    lc
                ]
            },
            layers: {
                baselayers: {
                    outdoors: {
                        name: 'Utomhus',
                        type: 'xyz',
                        url: mapboxUrl,
                        layerOptions: {
                            maptype: 'mapbox.outdoors',
                            apikey: apikey
                        }
                    },
                    satellite: {
                        name: 'Satellit',
                        type: 'xyz',
                        url: mapboxUrl,
                        layerOptions: {
                            maptype: 'mapbox.satellite',
                            apikey: apikey
                        }
                    }
                },
                overlays: {
                    fishareas: {
                        name: 'Fiskeområden',
                        type: 'markercluster',
                        visible: true,
                        layerParams: {
                            showOnSelector: false,
                            disableClusteringAtZoom: 9,
                            chunkedLoading: true,
                            showCoverageOnHover: false,
                            removeOutsideVisibleBounds: true
                        }
                    },
                }
            },
            markers: {
            }
        });

        var createscope = function(a) {
            return function() {
                var new_scope = $scope.$new();
                new_scope.area = a;
                console.log(a);
                return new_scope;
            };
        };

        $scope.$on('$ionicView.beforeEnter', function() {
            DB.search('').then(function(areas) {
                for(var i = 0; i < areas.length; ++i) {
                    var a = areas[i];
                    $scope.markers['area' + i] = {
                        layer: 'fishareas',
                        lat: a.lat,
                        lng: a.lng,
                        getMessageScope: createscope(a),
                        message: '<a ui-sref="app.area({id: area.ID })" ng-bind="area.t"></a>'
                    };
                }
            });
        });
    }
]);

angular.module('ifiske.controllers')
.controller('MenuCtrl', [
    '$scope',
    '$state',
    '$ionicViewSwitcher',
    '$ionicPopover',
    'sessionData',
    'Update',
    function($scope, $state, $ionicViewSwitcher, $ionicPopover, sessionData, Update) {

        $scope.sessionData = sessionData;

        $ionicPopover.fromTemplateUrl('components/menu/popover.html', {
            scope: $scope
        }).then(function(popover) {
            $scope.popover = popover;
        });

        $scope.userinfo = function() {
            $scope.popover.hide();
            $state.go('app.userinfo');
        };
        $scope.logout = function() {
            $scope.popover.hide();
            Update.user_logout();

            $state.go('app.login');
        };
        $scope.login = function() {
            $scope.popover.hide();
            $ionicViewSwitcher.nextDirection('back');
            $state.go('app.login');
        };
        $scope.register = function() {
            $scope.popover.hide();
            $state.go('app.register.details');
        };

        $scope.forcedUpdate = function() {
            Update.forcedUpdate();
        };

    }
]);

angular.module('ifiske.controllers')
.controller('NewsCtrl', [
    '$scope',
    'DB',
    'localStorage',
    function($scope, DB, localStorage) {
        $scope.newsTitle = localStorage.get('NEWS');

        DB.getNews().then(function(data) {
            $scope.content = data;
        });
    }
]);

angular.module('ifiske.controllers')
.controller('NewsItemCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    function($scope, $stateParams, DB) {
        if ($stateParams.item) {
            $scope.item = $stateParams.item;
        } else {
            DB.getNewsItem($stateParams.id).then(function(data) {
                $scope.item = data;
            });
        }
    }
]);


angular.module('ifiske.controllers')
    .controller('RecoverCtrl', [
	'$scope',
	'$state',
	'$ionicHistory',
	'$ionicPlatform',
	'$ionicLoading',
	'$cordovaToast',
	'API',
	function($scope, $state, $ionicHistory, $ionicPlatform, $ionicLoading, $cordovaToast, API) {
	    'use strict';
	    
	    var user = "";
	    
	    /**
             * ToDo: use to skip from lostpassword to resetpassword
	     * skip
	     * Submit handler for skip button
	     */
            /*
	      $scope.skip = function() {
	      $scope.info = "";
	      $state.go('^.resetpassword');
	      };
            */	    

	    /**
	     * lostPassword
	     * Submit handler for first form
	     */
	    $scope.lostPassword = function(form) {

	        $ionicLoading.show();

	        user = form.user.$viewValue;

	        API.user_lost_password(user)
		    .then(function(data) {
			
			// Set info message for next view
			$scope.info = 'En återställningskod kommer skickas till dig inom kort, via ';			
			if (data.mailed) {
			    $scope.info += 'e-mail';
			    if (data.texted) {
				$scope.info += ' och ';
			    }
			}
			if (data.texted) {
			    $scope.info += 'SMS';
			}
                        
			$state.go('^.resetpassword');

		    }, function(error) {
			//ToDo: handle timeout?
			//ToDo: check error codes?
			form.user.$setValidity('invalidUser', false);
		    })
		    .finally($ionicLoading.hide);
	    };


	    /**
	     * resetPassword
	     * Submit handler for second form
	     *
	     * ToDo: log in immediately?
	     */
	    $scope.resetPassword = function(form) {
		$ionicLoading.show();
		
		
		API.user_reset_password(user, form.password.$viewValue, form.code.$viewValue)
		    .then(function(data) {
		
                        //ToDo: handle timeouts?

                        //ToDo: .ready() needed?
	                // Success toast
		        $ionicPlatform.ready(function() {
		            $cordovaToast.showLongBottom('Ditt lösenord har ändrats');
		        });
	        			
                        $state.go('app.login');

                        // Navigate to current history root?
			//$ionicHistory.goToHistoryRoot($ionicHistory.currentView().historyId);	
		    }, function(error) {
                        switch(error.error_code) {
                        /*case 5:
                            //invalide username
                            break;*/
                        /*case 13:
                            form.password.$setValidity('passwordLength', false);
                            break;*/
                        case 16:
		            form.code.$setValidity('invalidCode',false);
                            break;
                        }
		    })
		    .finally($ionicLoading.hide);
	    };
	}]);

angular.module('ifiske.controllers')
    .controller('RegisterCtrl', [
        '$scope',
        '$state',
        '$ionicLoading',
        '$ionicModal',
        '$ionicScrollDelegate',
        '$ionicPlatform',
        '$cordovaToast',
        'API',
        'localStorage',
        function($scope, $state, $ionicLoading, $ionicModal, $ionicScrollDelegate, $ionicPlatform, $cordovaToast, API, localStorage) {

            var username;

            // Live check for username availability
            $scope.checkUsername = function(input) {
                API.user_exists(input.$viewValue)
                    .then(function(data) {
                        input.$setValidity('nameTaken', !data);
                    });
            };

            // Live check for email availability
            $scope.checkEmail = function(input) {
                API.user_exists(null, input.$viewValue)
                    .then(function(data) {
                        input.$setValidity('emailTaken', !data);
                    });
            };


            // Validation errors not tied to input field
            $scope.formErrors = {};

            /**
             * register
             * Submit handler for the registration form
             */
            $scope.register = function(form) {
                $ionicLoading.show();

                // Save phone number for next view
                $scope.phone = form.phone.$viewValue;

                // Save username for verify submit handler
                username = form.username.$viewValue;

                var password = form.password.$viewValue;
                var fullname = form.fullname.$viewValue;
                var email = form.email.$viewValue;

                API.user_register(username, fullname, password, email, $scope.phone)
                    .then(function(data) {
                        // Success: Go to verify account view
                        $ionicLoading.hide();
                        $scope.formErrors = {};
                        $state.go('^.verify');

                    }, function(error) {
                        /**
                         * Error: Inform the user about failed registration
                         * See API documentation for error codes
                         *
                         * ToDo: Handle timeout
                         */
                        $scope.formErrors.registrationError = true;
                        $ionicScrollDelegate.scrollTop(true);

                        // Invalid Email
                        if (error.error_code == 8) {
                            form.email.$setValidity('invalidEmail', false);
                        }
                        // Username or Email already registered
                        if (error.error_code == 9) {
                            $scope.checkUsername(form.username);
                            $scope.checkEmail(form.email);
                        }
                        // Invalid phone number
                        if (error.error_code == 10) {
                            form.phone.$setValidity('invalidPhone', false);
                        }

                        $ionicLoading.hide();
                    });
            };


            /**
             * verify
             * Submit handler for the verification form
             */
            $scope.verify = function(form) {
                $ionicLoading.show();

                var vercode = form.vercode;

                API.user_confirm(username, vercode.$viewValue)
                    .then(function(data) {
                        $ionicPlatform.ready(function() {
                            $cordovaToast.showLongBottom('Ditt konto har skapats');
                        });
                        $scope.formErrors.validationError = false;
                        $state.go('app.login');
                    }, function(error) {
                        if (error.error_code) {
                            vercode.$setValidity("verified", false);
                        } else {
                            $scope.formErrors.validationError = true;
                        }
                    })
                    .finally($ionicLoading.hide());
            };


            $scope.tos = localStorage.get('tos');
            //Modal with the EULA
            $ionicModal.fromTemplateUrl('components/register/eula.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.eula = modal;
            });
            $scope.showEula = function() {
                $scope.eula.show();
            };
            $scope.closeEula = function() {
                $scope.eula.hide();
            };
            $scope.$on('$destroy', function() {
                $scope.eula.remove();
            });

        }]);

angular.module('ifiske.controllers')
.controller('TechniqueDetailCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    '$ionicSlideBoxDelegate',
    function($scope, $stateParams, DB, $ionicSlideBoxDelegate) {
        $scope.image_endpoint = 'http://www.ifiske.se';
        $scope.tech = $stateParams.tech;
        $scope.images = [];

        if (!$scope.tech) {
            DB.getTechnique($stateParams.id)
            .then(function(data) {
                $scope.images = [data.img1, data.img2, data.img3].filter(function(el) {
                    return !/\/$/.test(el);
                });

                $ionicSlideBoxDelegate.update();
                $scope.tech = data;
            });
        } else {
            var data = $scope.tech;
            $scope.images = [data.img1, data.img2, data.img3].filter(function(el) {
                return !/\/$/.test(el);
            });

            $ionicSlideBoxDelegate.update();
        }
    }
]);

angular.module('ifiske.controllers')
.controller('TechniquesCtrl', ['$scope', 'DB', function($scope, DB) {

    $scope.image_endpoint = 'http://www.ifiske.se';
    $scope.sortorder = 'so';

    $scope.$on('$ionicView.beforeEnter', function() {
        DB.getTechniques()
        .then(function(data) {
            $scope.techniques = data;
        });
    });

}]);

angular.module('ifiske.controllers')
.controller('UserCtrl', ['$scope', 'DB', function($scope, DB) {
    DB.getUserInfo()
    .then(function(user) {
        $scope.user = user;
    });
    DB.getUserNumbers()
    .then(function(numbers) {
        $scope.numbers = numbers;
    });
}]);

angular.module('ifiske.controllers')
.controller('UserCardsCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    'Update',
    '$ionicModal',
    '$ionicLoading',
    function($scope, $stateParams, DB, Update, $ionicModal, $ionicLoading) {
        $scope.pred = '-to';
        $scope.endpoint = 'https://www.ifiske.se';

        var initilize = function() {
            $ionicLoading.show();
            var a = Update.update();
            console.log(a);
            a.then(function(hi) {
                console.log(hi);
            });
            a.finally(function() {
                console.log('helloä');
                $scope.now = Date.now();
                DB.getUserProducts()
                .then(function(data) {
                    $scope.products = data;
                    console.log($scope);
                    $scope.$broadcast('scroll.refreshComplete');
                    $ionicLoading.hide();
                }, function(err) {
                    console.log(err);
                    $scope.$broadcast('scroll.refreshComplete');
                    $ionicLoading.hide();
                });
            });
        };

        $scope.$on('$ionicView.beforeEnter', initilize);
        //use the same modal as in area_cards
        $ionicModal.fromTemplateUrl('components/area_cards/rules_modal.html', {
            scope: $scope,
            animation: 'slide-in-up'
        }).then(function(modal) {
            $scope.rules_modal = modal;
        });
        $scope.openRulesModal = function(product) {
            $scope.rules_modal.show();
            console.log(product);
            $scope.product = product;
        };
        $scope.closeRulesModal = function() {
            $scope.rules_modal.hide();
        };

        $scope.$on('$destroy', function() {
            $scope.rules_modal.remove();
        });
        $scope.update = function() {
            initilize();
        };
    }
]);

(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.api', ['ifiske.utils'])
    .provider('API', function APIProvider() {

        this.base_url = 'https://www.ifiske.se/api/v2/api.php';

        this.$get = [
            '$http',
            'sessionData',
            'localStorage',
            '$q',
            function($http, sessionData, localStorage, $q) {
                var base_url = this.base_url;

                /**
                 * # api_call #
                 * handles http requests
                 * returns a $http object for the requested api call
                 */
                var api_call = function(params, cache) {
                    return $q(function(fulfill, reject) {
                        $http(
                            {
                                method:'get',
                                url: base_url,
                                params: angular.extend(params, {'key': 'ox07xh8aaypwvq7a'}),
                                timeout: 5000,
                                cache: (cache !== false)
                            }
                        )
                        // ToDo: Proper logging
                        .success(function(data) {
                            if (data.status === 'error') {
                                reject(data.message);
                            } else {
                                if (data.data) {
                                    fulfill(data.data.response);
                                } else {
                                    reject(data);
                                }
                            }
                        })
                        //.error(function(data, status, headers, config, statusText) {
                        .error(function(data, status) {
                            if (status === 0) {
                                reject(new Error('Request timeout'));
                            } else {
                                reject(data);
                            }
                        });
                    });
                };

                /**
                 * # session_api_call #
                 * wrapper for api_call - inserts the session token into params
                 */
                var session_api_call = function(params, cache) {
                    var session = sessionData.token;
                    return api_call(angular.extend(params, {s: session}), cache);
                };

                return {
                    get_municipalities: function() {
                        return api_call({m: 'get_municipalities'});
                    },
                    get_counties: function() {
                        return api_call({m: 'get_counties'});
                    },
                    user_exists: function(username, email) {
                        var args = {m: 'user_exists'};

                        if (username && typeof username === 'string') {
                            args.username = username;
                        }
                        if (email && typeof email === 'string') {
                            args.email = email;
                        }

                        return api_call(args, false);
                    },
                    user_register: function(username, fullname, password, email, phone) {
                        return api_call(
                            {m: 'user_register',
                                username: username,
                                fullname: fullname,
                                password: password,
                                email: email,
                                phone: phone
                            }, false);
                    },
                    user_confirm: function(username, pin) {
                        return api_call({
                            m: 'user_confirm',
                            username: username,
                            pin: pin
                        }, false);
                    },
                    user_info: function() {
                        return session_api_call({m: 'user_info'});
                    },
                    user_lost_password: function(user) {
                        return api_call(
                            {m: 'user_lost_password',
                                user_identification: user
                            }, false);
                    },
                    user_reset_password: function(user_identification, password, code) {
                        return api_call({
                            m: 'user_reset_password',
                            user_identification: user_identification,
                            password: password,
                            code: code
                        }, false);
                    },
                    user_change_password: function(old_password, new_password) {
                        return session_api_call({
                            m: 'user_change_password',
                            old_password: old_password,
                            new_password: new_password
                        }, false);
                    },
                    user_login: function(username, password) {
                        return api_call(
                            {m: 'user_login',
                                username: username,
                                password: password
                            }, false)
                            .then(function(data) {
                                sessionData.setToken(data);

                                //needed for chaining of promises
                                return data;
                            });
                    },
                    user_logout: function() {
                        return session_api_call({m: 'user_logout'}, false)
                        .then(function() {
                            sessionData.deleteToken();
                        });
                    },
                    user_products: function() {
                        return session_api_call({m: 'user_products'}, false);
                    },
                    get_fishes: function() {
                        return api_call({m: 'get_fishes'});
                    },
                    get_techniques: function() {
                        return api_call({m: 'get_techniques'});
                    },
                    get_baits: function() {
                        return api_call({m: 'get_baits'});
                    },
                    get_organizations: function(orgid) {
                        return api_call(
                            {m: 'get_organizations',
                                orgid: orgid
                            });
                    },
                    get_org_modified: function(orgid) {
                        return api_call(
                            {m: 'get_org_modified',
                                orgid: orgid
                            });
                    },
                    get_areas: function(areaid) {
                        return api_call(
                            {m: 'get_areas',
                                areaid: areaid
                            });
                    },
                    get_areas_modified: function(areaid) {
                        return api_call(
                            {m: 'get_areas_modified',
                                areaid: areaid
                            });
                    },
                    get_products: function(areaid) {
                        return api_call(
                            {m: 'get_products',
                                areaid: areaid
                            });
                    },
                    get_rules: function(ruleid) {
                        return api_call(
                            {m: 'get_rules',
                                ruleid: ruleid
                            });
                    },
                    get_photos: function(orgid, areaid) {
                        return api_call(
                            {m: 'get_photos',
                                orgid: orgid,
                                areaid: areaid
                            });
                    },
                    get_map_pois: function(orgid) {
                        return api_call(
                            {m: 'get_map_pois',
                                orgid: orgid
                            });
                    },
                    get_map_poi_types : function() {
                        return api_call({m: 'get_map_poi_types'});
                    },
                    get_map_polygons: function(orgid) {
                        return api_call(
                            {m: 'get_map_polygons',
                                orgid: orgid
                            });
                    },
                    user_get_favorites: function() {
                        return session_api_call({m: 'user_get_favorites'}, false);
                    },
                    user_add_favorite: function(area) {
                        //Flag 0 means to not get notifications on catch reports
                        return session_api_call({m: 'user_add_favorite', areaid: area, flag: 0}, false);
                    },
                    user_set_favorite_notification: function(area, flag) {
                        flag = flag ? 1 : 0;
                        return session_api_call({m: 'user_set_favorite_notification', areaid: area, flag: flag}, false);
                    },
                    user_remove_favorite: function(area) {
                        return session_api_call({m: 'user_remove_favorite', areaid: area}, false);
                    },
                    get_terms_of_service: function() {
                        return api_call({m: 'get_terms_of_service'});
                    },
                    get_contact_info: function() {
                        return api_call({m: 'get_contact_info'});
                    },
                    get_engine_policies: function() {
                        return api_call({m: 'get_engine_policies'});
                    },
                    get_sms_terms: function() {
                        return api_call({m: 'get_sms_terms'});
                    },
                    get_mapbox_api: function() {
                        return api_call({m: 'get_mapbox_apiaccesstoken'});
                    },
                    get_content_menu: function() {
                        return api_call({m: 'get_content_menu'});
                    }
                };
            }];
    });
})(window.angular);

(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.db', [])
    .provider('DB', function DBProvider() {

        this.$get = [
            '$cordovaSQLite',
            'API',
            '$q',
            '$rootScope',
            function($cordovaSQLite, API, $q, $rootScope) {

                var db;
                if (window.sqlitePlugin) {
                    db = $cordovaSQLite.openDB('fiskebasen.db');
                } else if (window.openDatabase) {
                    db = window.openDatabase(
                        'fiskebasen.db', '1.0', 'fiskebasen', 10 * 1024 * 1024);
                } else {
                    console.log('Not supported on this device, sorry');
                    return undefined;
                }

                var tableDef = {
                    'Area': [
                        ['ID',    'int'],
                        ['orgid', 'int'],
                        ['t',     'text'],
                        ['kw',    'text'],
                        ['note',  'text'],
                        ['c1',    'int'],
                        ['c2',    'int'],
                        ['c3',    'int'],
                        ['m1',    'int'],
                        ['m2',    'int'],
                        ['m3',    'int'],
                        ['lat',   'real'],
                        ['lng',   'real'],
                        ['zoom',  'text'],
                        ['pnt',   'int'],
                        ['car',   'int'],
                        ['eng',   'int'],
                        ['hcp',   'int'],
                        ['map',   'text'],
                        ['wsc',   'int'],
                        ['mod',   'int'],
                        ['d',     'text']
                    ],
                    'Area_Fish': [
                        ['ID',       'text'],
                        ['aid',      'int'],
                        ['fid',      'int'],
                        ['amount',   'int'],
                        ['comment',  'text']
                    ],
                    'Product': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['t2',     'text'],
                        ['no',     'text'],
                        ['im',     'text'],
                        ['pf',     'text'],
                        ['ai',     'int'],
                        ['ri',     'int'],
                        ['ch',     'int'],
                        ['price',  'int'],
                        ['mod',    'int'],
                        ['so',     'int'],
                        ['hl',     'text']
                    ],
                    'County': [
                        ['ID',   'int'],
                        ['s',    'text'],
                        ['t',    'text'],
                        ['d',    'text']
                    ],
                    'Municipality': [
                        ['ID',    'int'],
                        ['cID',   'int'],
                        ['name',  'text']
                    ],
                    'Fish': [
                        ['ID',    'int'],
                        ['t',     'text'],
                        ['d',     'text'],
                        ['mod',   'int'],
                        ['so',    'int'],
                        ['max',   'int'],
                        ['icon',  'text'],
                        ['img',   'text'],
                        ['in',    'text'],
                        ['geo',   'text'],
                        ['size',  'text'],
                        ['lat',   'text'],
                        ['rec',   'text']
                    ],
                    'Rule': [
                        ['ID',   'int'],
                        ['ver',  'int'],
                        ['d',    'text'],
                        ['t',    'text']
                    ],
                    'User_Product': [
                        ['ID',        'int'],
                        ['at',        'int'],
                        ['code',      'int'],
                        ['fr',        'int'],
                        ['fullname',  'text'],
                        ['ot',        'text'],
                        ['ref1',      'int'],
                        ['ref2',      'int'],
                        ['t',         'text'],
                        ['to',        'int'],
                        ['pid',       'int'],
                        ['pdf',       'text']
                    ],
                    'User_Info': [
                        ['ID',        'int'],
                        ['username',  'text'],
                        ['loggedin',  'text'],
                        ['IP1',       'text'],
                        ['IP2',       'text'],
                        ['name',      'text'],
                        ['email',     'text'],
                        ['created',   'text']
                    ],
                    'User_Number': [
                        ['number', 'text']
                    ],
                    'User_Favorite': [
                        ['ID',  'int'],
                        ['a',   'int'],
                        ['add', 'int'],
                        ['not', 'int'],
                        ['cnt', 'int'],
                    ],
                    'Technique': [
                        ['ID',       'int'],
                        ['t',        'text'],
                        ['d',        'text'],
                        ['so',       'int'],
                        ['de',       'text'],
                        ['da',       'text'],
                        ['icon',     'text'],
                        ['img1',     'text'],
                        ['img2',     'text'],
                        ['img3',     'text'],
                        ['youtube',  'text']
                    ],
                    'Organization': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['d',      'text'],
                        ['cp',     'text'],
                        ['url',    'text'],
                        ['co',     'int'],
                        ['mod',    'int'],
                        ['vat',    'int'],
                        ['dp',     'int'],
                        ['fva',    'int'],
                        ['org',    'int'],
                        ['ml',     'int']
                    ],
                    'Poi': [
                        ['ID',     'int'],
                        ['orgid',  'int'],
                        ['type',   'int'],
                        ['price',  'int'],
                        ['t',      'text'],
                        ['d',      'text'],
                        ['la',     'real'],
                        ['lo',     'real']
                    ],
                    'Poi_Type': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['icon',   'text'],
                    ],
                    'Polygon': [
                        ['ID',     'int'],
                        ['orgid',  'int'],
                        ['t',      'text'],
                        ['c',      'text'],
                        ['ver',    'int'],
                        ['mod',    'int'],
                        ['poly',   'text']
                    ],
                    'News': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['text',   'text']
                    ]

                };

                var createObject = function(data) {
                    var retval = [];
                    for (var i = 0; i < data.rows.length; ++i) {
                        retval.push(data.rows.item(i));
                    }
                    return retval;
                };

                return {
                    populateTable: function(table, data) {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                tx.executeSql('DELETE FROM ' + table + ';');

                                for (var id in data) {
                                    var singleData = data[id];
                                    var insertData = [];
                                    for (var i = 0; i < tableDef[table].length; ++i) {
                                        insertData.push(singleData[tableDef[table][i][0]]);
                                    }
                                    var query = [
                                        'INSERT INTO',
                                        table,
                                        'VALUES(?',
                                        ',?'.repeat(insertData.length - 1),
                                        ')'
                                    ].join(' ');

                                    tx.executeSql(query, insertData);
                                }
                            },
                            reject,
                            fulfill);
                        });

                    },

                    cleanTable: function(table) {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                tx.executeSql('DELETE FROM ' + table + ';');
                            },
                            reject,
                            fulfill);
                        });
                    },

                    /**
                     * Drops all tables in the database
                     * @method clean
                     */
                    clean: function() {
                        return $q(function(fulfill, reject) {
                            db.transaction(
                                function(tx) {
                                    for (var table in tableDef) {
                                        tx.executeSql('DROP TABLE IF EXISTS ' + table + ';');
                                    }
                                },
                                reject,
                                fulfill
                            );
                        })
                        .then(function() {
                            console.log('Removed all tables');
                        });
                    },

                    /**
                     * Initialies the tables in the database
                     * @method init
                     */
                    init: function() {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                for (var t in tableDef) {
                                    var table = tableDef[t];
                                    var tableValues = [];

                                    /*
                                     * Builds a string with "" around all names, so that
                                     * it can be used to create an SQL Table witout having
                                     * to worry about using reserved keywords.
                                     */
                                    for (var i = 0; i < table.length; ++i) {
                                        tableValues.push('"' + table[i][0] + '" ' + table[i][1]);
                                    }
                                    tableValues = tableValues.join(', ');

                                    var query = [
                                        'CREATE TABLE IF NOT EXISTS',
                                        t,
                                        '(',
                                        tableValues,
                                        ', PRIMARY KEY(',
                                        '"' + table[0][0] + '"',
                                        '));'
                                    ].join(' ');
                                    tx.executeSql(query);
                                }
                            },
                            reject,
                            fulfill);
                        });
                    },



                    /**
                     * Gets information about an area
                     * @method getArea
                     * @param {Integer} id
                     */
                    getArea: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT Area.*,',
                                'CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite',
                                'FROM Area',
                                'LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID',
                                'WHERE Area.ID = ?'
                            ].join(' '), Array.isArray(id) ? id : [id])
                            .then(function(area) {
                                console.log(area);
                                var object = createObject(area)[0];
                                //TODO: DB should not need API
                                object.images = API.get_photos(object.orgid);
                                fulfill(object);
                            }, reject);
                        });
                    },

                    getAreaFishes: function(aid) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Area_Fish',
                                'JOIN Fish ON Area_Fish.fid = Fish.ID',
                                'WHERE Area_Fish.aid = ?'
                            ].join(' '), [aid])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Searches the database using a query
                     *
                     * The query is matched to a name and/or keyword
                     * @method search
                     * @param {String} searchstring
                     */
                    search: function(searchstring, county_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT Area.*,',
                                'CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite',
                                'FROM Area',
                                'LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID',
                                'WHERE t LIKE ?',
                                (county_id ? 'AND ? IN (c1,c2,c3)' : ''),
                                'ORDER BY t'
                            ].join(' '),
                            county_id ?
                                ['%' + searchstring + '%', county_id] :
                                ['%' + searchstring + '%'])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Gets information about a product
                     * @method getProduct
                     * @param {Integer} product_id
                     */
                    getProduct: function(product_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM Product',
                                'JOIN Rule ON Rule.ID = Product.ri',
                                'WHERE ID = ?',
                                'ORDER BY so'
                            ].join(' '),
                            [product_id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Gets all products from an area
                     * @method getProductsByArea
                     * @param {Integer} area_id
                     */
                    getProductsByArea: function(area_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM Product',
                                'JOIN Rule ON Rule.ID = Product.ri',
                                'WHERE ai = ?',
                                'ORDER BY so'
                            ].join(' '),
                            [area_id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getCounties: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT County.*',
                                'FROM County',
                                'JOIN Area ON Area.c1 = County.ID',
                                'ORDER BY County.t'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getUserProducts: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT User_Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM User_Product',
                                'LEFT JOIN Product ON Product.ID = User_Product.pid',
                                'LEFT JOIN Rule ON Rule.ID = Product.ri'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getFishes: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Fish'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getFish: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Fish',
                                'WHERE id = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },

                    getTechniques: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Technique'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getTechnique: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Technique',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },
                    getOrganization: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Organization',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },
                    getUserInfo: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Info'
                            ].join(' '))
                            .then(function(user) {
                                fulfill(createObject(user)[0]);
                            }, reject);
                        });
                    },
                    getUserNumbers: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Number'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getUserFavorites: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Favorite',
                                'JOIN Area ON User_Favorite.a = Area.ID'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    removeFavorite: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'DELETE FROM User_Favorite',
                                'WHERE a = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(data);
                            }, reject);
                        });
                    },

                    getPois: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Poi',
                                'WHERE orgid = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getPoiTypes: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Poi_Type'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getPolygons: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Polygon',
                                'WHERE orgid = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getNews: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM News'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getNewsItem: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM News',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    }
                };
            }
        ];
    });
})(window.angular);

angular.module('ifiske.filters', [])
.filter('onebr', function() {
    return function(input) {
        return input.replace(/(<br>\s*)+/g, '<br>');
    };
})
.filter('nobrs', function() {
    return function(input) {
        return input.replace(/(<br(\s*\/)*>)+/g, '');
    };
})
.filter('cleantables', function() {
    return function(input) {
        input = input.replace(/(<\/?table>)+/g, '');
        input = input.replace(/(<\/?tr>)+/g, '');
        input = input.replace(/(<\/?th>)+/g, '');
        input = input.replace(/(<(\/?)td.*?>)+?/g, '<$2p>');
        input = input.replace(/<p>\s*<\/p>/g, '');
        return input;
    };
});

(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.update', ['ifiske.api', 'ifiske.db', 'ifiske.utils'])
    .provider('Update', function UpdateProvider() {

        this.$get = [
            'API',
            'DB',
            'localStorage',
            '$q',
            '$ionicLoading',
            'sessionData',
            function(API, DB, localStorage, $q, $ionicLoading, sessionData) {

                var LAST_UPDATE = 'last_update';

                var updates = {
                    auth: [
                        {
                            endpoint: 'user_products',
                            table: 'User_Product',
                        },
                        {
                            endpoint: 'user_get_favorites',
                            table: 'User_Favorite',
                        },
                        {
                            endpoint: 'user_info',
                            table: [
                                'User_Info',
                                'User_Number'
                            ],
                            f: function(data) {
                                var numbers = data.numbers;
                                var numArr = [];
                                for (var i = 0; i < numbers.length; ++i) {
                                    numArr.push({'number': numbers[i]});
                                }
                                return $q.all([
                                    DB.populateTable('User_Info', [data])
                                    .then(function() {
                                        return 'User_Info';
                                    }, function(err) {
                                        console.log(data);
                                        console.log(err);
                                        return $q.reject(err);
                                    }),
                                    DB.populateTable('User_Number', numArr)
                                    .then(function() {
                                        return 'User_Numbers';
                                    }, function(err) {
                                        console.log(err);
                                        return $q.reject(err);
                                    }),
                                ]);
                            }
                        }
                    ],
                    timed: [
                        {
                            endpoint: 'get_areas',
                            f: function(data) {
                                var fishArr = [];
                                for (var key in data) {
                                    var fishes = data[key].fish;
                                    for (var fishKey in fishes) {
                                        fishArr.push({
                                            'ID': key + '_' + fishKey,
                                            fid: fishKey,
                                            aid: key,
                                            amount: fishes[fishKey][0],
                                            comment: fishes[fishKey][1]
                                        });
                                    }
                                }
                                return $q.all([
                                    DB.populateTable('Area', data),
                                    DB.populateTable('Area_Fish', fishArr)
                                ])
                                .then(function() {
                                    return 'Area';
                                }, function(err) {
                                    console.warn(err);
                                    return $q.reject(err);
                                });
                            }
                        },
                        {
                            endpoint: 'get_products',
                            table: 'Product'
                        },
                        {
                            endpoint: 'get_counties',
                            table: 'County'
                        },
                        {
                            endpoint: 'get_municipalities',
                            table: 'Municipality'
                        },
                        {
                            endpoint: 'get_fishes',
                            table: 'Fish'
                        },
                        {
                            endpoint: 'get_rules',
                            table: 'Rule'
                        },
                        {
                            endpoint: 'get_techniques',
                            table: 'Technique'
                        },
                        {
                            endpoint: 'get_organizations',
                            table: 'Organization'
                        },
                        {
                            endpoint: 'get_map_pois',
                            table: 'Poi'
                        },
                        {
                            endpoint: 'get_map_poi_types',
                            table: 'Poi_Type'
                        },
                        {
                            endpoint: 'get_map_polygons',
                            table: 'Polygon'
                        }
                    ],
                    always: [
                        {
                            endpoint: 'get_content_menu',
                            f: function(data) {
                                localStorage.set('NEWS', data.title);
                                return DB.populateTable('News', data.contents)
                                .then(function() {
                                    return 'News';
                                }, function(err) {
                                    console.warn(err);
                                    return $q.reject(err);
                                });
                            }
                        },
                        {
                            endpoint: 'get_terms_of_service',
                            storage_name: 'tos'
                        },
                        {
                            endpoint: 'get_sms_terms',
                            storage_name: 'sms_terms'
                        },
                        {
                            endpoint: 'get_contact_info',
                            storage_name: 'contactInfo'
                        },
                        {
                            endpoint: 'get_mapbox_api',
                            storage_name: 'mapbox_api'
                        }
                    ]
                };

                var timedUpdate = function(currentTime) {

                    var lastUpdate = localStorage.get(LAST_UPDATE);

                    var aWeek = 1000 * 3600 * 24 * 7;
                    return (currentTime - lastUpdate) > aWeek;
                };

                var populate = function(item) {
                    console.log(item);

                    var p = API[item.endpoint]();
                    var then;
                    if (typeof item.f === 'function') {
                        then = item.f;
                    } else if (item.table) {
                        then = function(data) {
                            return DB.populateTable(item.table, data)
                            .then(function() {
                                return item.table;
                            }, function(err) {
                                //TODO: what if we need to remake the tables?
                                console.warn(err);
                                return $q.reject(err);
                            });
                        };
                    } else if (item.storage_name) {
                        then = function(data) {
                            localStorage.set(item.storage_name, data);
                        };
                    }

                    if (then) {
                        p.then(then);
                    } else {
                        console.error('NO ACTION!');
                    }
                };

                var cleanUser = function() {
                    var p = [];
                    for (var i = 0; i < updates.auth.length; ++i) {
                        if (Array.isArray(updates.auth[i].table)) {
                            for (var j = 0; j < updates.auth[i].table.length; ++j) {
                                p.push(DB.cleanTable(updates.auth[i].table[j]));
                            }
                        } else {
                            p.push(DB.cleanTable(updates.auth[i].table));
                        }
                    }
                    return $q.all(p)
                    .then(function() {
                        console.log('Removed user info from database');
                    }, function(err) {
                        console.log('Could not remove user data from database!', err);
                    });
                };

                var updateFunc = function(forced) {
                    $ionicLoading.show();
                    return $q(function(fulfill, reject) {

                        var promises = [];
                        var currentTime = Date.now();
                        var shouldUpdate = (forced || timedUpdate(currentTime));
                        DB.init()
                        .then(function() {
                            console.log('Initialized DB system');
                            for (var i = 0; i < updates.always.length; ++i) {
                                promises.push(populate(updates.always[i]));
                            }
                            if (sessionData.token) {
                                for (i = 0; i < updates.auth.length; ++i) {
                                    promises.push(populate(updates.auth[i]));
                                }
                            }
                            if (shouldUpdate) {
                                for (i = 0; i < updates.timed.length; ++i) {
                                    promises.push(populate(updates.timed[i]));
                                }
                            }

                            $q.all(promises).then(function(stuff) {
                                console.log('Populated:', stuff);
                                if (shouldUpdate) {
                                    localStorage.set(LAST_UPDATE, currentTime);
                                }
                                fulfill('Pass');
                            }, function(err) {
                                if (err.error_code === 7) {
                                    // Authentication failure
                                    // TODO: Show to user
                                    cleanUser();
                                    API.user_logout();
                                    reject('auth failure');
                                } else {
                                    console.warn('Got an error, recreate all tables:', err);
                                    return DB.clean()
                                    .then(updateFunc);
                                }
                            })
                            .finally(function() {
                                $ionicLoading.hide();
                            });
                        });

                    });
                };

                return {
                    update: function() {
                        return updateFunc();
                    },

                    forcedUpdate: function() {
                        return updateFunc(true);
                    },

                    user_logout: function() {
                        cleanUser();
                        return API.user_logout();
                    },
                    user_login: function(username, password) {
                        return API.user_login(username, password)
                        .then(function() {
                            updateFunc();
                        });
                    },
                    last_update: function() {
                        return localStorage.get(LAST_UPDATE);
                    }
                };
            }
        ];
    });
})(window.angular);

angular.module('ifiske.utils', [])

.factory('localStorage', ['$window', function($window) {
    return {
        set: function(key, value) {
            $window.localStorage.setItem(key, value);
        },
        get: function(key) {
            return $window.localStorage.getItem(key);
        },
        remove: function(key) {
            $window.localStorage.removeItem(key);
        }
    };
}])
.service('sessionData', ['localStorage', function(localStorage) {
    this.token = localStorage.get('session');

    this.setToken = function(t) {
        localStorage.set('session', t);
        this.token = t;
        console.log('token set');
    };
    this.deleteToken = function() {
        localStorage.remove('session');
        this.token = null;
        console.log('token unset');
    };
}])

.factory('Licenses', [
    '$http',
    function($http) {
        return {
            get: function() {
                return $http.get('static/licenses.json');
            }
        };
    }
]);

angular.module('ngCordovaSms', [])
.directive('ngCordovaSms', ['$cordovaSms', '$ionicPopup', function($cordovaSms, $ionicPopup) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                e.preventDefault();
                $ionicPopup.prompt({
                    title: 'Skriv in ditt namn',
                    inputType: 'text'
                }).then(function(name) {
                    var message = 'FISKA ' + attrs.ngCordovaSms + ' ' + name;
                    $cordovaSms.send('72456', message, 'INTENT', function() {
                        console.log('succuess');
                    }, function(err) {
                        console.log(err);
                    });
                });
            });
        }
    };
}]);

angular.module('ifiske.directives')
    .directive('ifiskeInput', function() {
	return {
	    restrict: 'E',
	    transclude: true,

	    scope: {
		name: '@',
		id: '@',
		label: '@',
		placeholder: '@',
		type: '@',
		ngPattern: '@',
		ngModel: '=?'

	    },
	    templateUrl: 'directives/input_field/ifiske_input.html',
	    controller: function($scope) {
		$scope.id = $scope.id || $scope.name;
		$scope.type = $scope.type || 'text';
	    }
	}
    })

angular.module('systemBrowser', [])
.directive('systemBrowser', ['$cordovaInAppBrowser', function($cordovaInAppBrowser) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                $cordovaInAppBrowser.open(el[0].href, '_system');
                e.preventDefault();
            });
        }
    };
}])
.directive('globalSystemBrowser', ['$cordovaInAppBrowser', function($cordovaInAppBrowser) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                if (e.target.href && e.target.host !== window.location.host) {
                    $cordovaInAppBrowser.open(e.target.href, '_system');
                    e.preventDefault();
                }
            });
        }
    };
}]);

/*angular.module('treeTabs', ['ionic'])
    .directive('ionTabs', ['$rootScope','$state','$ionicHistory','$ionicViewSwitcher', function($rootScope, $state, $ionicHistory, $ionicViewSwitcher) {
	function getTabRootState(state) {
	    var isRootState;

	    if (state.parent.self.abstract) {
		isRootState = state.self.name;
	    } else {
		isRootState = false;
	    }

	    return  isRootState || getTabRootState(state.parent);
	}

	function isTabRootState(state) {
	    return state.self.name === getTabRootState(state);
	}

	return {
	    restrict: 'EA',
	    require: 'ionTabs',
	    link: function(scope, element, attr, ctrl) {
		console.log('s: ',scope);
		console.log('e: ',element);
		console.log('a: ',attr);
		console.log('c: ',ctrl);
		var selectTab = ctrl.select;
		ctrl.select = function(tab, shouldEmitEvent) {
		    var selectedTab = ctrl.selectedTab();

		    if (arguments.length === 1) {
			shouldEmitEvent = !!(tab.navViewName || tab.uiSref);
		    }

		    if (selectedTab && selectedTab.$historyId == tab.$historyId && !isTabRootState($state.$current)) {
			if (shouldEmitEvent) {
			    $ionicHistory.nextViewOptions({
				disableBack: true,
				historyRoot: false
			    });
			    $ionicViewSwitcher.nextDirection('back');
			    $state.go(getTabRootState($state.$current));
			}
		    } else if (selectedTab && selectedTab.$historyId == tab.$historyId && isTabRootState($state.$current)) {
			return;
		    } else {
			selectTab.apply(this, arguments);
		    }
		};
	    }
	};
    }]);
*/

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFib3V0L2Fib3V0X2NvbnRyb2xsZXIuanMiLCJhcmVhL2FyZWFfY2FyZHNfY29udHJvbGxlci5qcyIsImFyZWEvYXJlYV9jb250cm9sbGVyLmpzIiwiYXJlYS9hcmVhX2Zpc2hfY29udHJvbGxlci5qcyIsImFyZWEvYXJlYV9pbmZvX2NvbnRyb2xsZXIuanMiLCJhcmVhL2FyZWFfbWFwX2NvbnRyb2xsZXIuanMiLCJhcmVhX2xpc3QvYXJlYV9saXN0X2NvbnRyb2xsZXIuanMiLCJjb250YWN0L2NvbnRhY3RfY29udHJvbGxlci5qcyIsImNvdW50aWVzL2NvdW50aWVzX2NvbnRyb2xsZXIuanMiLCJmaXNoX2RldGFpbC9maXNoX2RldGFpbF9jb250cm9sbGVyLmpzIiwiZmlzaGVzL2Zpc2hlc19jb250cm9sbGVyLmpzIiwiaG9tZS9ob21lX2NvbnRyb2xsZXIuanMiLCJsZWdhbC9sZWdhbF9jb250cm9sbGVyLmpzIiwibG9naW4vbG9naW5fY29udHJvbGxlci5qcyIsIm1hcC9tYXBfY29udHJvbGxlci5qcyIsIm1lbnUvbWVudV9jb250cm9sbGVyLmpzIiwibmV3cy9uZXdzX2NvbnRyb2xsZXIuanMiLCJuZXdzL25ld3NpdGVtX2NvbnRyb2xsZXIuanMiLCJyZWNvdmVyL3JlY292ZXJfY29udHJvbGxlci5qcyIsInJlZ2lzdGVyL3JlZ2lzdGVyX2NvbnRyb2xsZXIuanMiLCJ0ZWNobmlxdWVfZGV0YWlsL3RlY2huaXF1ZV9kZXRhaWxfY29udHJvbGxlci5qcyIsInRlY2huaXF1ZXMvdGVjaG5pcXVlc19jb250cm9sbGVyLmpzIiwidXNlci91c2VyX2NvbnRyb2xsZXIuanMiLCJ1c2VyX2NhcmRzL3VzZXJfY2FyZHNfY29udHJvbGxlci5qcyIsImFwaS5qcyIsImRiLmpzIiwiZmlsdGVyLmpzIiwidXBkYXRlLmpzIiwidXRpbHMuanMiLCJpZmlza2Vfc21zL2lmaXNrZV9zbXMuanMiLCJpbnB1dF9maWVsZC9pZmlza2VfaW5wdXQuanMiLCJzeXN0ZW1fYnJvd3Nlci9zeXN0ZW1fYnJvd3Nlci5qcyIsInRyZWVfdGFicy90cmVlX3RhYnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25RQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeG1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGFuZ3VsYXIubW9kdWxlIGlzIGEgZ2xvYmFsIHBsYWNlIGZvciBjcmVhdGluZywgcmVnaXN0ZXJpbmcgYW5kIHJldHJpZXZpbmcgQW5ndWxhciBtb2R1bGVzXG4vLyAnaWZpc2tlJyBpcyB0aGUgbmFtZSBvZiB0aGlzIGFuZ3VsYXIgbW9kdWxlIChhbHNvIHNldCBpbiBhIDxib2R5PiBhdHRyaWJ1dGUgaW4gaW5kZXguaHRtbClcbi8vIHRoZSAybmQgcGFyYW1ldGVyIGlzIGFuIGFycmF5IG9mICdyZXF1aXJlcydcbi8vICdpZmlza2UuY29udHJvbGxlcnMnIGlzIGZvdW5kIGluIGNvbnRyb2xsZXJzLmpzXG5cbmFuZ3VsYXIubW9kdWxlKCdpZmlza2UnLCBbXG4gICAgJ2lvbmljJyxcbiAgICAnaWZpc2tlLmNvbnRyb2xsZXJzJyxcbiAgICAnaWZpc2tlLmRpcmVjdGl2ZXMnLFxuICAgICdpZmlza2UuYXBpJyxcbiAgICAnaWZpc2tlLmRiJyxcbiAgICAnaWZpc2tlLnV0aWxzJyxcbiAgICAnaWZpc2tlLnVwZGF0ZScsXG4gICAgJ2lmaXNrZS5maWx0ZXJzJyxcbiAgICAnaW9uaWMuaW9uLmhlYWRlclNocmluaycsXG4gICAgJ25nQ29yZG92YScsXG4gICAgJ3N5c3RlbUJyb3dzZXInLFxuICAgICduZ0NvcmRvdmFTbXMnLFxuICAgICduZ01lc3NhZ2VzJyxcbiAgICAnSW1nQ2FjaGUnLFxuICAgICdsZWFmbGV0LWRpcmVjdGl2ZScsXG4gICAgJ3RhYlNsaWRlQm94J1xuXSlcblxuLmNvbnN0YW50KCckaW9uaWNMb2FkaW5nQ29uZmlnJywge1xuICAgIHRlbXBsYXRlOiAnPGlvbi1zcGlubmVyPjwvaW9uLXNwaW5uZXI+J1xuICAgIC8vIGhpZGVPblN0YXRlQ2hhbmdlOiB0cnVlXG59KVxuLnJ1bihbJyRpb25pY1BsYXRmb3JtJywgJ1VwZGF0ZScsICdJbWdDYWNoZScsIGZ1bmN0aW9uKCRpb25pY1BsYXRmb3JtLCBVcGRhdGUsIEltZ0NhY2hlKSB7XG4gICAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIEhpZGUgdGhlIGFjY2Vzc29yeSBiYXIgYWJvdmUgdGhlIGtleWJvYXJkIGZvciBmb3JtIGlucHV0c1xuICAgICAgICBpZiAod2luZG93LmlvbmljICYmIHdpbmRvdy5pb25pYy5LZXlib2FyZCkge1xuICAgICAgICAgICAgd2luZG93LmlvbmljLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2luZG93LlN0YXR1c0Jhcikge1xuICAgICAgICAgICAgLy8gb3JnLmFwYWNoZS5jb3Jkb3ZhLnN0YXR1c2JhciByZXF1aXJlZFxuICAgICAgICAgICAgd2luZG93LlN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIEltZ0NhY2hlLiRpbml0KCk7XG4gICAgICAgIFVwZGF0ZS51cGRhdGUoKTtcbiAgICB9KTtcbn1dKVxuXG4uY29uZmlnKFtcbiAgICAnJHN0YXRlUHJvdmlkZXInLFxuICAgICckdXJsUm91dGVyUHJvdmlkZXInLFxuICAgICckaW9uaWNDb25maWdQcm92aWRlcicsXG4gICAgJ0ltZ0NhY2hlUHJvdmlkZXInLFxuICAgIGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICRpb25pY0NvbmZpZ1Byb3ZpZGVyLCBJbWdDYWNoZVByb3ZpZGVyKSB7XG5cbiAgICAgICAgSW1nQ2FjaGVQcm92aWRlci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIGRlYnVnOiBmYWxzZSxcbiAgICAgICAgICAgIHVzZVBlcnNpc3RlbnRDYWNoZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgSW1nQ2FjaGVQcm92aWRlci5tYW51YWxJbml0ID0gdHJ1ZTtcblxuICAgICAgICAvL0Rpc2FibGUgc3dpcGUgdG8gZ28gYmFjayBzaW5jZSBpdCBpcyBidWdnZWRcbiAgICAgICAgJGlvbmljQ29uZmlnUHJvdmlkZXIudmlld3Muc3dpcGVCYWNrRW5hYmxlZChmYWxzZSk7XG5cbiAgICAgICAgLy8gQ2FjaGUgdmlld3MgaW4gdGhlIGZvcndhcmQgc3RhY2tcbiAgICAgICAgJGlvbmljQ29uZmlnUHJvdmlkZXIudmlld3MuZm9yd2FyZENhY2hlKHRydWUpO1xuXG4gICAgICAgIC8vIENsZWFyIGJhY2sgYnV0dG9uIGRlZmF1bHQgdGV4dFxuICAgICAgICAkaW9uaWNDb25maWdQcm92aWRlci5iYWNrQnV0dG9uLnByZXZpb3VzVGl0bGVUZXh0KGZhbHNlKS50ZXh0KCcnKTtcblxuICAgICAgICAvLyBUYWJzIHBvc2l0aW9uXG4gICAgICAgICRpb25pY0NvbmZpZ1Byb3ZpZGVyLnRhYnMucG9zaXRpb24oJ2JvdHRvbScpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJb25pYyB1c2VzIEFuZ3VsYXJVSSBSb3V0ZXIuIExlYXJuIG1vcmUgaGVyZTpcbiAgICAgICAgICogaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXItdWkvdWktcm91dGVyXG4gICAgICAgICAqL1xuXG4gICAgICAgIHZhciBkZWZhdWx0VXJsID0gJy9hcHAvbG9naW4nO1xuICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzZXNzaW9uJykpIHtcbiAgICAgICAgICAgIGRlZmF1bHRVcmwgPSAnL2FwcC9ob21lJztcbiAgICAgICAgfVxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKGRlZmF1bHRVcmwpO1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgLnN0YXRlKCdhcHAnLCB7XG4gICAgICAgICAgICB1cmw6ICcvYXBwJyxcbiAgICAgICAgICAgIC8vYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvbWVudS9tZW51Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ01lbnVDdHJsJ1xuICAgICAgICB9KVxuXG4gICAgICAgIC5zdGF0ZSgnYXBwLmxvZ2luJywge1xuICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9sb2dpbi9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkN0cmwnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQWNjb3VudCByZWNvdmVyeVxuICAgICAgICAuc3RhdGUoJ2FwcC5yZWNvdmVyJywge1xuICAgICAgICAgICAgdXJsOiAnL3JlY292ZXInLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3JlY292ZXIvcmVjb3Zlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZWNvdmVyQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAucmVjb3Zlci5sb3N0cGFzc3dvcmQnLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9zdHBhc3N3b3JkJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9yZWNvdmVyL2xvc3RwYXNzd29yZC5odG1sJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5yZWNvdmVyLnJlc2V0cGFzc3dvcmQnLCB7XG4gICAgICAgICAgICB1cmw6ICcvcmVzZXRwYXNzd29yZCcsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvcmVjb3Zlci9yZXNldHBhc3N3b3JkLmh0bWwnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQWNjb3VudCByZWdpc3RyYXRpb25cbiAgICAgICAgLnN0YXRlKCdhcHAucmVnaXN0ZXInLCB7XG4gICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3JlZ2lzdGVyL3JlZ2lzdGVyLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAucmVnaXN0ZXIuZGV0YWlscycsIHtcbiAgICAgICAgICAgIHVybDogJy9kZXRhaWxzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9yZWdpc3Rlci9yZWdpc3Rlcl9kZXRhaWxzLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLnJlZ2lzdGVyLnZlcmlmeScsIHtcbiAgICAgICAgICAgIHVybDogJy92ZXJpZnknLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3JlZ2lzdGVyL3JlZ2lzdGVyX3ZlcmlmeS5odG1sJ1xuICAgICAgICB9KVxuXG4gICAgICAgIC8vXG4gICAgICAgIC5zdGF0ZSgnYXBwLmhvbWUnLCB7XG4gICAgICAgICAgICB1cmw6ICcvaG9tZScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvaG9tZS9ob21lLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5pbmZvJywge1xuICAgICAgICAgICAgdXJsOiAnL2luZm8nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2luZm8vaW5mby5odG1sJ1xuICAgICAgICB9KVxuXG4gICAgICAgIC5zdGF0ZSgnYXBwLmJ1Z3MnLCB7XG4gICAgICAgICAgICB1cmw6ICcvaW5mbycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvbWVudS9yZXBvcnQuaHRtbCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuY29udGFjdCcsIHtcbiAgICAgICAgICAgIHVybDogJy9jb250YWN0JyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9jb250YWN0L2NvbnRhY3QuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnQ29udGFjdEN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmxlZ2FsJywge1xuICAgICAgICAgICAgdXJsOiAnL2xlZ2FsJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9sZWdhbC9sZWdhbC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMZWdhbEN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmFib3V0Jywge1xuICAgICAgICAgICAgdXJsOiAnL2Fib3V0JyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hYm91dC9hYm91dC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBYm91dEN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLnVzZXJpbmZvJywge1xuICAgICAgICAgICAgdXJsOiAnL3VzZXJpbmZvJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2VyQ3RybCcsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvdXNlci91c2VyLmh0bWwnLFxuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5maW5kX2FyZWFzJywge1xuICAgICAgICAgICAgdXJsOiAnL2ZpbmRfYXJlYXMnLFxuICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAnQGFwcCc6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2ZpbmRfYXJlYXMvdGFicy5odG1sJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdjb3VudGllc0BhcHAuZmluZF9hcmVhcyc6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2ZpbmRfYXJlYXMvY291bnRpZXMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb3VudGllc0N0cmwnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnZmF2b3JpdGVzQGFwcC5maW5kX2FyZWFzJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmluZF9hcmVhcy9mYXZvcml0ZXMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdGYXZvcml0ZXNDdHJsJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuYXJlYXMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvYXJlYXMnLFxuICAgICAgICAgICAgcGFyYW1zOiB7J2lkJzogZmFsc2UsICdjb3VudHknOiBmYWxzZSwgJ3NlYXJjaCc6ICcnfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hcmVhX2xpc3QvYXJlYV9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFzQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuY2FyZHMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvY2FyZHMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3VzZXJfY2FyZHMvdXNlcl9jYXJkcy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2VyQ2FyZHNDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5mYXZvcml0ZXMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZmF2b3JpdGVzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9mYXZvcml0ZXMvZmF2b3JpdGVzLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmZpc2hlcycsIHtcbiAgICAgICAgICAgIHVybDogJy9maXNoZXMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2Zpc2hlcy9maXNoZXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmlzaGVzQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuZmlzaGRldGFpbCcsIHtcbiAgICAgICAgICAgIHVybDogJy9maXNoZGV0YWlsLzppZCcsXG4gICAgICAgICAgICBwYXJhbXM6IHsnaWQnOiBmYWxzZSwgJ2Zpc2gnOiBmYWxzZX0sXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmlzaF9kZXRhaWwvZmlzaF9kZXRhaWwuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmlzaERldGFpbEN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLm1hcCcsIHtcbiAgICAgICAgICAgIHVybDogJy9tYXAnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL21hcC9tYXAuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWFwQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAudGVjaG5pcXVlcycsIHtcbiAgICAgICAgICAgIHVybDogJy90ZWNobmlxdWVzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy90ZWNobmlxdWVzL3RlY2huaXF1ZXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnVGVjaG5pcXVlc0N0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLnRlY2huaXF1ZWRldGFpbCcsIHtcbiAgICAgICAgICAgIHVybDogJy90ZWNobmlxdWVkZXRhaWwvOmlkJyxcbiAgICAgICAgICAgIHBhcmFtczogeydpZCc6IGZhbHNlLCAndGVjaCc6IGZhbHNlfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy90ZWNobmlxdWVfZGV0YWlsL3RlY2huaXF1ZV9kZXRhaWwuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnVGVjaG5pcXVlRGV0YWlsQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAubmV3cycsIHtcbiAgICAgICAgICAgIHVybDogJy9uZXdzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9uZXdzL25ld3MuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTmV3c0N0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLm5ld3NpdGVtJywge1xuICAgICAgICAgICAgdXJsOiAnL25ld3MvOmlkJyxcbiAgICAgICAgICAgIHBhcmFtczogeydpdGVtJzogZmFsc2UsICdpZCc6IGZhbHNlfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9uZXdzL25ld3NpdGVtLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ05ld3NJdGVtQ3RybCdcbiAgICAgICAgfSlcblxuICAgICAgICAuc3RhdGUoJ2FwcC5hcmVhJywge1xuICAgICAgICAgICAgdXJsOiAnL2FyZWEvOmlkJyxcbiAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgJ0BhcHAnOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hcmVhL2FyZWEuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBcmVhQ3RybCcsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnaW5mb0BhcHAuYXJlYSc6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2FyZWEvaW5mby5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFJbmZvQ3RybCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdtYXBAYXBwLmFyZWEnOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hcmVhL21hcC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFNYXBDdHJsJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2Zpc2hpbmZvQGFwcC5hcmVhJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvYXJlYS9maXNoLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQXJlYUZpc2hDdHJsJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2NhcmRzQGFwcC5hcmVhJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvYXJlYS9jYXJkcy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFDYXJkc0N0cmwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnLCBbXSk7XG5hbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmRpcmVjdGl2ZXMnLCBbXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdBYm91dEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRjb3Jkb3ZhQXBwVmVyc2lvbicsXG4gICAgJyRpb25pY1BsYXRmb3JtJyxcbiAgICAnJGlvbmljTW9kYWwnLFxuICAgICdVcGRhdGUnLFxuICAgICdMaWNlbnNlcycsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkY29yZG92YUFwcFZlcnNpb24sICRpb25pY1BsYXRmb3JtLCAkaW9uaWNNb2RhbCwgVXBkYXRlLCBMaWNlbnNlcykge1xuICAgICAgICAkc2NvcGUudmVyc2lvbiA9ICRzY29wZS5kYkRhdGUgPSAnT2vDpG50JztcbiAgICAgICAgJHNjb3BlLnVwZGF0ZSA9IFVwZGF0ZTtcblxuICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuY29yZG92YSkge1xuICAgICAgICAgICAgICAgICRjb3Jkb3ZhQXBwVmVyc2lvbi5nZXRBcHBWZXJzaW9uKCkudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpRmlza2UgdmVyc2lvbjonLCB2ZXJzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTGljZW5zZXMuZ2V0KCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxpY2Vuc2VzID0gZGF0YS5kYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUuYWxlcnQgPSBmdW5jdGlvbihsKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gJHNjb3BlLiRuZXcoKTtcbiAgICAgICAgICAgICAgICBzY29wZS5sID0gbDtcbiAgICAgICAgICAgICAgICAkaW9uaWNNb2RhbC5mcm9tVGVtcGxhdGVVcmwoXG4gICAgICAgICAgICAgICAgICAgICdjb21wb25lbnRzL2Fib3V0L2xpY2Vuc2VfbW9kYWwuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHtzY29wZTogc2NvcGV9XG4gICAgICAgICAgICAgICAgKS50aGVuKGZ1bmN0aW9uKG1vZGFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwuc2hvdygpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pO1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignQXJlYUNhcmRzQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJGlvbmljTW9kYWwnLFxuICAgICdsb2NhbFN0b3JhZ2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJGlvbmljTW9kYWwsIGxvY2FsU3RvcmFnZSkge1xuICAgICAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmJlZm9yZUVudGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvL0FyZWFfQ2FyZHNcbiAgICAgICAgICAgICRzY29wZS5zbXN0ZXJtcyA9IGxvY2FsU3RvcmFnZS5nZXQoJ3Ntc190ZXJtcycpO1xuICAgICAgICAgICAgJHNjb3BlLnByZWRpY2F0ZSA9ICdzbyc7XG5cbiAgICAgICAgICAgIC8vU01TLW1vZGFsXG4gICAgICAgICAgICAkaW9uaWNNb2RhbC5mcm9tVGVtcGxhdGVVcmwoJ2NvbXBvbmVudHMvYXJlYS9zbXNfbW9kYWwuaHRtbCcsIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJ3NsaWRlLWluLXVwJ1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihtb2RhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zbXNfbW9kYWwgPSBtb2RhbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLm9wZW5Nb2RhbCA9IGZ1bmN0aW9uKHByb2R1Y3QpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zX21vZGFsLnNob3coKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvZHVjdCA9IHByb2R1Y3Q7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zX21vZGFsLmhpZGUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkc2NvcGUuc2hvd1Rlcm1zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dpbmd0ZXJtcyA9ICEkc2NvcGUuc2hvd2luZ3Rlcm1zO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICRzY29wZS5zaG93aW5ndGVybXMgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy9SdWxlcyBtb2RhbFxuICAgICAgICAgICAgJGlvbmljTW9kYWwuZnJvbVRlbXBsYXRlVXJsKCdjb21wb25lbnRzL2FyZWEvcnVsZXNfbW9kYWwuaHRtbCcsIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJ3NsaWRlLWluLXVwJ1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihtb2RhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbCA9IG1vZGFsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUub3BlblJ1bGVzTW9kYWwgPSBmdW5jdGlvbihwcm9kdWN0KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJ1bGVzX21vZGFsLnNob3coKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvZHVjdCA9IHByb2R1Y3Q7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJHNjb3BlLmNsb3NlUnVsZXNNb2RhbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5oaWRlKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zbXNfbW9kYWwucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJ1bGVzX21vZGFsLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignQXJlYUN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZVBhcmFtcycsXG4gICAgJ0RCJyxcbiAgICAnJGlvbmljU2xpZGVCb3hEZWxlZ2F0ZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIERCLCAkaW9uaWNTbGlkZUJveERlbGVnYXRlKSB7XG4gICAgICAgICRzY29wZS5pbWFnZV9lbmRwb2ludCA9ICdodHRwOi8vd3d3LmlmaXNrZS5zZS8nO1xuXG4gICAgICAgIERCLmdldEFyZWEoJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAudGhlbihmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICAkc2NvcGUuYXJlYSA9IGFyZWE7XG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnaWZpc2tlLWFyZWEnKTtcblxuICAgICAgICAgICAgYXJlYS5pbWFnZXMudGhlbihmdW5jdGlvbihpbWFnZXMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW1hZ2VzID0gaW1hZ2VzO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRpb25pY1NsaWRlQm94RGVsZWdhdGUuJGdldEJ5SGFuZGxlKCd0YWJzJykudXBkYXRlKCk7XG4gICAgICAgICAgICAkaW9uaWNTbGlkZUJveERlbGVnYXRlLiRnZXRCeUhhbmRsZSgndGFicycpLmVuYWJsZVNsaWRlKGZhbHNlKTtcblxuICAgICAgICAgICAgREIuZ2V0T3JnYW5pemF0aW9uKGFyZWEub3JnaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihvcmcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JnID0gb3JnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgREIuZ2V0QXJlYUZpc2hlcygkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGZpc2hlcykge1xuICAgICAgICAgICAgJHNjb3BlLmZpc2hlcyA9IGZpc2hlcztcbiAgICAgICAgICAgICRpb25pY1NsaWRlQm94RGVsZWdhdGUuJGdldEJ5SGFuZGxlKCd0YWJzJykudXBkYXRlKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgREIuZ2V0UHJvZHVjdHNCeUFyZWEoJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAudGhlbihmdW5jdGlvbihwcm9kdWN0cykge1xuICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3RzID0gcHJvZHVjdHM7XG4gICAgICAgICAgICAkaW9uaWNTbGlkZUJveERlbGVnYXRlLiRnZXRCeUhhbmRsZSgndGFicycpLnVwZGF0ZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdBcmVhRmlzaEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS5zb3J0b3JkZXIgPSAnLWFtb3VudCc7XG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdBcmVhSW5mb0N0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRpb25pY1NsaWRlQm94RGVsZWdhdGUnLFxuICAgICdzZXNzaW9uRGF0YScsXG4gICAgJyRpb25pY1BvcHVwJyxcbiAgICAnVXBkYXRlJyxcbiAgICAnQVBJJyxcbiAgICAnREInLFxuICAgICckaW9uaWNQbGF0Zm9ybScsXG4gICAgJyRjb3Jkb3ZhVG9hc3QnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJGlvbmljU2xpZGVCb3hEZWxlZ2F0ZSwgc2Vzc2lvbkRhdGEsICRpb25pY1BvcHVwLCBVcGRhdGUsIEFQSSwgREIsICRpb25pY1BsYXRmb3JtLCAkY29yZG92YVRvYXN0KSB7XG4gICAgICAgICRzY29wZS5nb3RvUHJvZHVjdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpb25pY1NsaWRlQm94RGVsZWdhdGUuJGdldEJ5SGFuZGxlKCd0YWJzJykuc2xpZGUoMSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLmNoYW5nZUZhdm9yaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbkRhdGEudG9rZW4pIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJlYS5mYXZvcml0ZSA9ICEkc2NvcGUuYXJlYS5mYXZvcml0ZTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZTtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFyZWEuZmF2b3JpdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IEFQSS51c2VyX2FkZF9mYXZvcml0ZSgkc2NvcGUuYXJlYS5JRCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvdygnT21yw6VkZXQgw6RyIG51IHRpbGxhZ3QgaSBkaW5hIGZhdm9yaXRlcicsICdzaG9ydCcsICdib3R0b20nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBBUEkudXNlcl9yZW1vdmVfZmF2b3JpdGUoJHNjb3BlLmFyZWEuSUQpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gREIucmVtb3ZlRmF2b3JpdGUoJHNjb3BlLmFyZWEuSUQpO1xuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFUb2FzdC5zaG93KCdPbXLDpWRldCDDpHIgbnUgYm9ydHRhZ2V0IGZyw6VuIGRpbmEgZmF2b3JpdGVyJywgJ3Nob3J0JywgJ2JvdHRvbScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9taXNlLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRHUgbcOlc3RlIHZhcmEgaW5sb2dnYWQgZsO2ciBhdHQga3VubmEgaGEgZmF2b3JpdGVyJyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFNYXBDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICdEQicsXG4gICAgJ2xlYWZsZXRFdmVudHMnLFxuICAgICckaW9uaWNQbGF0Zm9ybScsXG4gICAgJyRjb3Jkb3ZhR2VvbG9jYXRpb24nLFxuICAgICckY29yZG92YURldmljZU9yaWVudGF0aW9uJyxcbiAgICAnJHRpbWVvdXQnLFxuICAgICdsb2NhbFN0b3JhZ2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgREIsIGxlYWZsZXRFdmVudHMsICRpb25pY1BsYXRmb3JtLCAkY29yZG92YUdlb2xvY2F0aW9uLCAkY29yZG92YURldmljZU9yaWVudGF0aW9uLCAkdGltZW91dCwgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZU15cG9zKG9iaikge1xuICAgICAgICAgICAgLy9yb3RhdGUgaWNvbkFuZ2xlIDQ1IGRlZyBzaW5jZSB0aGUgaWNvbiBpcyB0aWx0ZWQgYnkgZGVmYXVsdFxuICAgICAgICAgICAgb2JqLmljb25BbmdsZSA9IChvYmouaWNvbkFuZ2xlIHwgMCkgLSA0NTtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG5hbWVkIGVsZW1lbnQgaW4gb3JkZXIgZm9yIHRoZSB1cGRhdGUgdG8gcmVnaXN0ZXJcbiAgICAgICAgICAgIGlmICgkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MyKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJHNjb3BlLm1hcC5tYXJrZXJzLm15cG9zMiwgb2JqKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MgPSAkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MyO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSAkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MsIG9iaik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5tYXJrZXJzLm15cG9zMiA9ICRzY29wZS5tYXAubWFya2Vycy5teXBvcztcbiAgICAgICAgICAgICAgICBkZWxldGUgJHNjb3BlLm1hcC5tYXJrZXJzLm15cG9zO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qIG1pZ2h0IG5lZWQgZm9yIGlvc1xuICAgICAgICAgICBmdW5jdGlvbiBnZXRNeXBvcygpIHtcbiAgICAgICAgICAgcmV0dXJuICRzY29wZS5tYXAubWFya2Vycy5teXBvcyB8fCAkc2NvcGUubWFwLm1hcmtlcnMubXlwb3MyO1xuICAgICAgICAgICB9XG4gICAgICAgICAgICovXG5cbiAgICAgICAgdmFyIGljb25zID0ge307XG4gICAgICAgIHZhciBtYXBib3hVcmwgPSAnaHR0cDovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3ttYXB0eXBlfS97en0ve3h9L3t5fUAyeC5wbmc/YWNjZXNzX3Rva2VuPXthcGlrZXl9JztcbiAgICAgICAgdmFyIGFwaWtleSA9IGxvY2FsU3RvcmFnZS5nZXQoJ21hcGJveF9hcGknKTtcblxuICAgICAgICB2YXIgdXBkYXRlTWFwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUubWFwLmNlbnRlciA9IHtcbiAgICAgICAgICAgICAgICBsYXQ6ICRzY29wZS5hcmVhLmxhdCxcbiAgICAgICAgICAgICAgICBsbmc6ICRzY29wZS5hcmVhLmxuZyxcbiAgICAgICAgICAgICAgICB6b29tOiBOdW1iZXIoJHNjb3BlLmFyZWEuem9vbSkgPyBOdW1iZXIoJHNjb3BlLmFyZWEuem9vbSkgOiA5XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBEQi5nZXRQb2lUeXBlcygpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihwb2lfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaV90eXBlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IHBvaV90eXBlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgaWNvbnNbdHlwZS5JRF0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uVXJsOiAkc2NvcGUuaW1hZ2VfZW5kcG9pbnQgKyB0eXBlLmljb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uQW5jaG9yOiBbMTYsIDM3XSwgLy8gcG9pbnQgb2YgdGhlIGljb24gd2hpY2ggd2lsbCBjb3JyZXNwb25kIHRvIG1hcmtlcidzIGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3B1cEFuY2hvcjogWzAsIC0zNV0sXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIERCLmdldFBvaXMoJHNjb3BlLmFyZWEub3JnaWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocG9pcykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2kgPSBwb2lzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFwLm1hcmtlcnNbJ3BvaScgKyBpXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllcjogJ3BvaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdDogcG9pLmxhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxuZzogcG9pLmxvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IGljb25zW3BvaS50eXBlXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnPGg0PicgKyBwb2kudCArICc8L2g0PjxwPicgKyBwb2kuZCArICc8L3A+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1cE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoIC0gNTBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tYXAubWFya2Vycy5hcmVhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6ICdwb2lzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhdDogJHNjb3BlLmFyZWEubGF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbG5nOiAkc2NvcGUuYXJlYS5sbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAkc2NvcGUuYXJlYS50XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBEQi5nZXRQb2x5Z29ucygkc2NvcGUuYXJlYS5vcmdpZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihwb2x5Z29ucykge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFwLnBhdGhzID0gcG9seWdvbnMubWFwKGZ1bmN0aW9uKHBvbHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0bG5nczogSlNPTi5wYXJzZSgnWycgKyBwb2x5LnBvbHkgKyAnXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBwb2x5LmMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHBvbHkuYyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncG9seWdvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBhbmd1bGFyLmV4dGVuZCgkc2NvcGUsIHtcbiAgICAgICAgICAgIG1hcDoge1xuICAgICAgICAgICAgICAgIGNlbnRlcjoge30sXG4gICAgICAgICAgICAgICAgcGF0aHM6IHt9LFxuXG4gICAgICAgICAgICAgICAgbWFya2Vyczoge1xuICAgICAgICAgICAgICAgICAgICBteXBvczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGF0OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbG5nOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbkFuZ2xlOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0VnZW4gcG9zaXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25TaXplOiBbNDAsNDBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25BbmNob3I6IFsyMCwyMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnaWNvbiBpb24tbmF2aWdhdGUgbXlwb3NpdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBsYXllcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZWxheWVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZG9vcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVXRvbWh1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3h5eicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXBib3hVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHR5cGU6ICdtYXBib3gub3V0ZG9vcnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlrZXk6IGFwaWtleVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzYXRlbGxpdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnU2F0ZWxsaXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd4eXonLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbWFwYm94VXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXB0eXBlOiAnbWFwYm94LnNhdGVsbGl0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaWtleTogYXBpa2V5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvdmVybGF5czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9pczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTdMOkbGxlbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21hcmtlcmNsdXN0ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd09uU2VsZWN0b3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlQ2x1c3RlcmluZ0F0Wm9vbTogOSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtlZExvYWRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVPdXRzaWRlVmlzaWJsZUJvdW5kczogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5hcmVhKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuJG9uKCdpZmlza2UtYXJlYScsIHVwZGF0ZU1hcCk7XG5cbiAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRjb3Jkb3ZhR2VvbG9jYXRpb24ud2F0Y2hQb3NpdGlvbih7XG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogMzAwMFxuICAgICAgICAgICAgICAgIH0pLnRoZW4obnVsbCwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocG9zKSB7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTXlwb3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdDogcG9zLmNvb3Jkcy5sYXRpdHVkZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbmc6IHBvcy5jb29yZHMubG9uZ2l0dWRlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkY29yZG92YURldmljZU9yaWVudGF0aW9uLndhdGNoSGVhZGluZyh7XG4gICAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeTogMzAwMFxuICAgICAgICAgICAgICAgIH0pLnRoZW4obnVsbCwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oaGVhZGluZykge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU15cG9zKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uQW5nbGU6IGhlYWRpbmcudHJ1ZUhlYWRpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkc2NvcGUubmF2aWdhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAvL3ZhciBwb3MgPSBnZXRNeXBvcygpOyAvL21pZ2h0IG5lZWQgZm9yIGlvc1xuICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsYXVuY2huYXZpZ2F0b3IubmF2aWdhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBbJHNjb3BlLm5hdnRvLmxhdCwgJHNjb3BlLm5hdnRvLmxuZ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wZW5pbmcgbmF2aWdhdG9yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgnTmF2aWdhdGlvbiBmYWlsZWQhJywgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZW5hYmxlZEV2ZW50cyA9IFsncG9wdXBvcGVuJywgJ3BvcHVwY2xvc2UnXTtcbiAgICAgICAgICAgICRzY29wZS5ldmVudHMgPSB7XG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZW5hYmxlZEV2ZW50c1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignbGVhZmxldERpcmVjdGl2ZU1hcmtlci5wb3B1cG9wZW4nLCBmdW5jdGlvbihldmVudCwgYXJncykge1xuICAgICAgICAgICAgICAgIC8vc2hvdyBuYXZ0b2J1dHRvblxuICAgICAgICAgICAgICAgICRzY29wZS5uYXZ0byA9IGFyZ3MubW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignbGVhZmxldERpcmVjdGl2ZU1hcmtlci5wb3B1cGNsb3NlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy9oaWRlIG5hdnRvYnV0dG9uXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hdnRvID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFzQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAnJGlvbmljU2Nyb2xsRGVsZWdhdGUnLFxuICAgICdEQicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsICRpb25pY1Njcm9sbERlbGVnYXRlLCBEQikge1xuXG4gICAgICAgIHZhciBjb3B5ID0gJHN0YXRlUGFyYW1zLnNlYXJjaDtcbiAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGNvcHk7XG4gICAgICAgICRzY29wZS5jb3VudHkgPSAkc3RhdGVQYXJhbXMuY291bnR5IHx8ICdTw7ZrcmVzdWx0YXQnO1xuICAgICAgICBEQi5zZWFyY2goJycsICRzdGF0ZVBhcmFtcy5pZClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmFyZWFzID0gZGF0YTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLmNsZWFyU2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoID0gJyc7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5zY3JvbGxUb3AgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpb25pY1Njcm9sbERlbGVnYXRlLnNjcm9sbFRvcCgpO1xuICAgICAgICB9O1xuXG4gICAgfVxuXSk7XG5cbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0NvbnRhY3RDdHJsJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ2xvY2FsU3RvcmFnZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgJHNjb3BlLmNvbnRhY3RJbmZvID0gbG9jYWxTdG9yYWdlLmdldCgnY29udGFjdEluZm8nKTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0NvdW50aWVzQ3RybCcsIFsnJHNjb3BlJywgJ0RCJywgZnVuY3Rpb24oJHNjb3BlLCBEQikge1xuICAgIERCLmdldENvdW50aWVzKClcbiAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICRzY29wZS5jb3VudGllcyA9IGRhdGE7XG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSk7XG59XSlcbi5jb250cm9sbGVyKCdGYXZvcml0ZXNDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICdEQicsXG4gICAgJyRjb3Jkb3ZhVG9hc3QnLFxuICAgICdBUEknLFxuICAgICckaW9uaWNBY3Rpb25TaGVldCcsXG4gICAgJyRpb25pY1BsYXRmb3JtJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsIERCLCAkY29yZG92YVRvYXN0LCBBUEksICRpb25pY0FjdGlvblNoZWV0LCAkaW9uaWNQbGF0Zm9ybSkge1xuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgREIuZ2V0VXNlckZhdm9yaXRlcygpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZhdm9yaXRlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmJlZm9yZUVudGVyJywgaW5pdGlhbGl6ZSk7XG5cbiAgICAgICAgdmFyIHJlbW92ZUZhdm9yaXRlID0gZnVuY3Rpb24oYXJlYSkge1xuICAgICAgICAgICAgQVBJLnVzZXJfcmVtb3ZlX2Zhdm9yaXRlKGFyZWEuSUQpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgREIucmVtb3ZlRmF2b3JpdGUoYXJlYS5JRCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZhdm9yaXRlcy5zcGxpY2UoJHNjb3BlLmZhdm9yaXRlcy5pbmRleE9mKGFyZWEpLCAxKTtcbiAgICAgICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFUb2FzdC5zaG93KCdPbXLDpWRldCDDpHIgbnUgYm9ydHRhZ2V0IGZyw6VuIGRpbmEgZmF2b3JpdGVyJywgJ3Nob3J0JywgJ2JvdHRvbScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm5vdGlmeSA9IGZ1bmN0aW9uKGFyZWEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZWEpO1xuICAgICAgICAgICAgQVBJLnVzZXJfc2V0X2Zhdm9yaXRlX25vdGlmaWNhdGlvbihhcmVhLklELCBhcmVhLm5vdCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFUb2FzdC5zaG93KCdOb3RpZmlrYXRpb25lciDDpHIgJyArIChhcmVhLm5vdCA/ICdww6UnIDogJ2F2JyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hvcnQnLCAnYm90dG9tJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUub3BlblBvcG92ZXIgPSBmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICAkaW9uaWNBY3Rpb25TaGVldC5zaG93KHtcbiAgICAgICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgICAgICAgIHt0ZXh0OiBhcmVhLm5vdCA/ICdTdMOkbmcgYXYgbm90aWZpa2F0aW9uZXInIDogJ1PDpHR0IHDDpSBub3RpZmlrYXRpb25lcid9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBkZXN0cnVjdGl2ZVRleHQ6ICdUYSBib3J0IGZhdm9yaXQnLFxuICAgICAgICAgICAgICAgIGRlc3RydWN0aXZlQnV0dG9uQ2xpY2tlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUZhdm9yaXRlKGFyZWEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRpdGxlVGV4dDogJ8OEbmRyYSBkaW4gZmF2b3JpdCcsXG4gICAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ0fDtnIgaW5nZXQnLFxuICAgICAgICAgICAgICAgIGJ1dHRvbkNsaWNrZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhcmVhLm5vdCA9ICFhcmVhLm5vdDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uKCkge31cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignRmlzaERldGFpbEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZVBhcmFtcycsXG4gICAgJ0RCJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZVBhcmFtcywgREIpIHtcbiAgICAgICAgJHNjb3BlLmZpc2ggPSAkc3RhdGVQYXJhbXMuZmlzaDtcbiAgICAgICAgJHNjb3BlLmltYWdlX2VuZHBvaW50ID0gJ2h0dHA6Ly93d3cuaWZpc2tlLnNlJztcbiAgICAgICAgaWYgKCEkc2NvcGUuZmlzaCkge1xuICAgICAgICAgICAgREIuZ2V0RmlzaCgkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpc2ggPSBkYXRhO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdGaXNoZXNDdHJsJywgWyckc2NvcGUnLCAnREInLCBmdW5jdGlvbigkc2NvcGUsIERCKSB7XG4gICAgJHNjb3BlLnNvcnRvcmRlciA9ICdzbyc7XG4gICAgJHNjb3BlLmltYWdlX2VuZHBvaW50ID0gJ2h0dHA6Ly93d3cuaWZpc2tlLnNlJztcbiAgICBEQi5nZXRGaXNoZXMoKVxuICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgJHNjb3BlLmZpc2hlcyA9IGRhdGE7XG4gICAgICAgICRzY29wZS5kZWZhdWx0X2ltZyA9IGRhdGFbMF0uaW1nO1xuICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignSG9tZUN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJyRpb25pY0hpc3RvcnknLFxuICAgICdsb2NhbFN0b3JhZ2UnLFxuICAgICdzZXNzaW9uRGF0YScsXG4gICAgJ1VwZGF0ZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRpb25pY0hpc3RvcnksIGxvY2FsU3RvcmFnZSwgc2Vzc2lvbkRhdGEsIFVwZGF0ZSkge1xuXG4gICAgICAgICRzY29wZS5sb2dnZWRJbiA9IHNlc3Npb25EYXRhO1xuXG4gICAgICAgICRzY29wZS51cGRhdGUgPSBVcGRhdGU7XG5cbiAgICAgICAgLy8gQ3VycmVudCBoaXN0b3J5IHN0YWNrIElkLiBTZWUgYXJlYV9jb250cm9sbGVyIGZvciB1c2FnZS5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldCgnaG9tZUhpc3RvcnlJZCcsICRpb25pY0hpc3RvcnkuY3VycmVudEhpc3RvcnlJZCgpKTtcblxuICAgICAgICAkc2NvcGUubmV3c1RpdGxlID0gbG9jYWxTdG9yYWdlLmdldCgnTkVXUycpO1xuXG4gICAgICAgICRzY29wZS5teUZ1bmMgPSBmdW5jdGlvbigkZXZlbnQpIHtcbiAgICAgICAgICAgIGlmICgkZXZlbnQua2V5Q29kZSA9PT0gMTMgJiYgISRldmVudC5zaGlmdEtleSkgeyAvL2lmIGVudGVyLWtleVxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmFyZWFzJywge3NlYXJjaDogJGV2ZW50LnNyY0VsZW1lbnQudmFsdWV9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignTGVnYWxDdHJsJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ2xvY2FsU3RvcmFnZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAkc2NvcGUudG9zID0gbG9jYWxTdG9yYWdlLmdldCgndG9zJyk7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZScsXG4gICAgJ1VwZGF0ZScsXG4gICAgJyRpb25pY0xvYWRpbmcnLFxuICAgICckaW9uaWNIaXN0b3J5JyxcbiAgICAnJGlvbmljVmlld1N3aXRjaGVyJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXBkYXRlLCAkaW9uaWNMb2FkaW5nLCAkaW9uaWNIaXN0b3J5LCAkaW9uaWNWaWV3U3dpdGNoZXIpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogc2lnbkluXG4gICAgICAgICAqIFN1Ym1pdCBoYW5kbGVyIGZvciBsb2dpbiBmb3JtLiBWYWxpZGF0ZXMgbG9naW4gaW5wdXQuXG4gICAgICAgICAqIE1vdmVzIHRvIGhvbWUgdmlldyBvbiBzdWNjZXNzZnVsIGxvZ2luLlxuICAgICAgICAgKi9cbiAgICAgICAgJHNjb3BlLnNpZ25JbiA9IGZ1bmN0aW9uKGxvZ2luRm9ybSkge1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG5cbiAgICAgICAgICAgIFVwZGF0ZS51c2VyX2xvZ2luKGxvZ2luRm9ybS51c2VybmFtZS4kdmlld1ZhbHVlLCBsb2dpbkZvcm0ucGFzc3dvcmQuJHZpZXdWYWx1ZSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGxvZ2luRm9ybS4kc2V0VmFsaWRpdHkoJ2xvZ2luRXJyb3InLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkaW9uaWNWaWV3U3dpdGNoZXIubmV4dERpcmVjdGlvbignZm9yd2FyZCcpO1xuICAgICAgICAgICAgICAgICRpb25pY0hpc3RvcnkubmV4dFZpZXdPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUJhY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlSb290OiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuaG9tZScpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBsb2dpbkZvcm0uJHNldFZhbGlkaXR5KCdsb2dpbkVycm9yJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLnJlc3BvbnNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIHNraXBcbiAgICAgICAgICogU2tpcHMgdG8gdGhlIGhvbWUgdmlldy4gRm9yY2VzIGZvcndhcmQgdHJhbnNpdGlvbiBhbmQgc2V0cyBob21lIGFzIHJvb3Qgdmlldy5cbiAgICAgICAgICovXG4gICAgICAgICRzY29wZS5za2lwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaW9uaWNWaWV3U3dpdGNoZXIubmV4dERpcmVjdGlvbignZm9yd2FyZCcpO1xuICAgICAgICAgICAgJGlvbmljSGlzdG9yeS5uZXh0Vmlld09wdGlvbnMoe1xuICAgICAgICAgICAgICAgIGRpc2FibGVCYWNrOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhpc3RvcnlSb290OiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmhvbWUnKTtcbiAgICAgICAgfTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ01hcEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ2xlYWZsZXREYXRhJyxcbiAgICAnJGlvbmljUGxhdGZvcm0nLFxuICAgICdEQicsXG4gICAgJyRjb3Jkb3ZhR2VvbG9jYXRpb24nLFxuICAgICckY29yZG92YURldmljZU9yaWVudGF0aW9uJyxcbiAgICAnJHRpbWVvdXQnLFxuICAgICdsb2NhbFN0b3JhZ2UnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgbGVhZmxldERhdGEsICRpb25pY1BsYXRmb3JtLCBEQiwgJGNvcmRvdmFHZW9sb2NhdGlvbiwgJGNvcmRvdmFEZXZpY2VPcmllbnRhdGlvbiwgJHRpbWVvdXQsIGxvY2FsU3RvcmFnZSkge1xuXG4gICAgICAgIHZhciBtYXBib3hVcmwgPSAnaHR0cDovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3ttYXB0eXBlfS97en0ve3h9L3t5fUAyeC5wbmc/YWNjZXNzX3Rva2VuPXthcGlrZXl9JztcbiAgICAgICAgdmFyIGFwaWtleSA9IGxvY2FsU3RvcmFnZS5nZXQoJ21hcGJveF9hcGknKTtcblxuICAgICAgICB2YXIgbGMgPSBuZXcgTC5jb250cm9sLmxvY2F0ZSh7XG4gICAgICAgICAgICBmb2xsb3c6IGZhbHNlLFxuICAgICAgICAgICAgcG9zaXRpb246ICdib3R0b21yaWdodCcsXG4gICAgICAgICAgICBrZWVwQ3VycmVudFpvb21MZXZlbDogZmFsc2UsXG4gICAgICAgICAgICBzdG9wRm9sbG93aW5nT25EcmFnOiB0cnVlLFxuICAgICAgICAgICAgcmVtYWluQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgb25Mb2NhdGlvbkVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGxjLnN0YXJ0KCk7IC8vdHJ5IGFnYWluXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Mb2NhdGlvbk91dHNpZGVNYXBCb3VuZHM6IGZ1bmN0aW9uKGNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb250ZXh0KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2NhdGVPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgbWF4Wm9vbTogMTRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpY29uOiAnaWNvbiBpb24tYW5kcm9pZC1sb2NhdGUnXG5cbiAgICAgICAgfSk7XG4gICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRzY29wZSwge1xuICAgICAgICAgICAgY2VudGVyOiB7XG4gICAgICAgICAgICAgICAgbGF0OiA2Mi4wLFxuICAgICAgICAgICAgICAgIGxuZzogMTUuMCxcbiAgICAgICAgICAgICAgICB6b29tOiA5LFxuICAgICAgICAgICAgICAgIGF1dG9EaXNjb3ZlcjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRyb2xzOiB7XG4gICAgICAgICAgICAgICAgY3VzdG9tOiBbXG4gICAgICAgICAgICAgICAgICAgIGxjXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxheWVyczoge1xuICAgICAgICAgICAgICAgIGJhc2VsYXllcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgb3V0ZG9vcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdVdG9taHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd4eXonLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXBib3hVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllck9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXB0eXBlOiAnbWFwYm94Lm91dGRvb3JzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlrZXk6IGFwaWtleVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzYXRlbGxpdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTYXRlbGxpdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAneHl6JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbWFwYm94VXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwdHlwZTogJ21hcGJveC5zYXRlbGxpdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaWtleTogYXBpa2V5XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG92ZXJsYXlzOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpc2hhcmVhczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0Zpc2tlb21yw6VkZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ21hcmtlcmNsdXN0ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd09uU2VsZWN0b3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVDbHVzdGVyaW5nQXRab29tOiA5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rZWRMb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZU91dHNpZGVWaXNpYmxlQm91bmRzOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGNyZWF0ZXNjb3BlID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdfc2NvcGUgPSAkc2NvcGUuJG5ldygpO1xuICAgICAgICAgICAgICAgIG5ld19zY29wZS5hcmVhID0gYTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3X3Njb3BlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmJlZm9yZUVudGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBEQi5zZWFyY2goJycpLnRoZW4oZnVuY3Rpb24oYXJlYXMpIHtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYXJlYXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBhcmVhc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1hcmtlcnNbJ2FyZWEnICsgaV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXllcjogJ2Zpc2hhcmVhcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXQ6IGEubGF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbG5nOiBhLmxuZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldE1lc3NhZ2VTY29wZTogY3JlYXRlc2NvcGUoYSksXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnPGEgdWktc3JlZj1cImFwcC5hcmVhKHtpZDogYXJlYS5JRCB9KVwiIG5nLWJpbmQ9XCJhcmVhLnRcIj48L2E+J1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ01lbnVDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGUnLFxuICAgICckaW9uaWNWaWV3U3dpdGNoZXInLFxuICAgICckaW9uaWNQb3BvdmVyJyxcbiAgICAnc2Vzc2lvbkRhdGEnLFxuICAgICdVcGRhdGUnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkaW9uaWNWaWV3U3dpdGNoZXIsICRpb25pY1BvcG92ZXIsIHNlc3Npb25EYXRhLCBVcGRhdGUpIHtcblxuICAgICAgICAkc2NvcGUuc2Vzc2lvbkRhdGEgPSBzZXNzaW9uRGF0YTtcblxuICAgICAgICAkaW9uaWNQb3BvdmVyLmZyb21UZW1wbGF0ZVVybCgnY29tcG9uZW50cy9tZW51L3BvcG92ZXIuaHRtbCcsIHtcbiAgICAgICAgICAgIHNjb3BlOiAkc2NvcGVcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihwb3BvdmVyKSB7XG4gICAgICAgICAgICAkc2NvcGUucG9wb3ZlciA9IHBvcG92ZXI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS51c2VyaW5mbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnBvcG92ZXIuaGlkZSgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAudXNlcmluZm8nKTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmxvZ291dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnBvcG92ZXIuaGlkZSgpO1xuICAgICAgICAgICAgVXBkYXRlLnVzZXJfbG9nb3V0KCk7XG5cbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmxvZ2luJyk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnBvcG92ZXIuaGlkZSgpO1xuICAgICAgICAgICAgJGlvbmljVmlld1N3aXRjaGVyLm5leHREaXJlY3Rpb24oJ2JhY2snKTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmxvZ2luJyk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnBvcG92ZXIuaGlkZSgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAucmVnaXN0ZXIuZGV0YWlscycpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5mb3JjZWRVcGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVwZGF0ZS5mb3JjZWRVcGRhdGUoKTtcbiAgICAgICAgfTtcblxuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignTmV3c0N0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ0RCJyxcbiAgICAnbG9jYWxTdG9yYWdlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsIERCLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgJHNjb3BlLm5ld3NUaXRsZSA9IGxvY2FsU3RvcmFnZS5nZXQoJ05FV1MnKTtcblxuICAgICAgICBEQi5nZXROZXdzKCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUuY29udGVudCA9IGRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignTmV3c0l0ZW1DdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGVQYXJhbXMnLFxuICAgICdEQicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIERCKSB7XG4gICAgICAgIGlmICgkc3RhdGVQYXJhbXMuaXRlbSkge1xuICAgICAgICAgICAgJHNjb3BlLml0ZW0gPSAkc3RhdGVQYXJhbXMuaXRlbTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIERCLmdldE5ld3NJdGVtKCRzdGF0ZVBhcmFtcy5pZCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLml0ZW0gPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5dKTtcbiIsIlxuYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4gICAgLmNvbnRyb2xsZXIoJ1JlY292ZXJDdHJsJywgW1xuXHQnJHNjb3BlJyxcblx0JyRzdGF0ZScsXG5cdCckaW9uaWNIaXN0b3J5Jyxcblx0JyRpb25pY1BsYXRmb3JtJyxcblx0JyRpb25pY0xvYWRpbmcnLFxuXHQnJGNvcmRvdmFUb2FzdCcsXG5cdCdBUEknLFxuXHRmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGlvbmljSGlzdG9yeSwgJGlvbmljUGxhdGZvcm0sICRpb25pY0xvYWRpbmcsICRjb3Jkb3ZhVG9hc3QsIEFQSSkge1xuXHQgICAgJ3VzZSBzdHJpY3QnO1xuXHQgICAgXG5cdCAgICB2YXIgdXNlciA9IFwiXCI7XG5cdCAgICBcblx0ICAgIC8qKlxuICAgICAgICAgICAgICogVG9EbzogdXNlIHRvIHNraXAgZnJvbSBsb3N0cGFzc3dvcmQgdG8gcmVzZXRwYXNzd29yZFxuXHQgICAgICogc2tpcFxuXHQgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIHNraXAgYnV0dG9uXG5cdCAgICAgKi9cbiAgICAgICAgICAgIC8qXG5cdCAgICAgICRzY29wZS5za2lwID0gZnVuY3Rpb24oKSB7XG5cdCAgICAgICRzY29wZS5pbmZvID0gXCJcIjtcblx0ICAgICAgJHN0YXRlLmdvKCdeLnJlc2V0cGFzc3dvcmQnKTtcblx0ICAgICAgfTtcbiAgICAgICAgICAgICovXHQgICAgXG5cblx0ICAgIC8qKlxuXHQgICAgICogbG9zdFBhc3N3b3JkXG5cdCAgICAgKiBTdWJtaXQgaGFuZGxlciBmb3IgZmlyc3QgZm9ybVxuXHQgICAgICovXG5cdCAgICAkc2NvcGUubG9zdFBhc3N3b3JkID0gZnVuY3Rpb24oZm9ybSkge1xuXG5cdCAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG5cblx0ICAgICAgICB1c2VyID0gZm9ybS51c2VyLiR2aWV3VmFsdWU7XG5cblx0ICAgICAgICBBUEkudXNlcl9sb3N0X3Bhc3N3b3JkKHVzZXIpXG5cdFx0ICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFxuXHRcdFx0Ly8gU2V0IGluZm8gbWVzc2FnZSBmb3IgbmV4dCB2aWV3XG5cdFx0XHQkc2NvcGUuaW5mbyA9ICdFbiDDpXRlcnN0w6RsbG5pbmdza29kIGtvbW1lciBza2lja2FzIHRpbGwgZGlnIGlub20ga29ydCwgdmlhICc7XHRcdFx0XG5cdFx0XHRpZiAoZGF0YS5tYWlsZWQpIHtcblx0XHRcdCAgICAkc2NvcGUuaW5mbyArPSAnZS1tYWlsJztcblx0XHRcdCAgICBpZiAoZGF0YS50ZXh0ZWQpIHtcblx0XHRcdFx0JHNjb3BlLmluZm8gKz0gJyBvY2ggJztcblx0XHRcdCAgICB9XG5cdFx0XHR9XG5cdFx0XHRpZiAoZGF0YS50ZXh0ZWQpIHtcblx0XHRcdCAgICAkc2NvcGUuaW5mbyArPSAnU01TJztcblx0XHRcdH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuXHRcdFx0JHN0YXRlLmdvKCdeLnJlc2V0cGFzc3dvcmQnKTtcblxuXHRcdCAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0Ly9Ub0RvOiBoYW5kbGUgdGltZW91dD9cblx0XHRcdC8vVG9EbzogY2hlY2sgZXJyb3IgY29kZXM/XG5cdFx0XHRmb3JtLnVzZXIuJHNldFZhbGlkaXR5KCdpbnZhbGlkVXNlcicsIGZhbHNlKTtcblx0XHQgICAgfSlcblx0XHQgICAgLmZpbmFsbHkoJGlvbmljTG9hZGluZy5oaWRlKTtcblx0ICAgIH07XG5cblxuXHQgICAgLyoqXG5cdCAgICAgKiByZXNldFBhc3N3b3JkXG5cdCAgICAgKiBTdWJtaXQgaGFuZGxlciBmb3Igc2Vjb25kIGZvcm1cblx0ICAgICAqXG5cdCAgICAgKiBUb0RvOiBsb2cgaW4gaW1tZWRpYXRlbHk/XG5cdCAgICAgKi9cblx0ICAgICRzY29wZS5yZXNldFBhc3N3b3JkID0gZnVuY3Rpb24oZm9ybSkge1xuXHRcdCRpb25pY0xvYWRpbmcuc2hvdygpO1xuXHRcdFxuXHRcdFxuXHRcdEFQSS51c2VyX3Jlc2V0X3Bhc3N3b3JkKHVzZXIsIGZvcm0ucGFzc3dvcmQuJHZpZXdWYWx1ZSwgZm9ybS5jb2RlLiR2aWV3VmFsdWUpXG5cdFx0ICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVG9EbzogaGFuZGxlIHRpbWVvdXRzP1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RvRG86IC5yZWFkeSgpIG5lZWRlZD9cblx0ICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3MgdG9hc3Rcblx0XHQgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvd0xvbmdCb3R0b20oJ0RpdHQgbMO2c2Vub3JkIGhhciDDpG5kcmF0cycpO1xuXHRcdCAgICAgICAgfSk7XG5cdCAgICAgICAgXHRcdFx0XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5sb2dpbicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOYXZpZ2F0ZSB0byBjdXJyZW50IGhpc3Rvcnkgcm9vdD9cblx0XHRcdC8vJGlvbmljSGlzdG9yeS5nb1RvSGlzdG9yeVJvb3QoJGlvbmljSGlzdG9yeS5jdXJyZW50VmlldygpLmhpc3RvcnlJZCk7XHRcblx0XHQgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaChlcnJvci5lcnJvcl9jb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKmNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ludmFsaWRlIHVzZXJuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8qY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnBhc3N3b3JkLiRzZXRWYWxpZGl0eSgncGFzc3dvcmRMZW5ndGgnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6XG5cdFx0ICAgICAgICAgICAgZm9ybS5jb2RlLiRzZXRWYWxpZGl0eSgnaW52YWxpZENvZGUnLGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblx0XHQgICAgfSlcblx0XHQgICAgLmZpbmFsbHkoJGlvbmljTG9hZGluZy5oaWRlKTtcblx0ICAgIH07XG5cdH1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBbXG4gICAgICAgICckc2NvcGUnLFxuICAgICAgICAnJHN0YXRlJyxcbiAgICAgICAgJyRpb25pY0xvYWRpbmcnLFxuICAgICAgICAnJGlvbmljTW9kYWwnLFxuICAgICAgICAnJGlvbmljU2Nyb2xsRGVsZWdhdGUnLFxuICAgICAgICAnJGlvbmljUGxhdGZvcm0nLFxuICAgICAgICAnJGNvcmRvdmFUb2FzdCcsXG4gICAgICAgICdBUEknLFxuICAgICAgICAnbG9jYWxTdG9yYWdlJyxcbiAgICAgICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRpb25pY0xvYWRpbmcsICRpb25pY01vZGFsLCAkaW9uaWNTY3JvbGxEZWxlZ2F0ZSwgJGlvbmljUGxhdGZvcm0sICRjb3Jkb3ZhVG9hc3QsIEFQSSwgbG9jYWxTdG9yYWdlKSB7XG5cbiAgICAgICAgICAgIHZhciB1c2VybmFtZTtcblxuICAgICAgICAgICAgLy8gTGl2ZSBjaGVjayBmb3IgdXNlcm5hbWUgYXZhaWxhYmlsaXR5XG4gICAgICAgICAgICAkc2NvcGUuY2hlY2tVc2VybmFtZSA9IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgQVBJLnVzZXJfZXhpc3RzKGlucHV0LiR2aWV3VmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LiRzZXRWYWxpZGl0eSgnbmFtZVRha2VuJywgIWRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIExpdmUgY2hlY2sgZm9yIGVtYWlsIGF2YWlsYWJpbGl0eVxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrRW1haWwgPSBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIEFQSS51c2VyX2V4aXN0cyhudWxsLCBpbnB1dC4kdmlld1ZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC4kc2V0VmFsaWRpdHkoJ2VtYWlsVGFrZW4nLCAhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAvLyBWYWxpZGF0aW9uIGVycm9ycyBub3QgdGllZCB0byBpbnB1dCBmaWVsZFxuICAgICAgICAgICAgJHNjb3BlLmZvcm1FcnJvcnMgPSB7fTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiByZWdpc3RlclxuICAgICAgICAgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIHRoZSByZWdpc3RyYXRpb24gZm9ybVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbihmb3JtKSB7XG4gICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAvLyBTYXZlIHBob25lIG51bWJlciBmb3IgbmV4dCB2aWV3XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBob25lID0gZm9ybS5waG9uZS4kdmlld1ZhbHVlO1xuXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSB1c2VybmFtZSBmb3IgdmVyaWZ5IHN1Ym1pdCBoYW5kbGVyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBmb3JtLnVzZXJuYW1lLiR2aWV3VmFsdWU7XG5cbiAgICAgICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSBmb3JtLnBhc3N3b3JkLiR2aWV3VmFsdWU7XG4gICAgICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gZm9ybS5mdWxsbmFtZS4kdmlld1ZhbHVlO1xuICAgICAgICAgICAgICAgIHZhciBlbWFpbCA9IGZvcm0uZW1haWwuJHZpZXdWYWx1ZTtcblxuICAgICAgICAgICAgICAgIEFQSS51c2VyX3JlZ2lzdGVyKHVzZXJuYW1lLCBmdWxsbmFtZSwgcGFzc3dvcmQsIGVtYWlsLCAkc2NvcGUucGhvbmUpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1Y2Nlc3M6IEdvIHRvIHZlcmlmeSBhY2NvdW50IHZpZXdcbiAgICAgICAgICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1FcnJvcnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnXi52ZXJpZnknKTtcblxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBFcnJvcjogSW5mb3JtIHRoZSB1c2VyIGFib3V0IGZhaWxlZCByZWdpc3RyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAqIFNlZSBBUEkgZG9jdW1lbnRhdGlvbiBmb3IgZXJyb3IgY29kZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBUb0RvOiBIYW5kbGUgdGltZW91dFxuICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybUVycm9ycy5yZWdpc3RyYXRpb25FcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAkaW9uaWNTY3JvbGxEZWxlZ2F0ZS5zY3JvbGxUb3AodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWQgRW1haWxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5lcnJvcl9jb2RlID09IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmVtYWlsLiRzZXRWYWxpZGl0eSgnaW52YWxpZEVtYWlsJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXNlcm5hbWUgb3IgRW1haWwgYWxyZWFkeSByZWdpc3RlcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3JfY29kZSA9PSA5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlcm5hbWUoZm9ybS51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoZWNrRW1haWwoZm9ybS5lbWFpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIHBob25lIG51bWJlclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yX2NvZGUgPT0gMTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnBob25lLiRzZXRWYWxpZGl0eSgnaW52YWxpZFBob25lJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogdmVyaWZ5XG4gICAgICAgICAgICAgKiBTdWJtaXQgaGFuZGxlciBmb3IgdGhlIHZlcmlmaWNhdGlvbiBmb3JtXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICRzY29wZS52ZXJpZnkgPSBmdW5jdGlvbihmb3JtKSB7XG4gICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdmVyY29kZSA9IGZvcm0udmVyY29kZTtcblxuICAgICAgICAgICAgICAgIEFQSS51c2VyX2NvbmZpcm0odXNlcm5hbWUsIHZlcmNvZGUuJHZpZXdWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFUb2FzdC5zaG93TG9uZ0JvdHRvbSgnRGl0dCBrb250byBoYXIgc2thcGF0cycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybUVycm9ycy52YWxpZGF0aW9uRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLmxvZ2luJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3JfY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmNvZGUuJHNldFZhbGlkaXR5KFwidmVyaWZpZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZm9ybUVycm9ycy52YWxpZGF0aW9uRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuZmluYWxseSgkaW9uaWNMb2FkaW5nLmhpZGUoKSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICRzY29wZS50b3MgPSBsb2NhbFN0b3JhZ2UuZ2V0KCd0b3MnKTtcbiAgICAgICAgICAgIC8vTW9kYWwgd2l0aCB0aGUgRVVMQVxuICAgICAgICAgICAgJGlvbmljTW9kYWwuZnJvbVRlbXBsYXRlVXJsKCdjb21wb25lbnRzL3JlZ2lzdGVyL2V1bGEuaHRtbCcsIHtcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJ3NsaWRlLWluLXVwJ1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihtb2RhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ldWxhID0gbW9kYWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5zaG93RXVsYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ldWxhLnNob3coKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkc2NvcGUuY2xvc2VFdWxhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmV1bGEuaGlkZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmV1bGEucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdUZWNobmlxdWVEZXRhaWxDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGVQYXJhbXMnLFxuICAgICdEQicsXG4gICAgJyRpb25pY1NsaWRlQm94RGVsZWdhdGUnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlUGFyYW1zLCBEQiwgJGlvbmljU2xpZGVCb3hEZWxlZ2F0ZSkge1xuICAgICAgICAkc2NvcGUuaW1hZ2VfZW5kcG9pbnQgPSAnaHR0cDovL3d3dy5pZmlza2Uuc2UnO1xuICAgICAgICAkc2NvcGUudGVjaCA9ICRzdGF0ZVBhcmFtcy50ZWNoO1xuICAgICAgICAkc2NvcGUuaW1hZ2VzID0gW107XG5cbiAgICAgICAgaWYgKCEkc2NvcGUudGVjaCkge1xuICAgICAgICAgICAgREIuZ2V0VGVjaG5pcXVlKCRzdGF0ZVBhcmFtcy5pZClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuaW1hZ2VzID0gW2RhdGEuaW1nMSwgZGF0YS5pbWcyLCBkYXRhLmltZzNdLmZpbHRlcihmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIS9cXC8kLy50ZXN0KGVsKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICRpb25pY1NsaWRlQm94RGVsZWdhdGUudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRlY2ggPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9ICRzY29wZS50ZWNoO1xuICAgICAgICAgICAgJHNjb3BlLmltYWdlcyA9IFtkYXRhLmltZzEsIGRhdGEuaW1nMiwgZGF0YS5pbWczXS5maWx0ZXIoZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIS9cXC8kLy50ZXN0KGVsKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkaW9uaWNTbGlkZUJveERlbGVnYXRlLnVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdUZWNobmlxdWVzQ3RybCcsIFsnJHNjb3BlJywgJ0RCJywgZnVuY3Rpb24oJHNjb3BlLCBEQikge1xuXG4gICAgJHNjb3BlLmltYWdlX2VuZHBvaW50ID0gJ2h0dHA6Ly93d3cuaWZpc2tlLnNlJztcbiAgICAkc2NvcGUuc29ydG9yZGVyID0gJ3NvJztcblxuICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgREIuZ2V0VGVjaG5pcXVlcygpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS50ZWNobmlxdWVzID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ1VzZXJDdHJsJywgWyckc2NvcGUnLCAnREInLCBmdW5jdGlvbigkc2NvcGUsIERCKSB7XG4gICAgREIuZ2V0VXNlckluZm8oKVxuICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xuICAgIH0pO1xuICAgIERCLmdldFVzZXJOdW1iZXJzKClcbiAgICAudGhlbihmdW5jdGlvbihudW1iZXJzKSB7XG4gICAgICAgICRzY29wZS5udW1iZXJzID0gbnVtYmVycztcbiAgICB9KTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ1VzZXJDYXJkc0N0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRzdGF0ZVBhcmFtcycsXG4gICAgJ0RCJyxcbiAgICAnVXBkYXRlJyxcbiAgICAnJGlvbmljTW9kYWwnLFxuICAgICckaW9uaWNMb2FkaW5nJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZVBhcmFtcywgREIsIFVwZGF0ZSwgJGlvbmljTW9kYWwsICRpb25pY0xvYWRpbmcpIHtcbiAgICAgICAgJHNjb3BlLnByZWQgPSAnLXRvJztcbiAgICAgICAgJHNjb3BlLmVuZHBvaW50ID0gJ2h0dHBzOi8vd3d3LmlmaXNrZS5zZSc7XG5cbiAgICAgICAgdmFyIGluaXRpbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgICAgICB2YXIgYSA9IFVwZGF0ZS51cGRhdGUoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGEpO1xuICAgICAgICAgICAgYS50aGVuKGZ1bmN0aW9uKGhpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaGkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhLmZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2hlbGxvw6QnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICBEQi5nZXRVc2VyUHJvZHVjdHMoKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3RzID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICAgICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XG4gICAgICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGluaXRpbGl6ZSk7XG4gICAgICAgIC8vdXNlIHRoZSBzYW1lIG1vZGFsIGFzIGluIGFyZWFfY2FyZHNcbiAgICAgICAgJGlvbmljTW9kYWwuZnJvbVRlbXBsYXRlVXJsKCdjb21wb25lbnRzL2FyZWFfY2FyZHMvcnVsZXNfbW9kYWwuaHRtbCcsIHtcbiAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICBhbmltYXRpb246ICdzbGlkZS1pbi11cCdcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihtb2RhbCkge1xuICAgICAgICAgICAgJHNjb3BlLnJ1bGVzX21vZGFsID0gbW9kYWw7XG4gICAgICAgIH0pO1xuICAgICAgICAkc2NvcGUub3BlblJ1bGVzTW9kYWwgPSBmdW5jdGlvbihwcm9kdWN0KSB7XG4gICAgICAgICAgICAkc2NvcGUucnVsZXNfbW9kYWwuc2hvdygpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvZHVjdCk7XG4gICAgICAgICAgICAkc2NvcGUucHJvZHVjdCA9IHByb2R1Y3Q7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5jbG9zZVJ1bGVzTW9kYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5oaWRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGluaXRpbGl6ZSgpO1xuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIsIHVuZGVmaW5lZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdpZmlza2UuYXBpJywgWydpZmlza2UudXRpbHMnXSlcbiAgICAucHJvdmlkZXIoJ0FQSScsIGZ1bmN0aW9uIEFQSVByb3ZpZGVyKCkge1xuXG4gICAgICAgIHRoaXMuYmFzZV91cmwgPSAnaHR0cHM6Ly93d3cuaWZpc2tlLnNlL2FwaS92Mi9hcGkucGhwJztcblxuICAgICAgICB0aGlzLiRnZXQgPSBbXG4gICAgICAgICAgICAnJGh0dHAnLFxuICAgICAgICAgICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAgICAgICAgICdsb2NhbFN0b3JhZ2UnLFxuICAgICAgICAgICAgJyRxJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRodHRwLCBzZXNzaW9uRGF0YSwgbG9jYWxTdG9yYWdlLCAkcSkge1xuICAgICAgICAgICAgICAgIHZhciBiYXNlX3VybCA9IHRoaXMuYmFzZV91cmw7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiAjIGFwaV9jYWxsICNcbiAgICAgICAgICAgICAgICAgKiBoYW5kbGVzIGh0dHAgcmVxdWVzdHNcbiAgICAgICAgICAgICAgICAgKiByZXR1cm5zIGEgJGh0dHAgb2JqZWN0IGZvciB0aGUgcmVxdWVzdGVkIGFwaSBjYWxsXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdmFyIGFwaV9jYWxsID0gZnVuY3Rpb24ocGFyYW1zLCBjYWNoZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkaHR0cChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDonZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBiYXNlX3VybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBhbmd1bGFyLmV4dGVuZChwYXJhbXMsIHsna2V5JzogJ294MDd4aDhhYXlwd3ZxN2EnfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiAoY2FjaGUgIT09IGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvRG86IFByb3BlciBsb2dnaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09PSAnZXJyb3InKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoZGF0YS5kYXRhLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAvLy5lcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZywgc3RhdHVzVGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqICMgc2Vzc2lvbl9hcGlfY2FsbCAjXG4gICAgICAgICAgICAgICAgICogd3JhcHBlciBmb3IgYXBpX2NhbGwgLSBpbnNlcnRzIHRoZSBzZXNzaW9uIHRva2VuIGludG8gcGFyYW1zXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdmFyIHNlc3Npb25fYXBpX2NhbGwgPSBmdW5jdGlvbihwYXJhbXMsIGNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uID0gc2Vzc2lvbkRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChhbmd1bGFyLmV4dGVuZChwYXJhbXMsIHtzOiBzZXNzaW9ufSksIGNhY2hlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0X211bmljaXBhbGl0aWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9tdW5pY2lwYWxpdGllcyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X2NvdW50aWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9jb3VudGllcyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9leGlzdHM6IGZ1bmN0aW9uKHVzZXJuYW1lLCBlbWFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSB7bTogJ3VzZXJfZXhpc3RzJ307XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VybmFtZSAmJiB0eXBlb2YgdXNlcm5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtYWlsICYmIHR5cGVvZiBlbWFpbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLmVtYWlsID0gZW1haWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChhcmdzLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfcmVnaXN0ZXI6IGZ1bmN0aW9uKHVzZXJuYW1lLCBmdWxsbmFtZSwgcGFzc3dvcmQsIGVtYWlsLCBwaG9uZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAndXNlcl9yZWdpc3RlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWU6IGZ1bGxuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGhvbmU6IHBob25lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2NvbmZpcm06IGZ1bmN0aW9uKHVzZXJuYW1lLCBwaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbTogJ3VzZXJfY29uZmlybScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpbjogcGluXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfaW5mbzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbl9hcGlfY2FsbCh7bTogJ3VzZXJfaW5mbyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9sb3N0X3Bhc3N3b3JkOiBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICd1c2VyX2xvc3RfcGFzc3dvcmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkZW50aWZpY2F0aW9uOiB1c2VyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX3Jlc2V0X3Bhc3N3b3JkOiBmdW5jdGlvbih1c2VyX2lkZW50aWZpY2F0aW9uLCBwYXNzd29yZCwgY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtOiAndXNlcl9yZXNldF9wYXNzd29yZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9pZGVudGlmaWNhdGlvbjogdXNlcl9pZGVudGlmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogY29kZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2NoYW5nZV9wYXNzd29yZDogZnVuY3Rpb24ob2xkX3Bhc3N3b3JkLCBuZXdfcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtOiAndXNlcl9jaGFuZ2VfcGFzc3dvcmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZF9wYXNzd29yZDogb2xkX3Bhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19wYXNzd29yZDogbmV3X3Bhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfbG9naW46IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAndXNlcl9sb2dpbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uRGF0YS5zZXRUb2tlbihkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25lZWRlZCBmb3IgY2hhaW5pbmcgb2YgcHJvbWlzZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfbG9nb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9sb2dvdXQnfSwgZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uRGF0YS5kZWxldGVUb2tlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfcHJvZHVjdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXBpX2NhbGwoe206ICd1c2VyX3Byb2R1Y3RzJ30sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X2Zpc2hlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfZmlzaGVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfdGVjaG5pcXVlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfdGVjaG5pcXVlcyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X2JhaXRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9iYWl0cyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X29yZ2FuaXphdGlvbnM6IGZ1bmN0aW9uKG9yZ2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfb3JnYW5pemF0aW9ucycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2lkOiBvcmdpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfb3JnX21vZGlmaWVkOiBmdW5jdGlvbihvcmdpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X29yZ19tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2lkOiBvcmdpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfYXJlYXM6IGZ1bmN0aW9uKGFyZWFpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X2FyZWFzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlYWlkOiBhcmVhaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X2FyZWFzX21vZGlmaWVkOiBmdW5jdGlvbihhcmVhaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bTogJ2dldF9hcmVhc19tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFpZDogYXJlYWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9wcm9kdWN0czogZnVuY3Rpb24oYXJlYWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfcHJvZHVjdHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhaWQ6IGFyZWFpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfcnVsZXM6IGZ1bmN0aW9uKHJ1bGVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X3J1bGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZWlkOiBydWxlaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X3Bob3RvczogZnVuY3Rpb24ob3JnaWQsIGFyZWFpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X3Bob3RvcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2lkOiBvcmdpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlYWlkOiBhcmVhaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X21hcF9wb2lzOiBmdW5jdGlvbihvcmdpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X21hcF9wb2lzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnaWQ6IG9yZ2lkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9tYXBfcG9pX3R5cGVzIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfbWFwX3BvaV90eXBlcyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X21hcF9wb2x5Z29uczogZnVuY3Rpb24ob3JnaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bTogJ2dldF9tYXBfcG9seWdvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmdpZDogb3JnaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9nZXRfZmF2b3JpdGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9nZXRfZmF2b3JpdGVzJ30sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9hZGRfZmF2b3JpdGU6IGZ1bmN0aW9uKGFyZWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRmxhZyAwIG1lYW5zIHRvIG5vdCBnZXQgbm90aWZpY2F0aW9ucyBvbiBjYXRjaCByZXBvcnRzXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbl9hcGlfY2FsbCh7bTogJ3VzZXJfYWRkX2Zhdm9yaXRlJywgYXJlYWlkOiBhcmVhLCBmbGFnOiAwfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX3NldF9mYXZvcml0ZV9ub3RpZmljYXRpb246IGZ1bmN0aW9uKGFyZWEsIGZsYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmbGFnID8gMSA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbl9hcGlfY2FsbCh7bTogJ3VzZXJfc2V0X2Zhdm9yaXRlX25vdGlmaWNhdGlvbicsIGFyZWFpZDogYXJlYSwgZmxhZzogZmxhZ30sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9yZW1vdmVfZmF2b3JpdGU6IGZ1bmN0aW9uKGFyZWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9yZW1vdmVfZmF2b3JpdGUnLCBhcmVhaWQ6IGFyZWF9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF90ZXJtc19vZl9zZXJ2aWNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF90ZXJtc19vZl9zZXJ2aWNlJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfY29udGFjdF9pbmZvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9jb250YWN0X2luZm8nfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9lbmdpbmVfcG9saWNpZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X2VuZ2luZV9wb2xpY2llcyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X3Ntc190ZXJtczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfc21zX3Rlcm1zJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfbWFwYm94X2FwaTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfbWFwYm94X2FwaWFjY2Vzc3Rva2VuJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfY29udGVudF9tZW51OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9jb250ZW50X21lbnUnfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfV07XG4gICAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG4iLCIoZnVuY3Rpb24oYW5ndWxhciwgdW5kZWZpbmVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5kYicsIFtdKVxuICAgIC5wcm92aWRlcignREInLCBmdW5jdGlvbiBEQlByb3ZpZGVyKCkge1xuXG4gICAgICAgIHRoaXMuJGdldCA9IFtcbiAgICAgICAgICAgICckY29yZG92YVNRTGl0ZScsXG4gICAgICAgICAgICAnQVBJJyxcbiAgICAgICAgICAgICckcScsXG4gICAgICAgICAgICAnJHJvb3RTY29wZScsXG4gICAgICAgICAgICBmdW5jdGlvbigkY29yZG92YVNRTGl0ZSwgQVBJLCAkcSwgJHJvb3RTY29wZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGRiO1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuc3FsaXRlUGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgICAgIGRiID0gJGNvcmRvdmFTUUxpdGUub3BlbkRCKCdmaXNrZWJhc2VuLmRiJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cub3BlbkRhdGFiYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRiID0gd2luZG93Lm9wZW5EYXRhYmFzZShcbiAgICAgICAgICAgICAgICAgICAgICAgICdmaXNrZWJhc2VuLmRiJywgJzEuMCcsICdmaXNrZWJhc2VuJywgMTAgKiAxMDI0ICogMTAyNCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UsIHNvcnJ5Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHRhYmxlRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAnQXJlYSc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ29yZ2lkJywgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2t3JywgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbm90ZScsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjMScsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYzInLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2MzJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtMScsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbTInLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ20zJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydsYXQnLCAgICdyZWFsJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xuZycsICAgJ3JlYWwnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnem9vbScsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydwbnQnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY2FyJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2VuZycsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydoY3AnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbWFwJywgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd3c2MnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbW9kJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnQXJlYV9GaXNoJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2FpZCcsICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydmaWQnLCAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYW1vdW50JywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NvbW1lbnQnLCAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnUHJvZHVjdCc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0MicsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydubycsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpbScsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydwZicsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydhaScsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3JpJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY2gnLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydwcmljZScsICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ21vZCcsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnc28nLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydobCcsICAgICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdDb3VudHknOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3MnLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ011bmljaXBhbGl0eSc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NJRCcsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyduYW1lJywgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ0Zpc2gnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbW9kJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3NvJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtYXgnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnaWNvbicsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpbWcnLCAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2luJywgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZ2VvJywgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydzaXplJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xhdCcsICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncmVjJywgICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdSdWxlJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd2ZXInLCAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydkJywgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1VzZXJfUHJvZHVjdCc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydhdCcsICAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NvZGUnLCAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZnInLCAgICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydmdWxsbmFtZScsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydvdCcsICAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydyZWYxJywgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3JlZjInLCAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndG8nLCAgICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydwaWQnLCAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3BkZicsICAgICAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1VzZXJfSW5mbyc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd1c2VybmFtZScsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydsb2dnZWRpbicsICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydJUDEnLCAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydJUDInLCAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyduYW1lJywgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydlbWFpbCcsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjcmVhdGVkJywgICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdVc2VyX051bWJlcic6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbnVtYmVyJywgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnVXNlcl9GYXZvcml0ZSc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydhJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2FkZCcsICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbm90JywgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjbnQnLCAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdUZWNobmlxdWUnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnc28nLCAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2RlJywgICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZGEnLCAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpY29uJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ltZzEnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnaW1nMicsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpbWczJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3lvdXR1YmUnLCAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnT3JnYW5pemF0aW9uJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NwJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3VybCcsICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NvJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbW9kJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd2YXQnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2RwJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZnZhJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydvcmcnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ21sJywgICAgICdpbnQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnUG9pJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ29yZ2lkJywgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndHlwZScsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydwcmljZScsICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xhJywgICAgICdyZWFsJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xvJywgICAgICdyZWFsJ11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1BvaV9UeXBlJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ljb24nLCAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdQb2x5Z29uJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ29yZ2lkJywgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYycsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndmVyJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtb2QnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3BvbHknLCAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ05ld3MnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndGV4dCcsICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdXG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGNyZWF0ZU9iamVjdCA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHZhbCA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEucm93cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dmFsLnB1c2goZGF0YS5yb3dzLml0ZW0oaSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXR2YWw7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlVGFibGU6IGZ1bmN0aW9uKHRhYmxlLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIudHJhbnNhY3Rpb24oZnVuY3Rpb24odHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHguZXhlY3V0ZVNxbCgnREVMRVRFIEZST00gJyArIHRhYmxlICsgJzsnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpZCBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2luZ2xlRGF0YSA9IGRhdGFbaWRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluc2VydERhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGVEZWZbdGFibGVdLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0RGF0YS5wdXNoKHNpbmdsZURhdGFbdGFibGVEZWZbdGFibGVdW2ldWzBdXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0lOU0VSVCBJTlRPJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVkFMVUVTKD8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcsPycucmVwZWF0KGluc2VydERhdGEubGVuZ3RoIC0gMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHguZXhlY3V0ZVNxbChxdWVyeSwgaW5zZXJ0RGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgY2xlYW5UYWJsZTogZnVuY3Rpb24odGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYi50cmFuc2FjdGlvbihmdW5jdGlvbih0eCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eC5leGVjdXRlU3FsKCdERUxFVEUgRlJPTSAnICsgdGFibGUgKyAnOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIERyb3BzIGFsbCB0YWJsZXMgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgY2xlYW5cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGNsZWFuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYi50cmFuc2FjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24odHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHRhYmxlIGluIHRhYmxlRGVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHguZXhlY3V0ZVNxbCgnRFJPUCBUQUJMRSBJRiBFWElTVFMgJyArIHRhYmxlICsgJzsnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmVtb3ZlZCBhbGwgdGFibGVzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogSW5pdGlhbGllcyB0aGUgdGFibGVzIGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGluaXRcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiLnRyYW5zYWN0aW9uKGZ1bmN0aW9uKHR4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHQgaW4gdGFibGVEZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9IHRhYmxlRGVmW3RdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlVmFsdWVzID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBCdWlsZHMgYSBzdHJpbmcgd2l0aCBcIlwiIGFyb3VuZCBhbGwgbmFtZXMsIHNvIHRoYXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGl0IGNhbiBiZSB1c2VkIHRvIGNyZWF0ZSBhbiBTUUwgVGFibGUgd2l0b3V0IGhhdmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogdG8gd29ycnkgYWJvdXQgdXNpbmcgcmVzZXJ2ZWQga2V5d29yZHMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGUubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVZhbHVlcy5wdXNoKCdcIicgKyB0YWJsZVtpXVswXSArICdcIiAnICsgdGFibGVbaV1bMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVWYWx1ZXMgPSB0YWJsZVZhbHVlcy5qb2luKCcsICcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVZhbHVlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLCBQUklNQVJZIEtFWSgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcIicgKyB0YWJsZVswXVswXSArICdcIicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJykpOydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHguZXhlY3V0ZVNxbChxdWVyeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG5cblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogR2V0cyBpbmZvcm1hdGlvbiBhYm91dCBhbiBhcmVhXG4gICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgZ2V0QXJlYVxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IGlkXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBnZXRBcmVhOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCBBcmVhLiosJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NBU0UgV0hFTiBVc2VyX0Zhdm9yaXRlLklEIElTIE5VTEwgVEhFTiAwIEVMU0UgMSBFTkQgYXMgZmF2b3JpdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBBcmVhJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0xFRlQgSk9JTiBVc2VyX0Zhdm9yaXRlIE9OIFVzZXJfRmF2b3JpdGUuYSA9IEFyZWEuSUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgQXJlYS5JRCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIEFycmF5LmlzQXJyYXkoaWQpID8gaWQgOiBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGFyZWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJlYSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSBjcmVhdGVPYmplY3QoYXJlYSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETzogREIgc2hvdWxkIG5vdCBuZWVkIEFQSVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuaW1hZ2VzID0gQVBJLmdldF9waG90b3Mob2JqZWN0Lm9yZ2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChvYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRBcmVhRmlzaGVzOiBmdW5jdGlvbihhaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIEFyZWFfRmlzaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdKT0lOIEZpc2ggT04gQXJlYV9GaXNoLmZpZCA9IEZpc2guSUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgQXJlYV9GaXNoLmFpZCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIFthaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogU2VhcmNoZXMgdGhlIGRhdGFiYXNlIHVzaW5nIGEgcXVlcnlcbiAgICAgICAgICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAgICAgICAgICogVGhlIHF1ZXJ5IGlzIG1hdGNoZWQgdG8gYSBuYW1lIGFuZC9vciBrZXl3b3JkXG4gICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2Qgc2VhcmNoXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWFyY2hzdHJpbmdcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaDogZnVuY3Rpb24oc2VhcmNoc3RyaW5nLCBjb3VudHlfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgQXJlYS4qLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDQVNFIFdIRU4gVXNlcl9GYXZvcml0ZS5JRCBJUyBOVUxMIFRIRU4gMCBFTFNFIDEgRU5EIGFzIGZhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZST00gQXJlYScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMRUZUIEpPSU4gVXNlcl9GYXZvcml0ZSBPTiBVc2VyX0Zhdm9yaXRlLmEgPSBBcmVhLklEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIHQgTElLRSA/JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvdW50eV9pZCA/ICdBTkQgPyBJTiAoYzEsYzIsYzMpJyA6ICcnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ09SREVSIEJZIHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnR5X2lkID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyclJyArIHNlYXJjaHN0cmluZyArICclJywgY291bnR5X2lkXSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnJScgKyBzZWFyY2hzdHJpbmcgKyAnJSddKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICogR2V0cyBpbmZvcm1hdGlvbiBhYm91dCBhIHByb2R1Y3RcbiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBnZXRQcm9kdWN0XG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gcHJvZHVjdF9pZFxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZ2V0UHJvZHVjdDogZnVuY3Rpb24ocHJvZHVjdF9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCBESVNUSU5DVCBQcm9kdWN0LiosJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1J1bGUudCBhcyBydWxlX3QsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1J1bGUudmVyIGFzIHJ1bGVfdmVyLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLmQgYXMgcnVsZV9kJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZST00gUHJvZHVjdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdKT0lOIFJ1bGUgT04gUnVsZS5JRCA9IFByb2R1Y3QucmknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgSUQgPSA/JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ09SREVSIEJZIHNvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtwcm9kdWN0X2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEdldHMgYWxsIHByb2R1Y3RzIGZyb20gYW4gYXJlYVxuICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGdldFByb2R1Y3RzQnlBcmVhXG4gICAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gYXJlYV9pZFxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZ2V0UHJvZHVjdHNCeUFyZWE6IGZ1bmN0aW9uKGFyZWFfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgRElTVElOQ1QgUHJvZHVjdC4qLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnQgYXMgcnVsZV90LCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnZlciBhcyBydWxlX3ZlciwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS5kIGFzIHJ1bGVfZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFByb2R1Y3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSk9JTiBSdWxlIE9OIFJ1bGUuSUQgPSBQcm9kdWN0LnJpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIGFpID0gPycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPUkRFUiBCWSBzbydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYXJlYV9pZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldENvdW50aWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgRElTVElOQ1QgQ291bnR5LionLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBDb3VudHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSk9JTiBBcmVhIE9OIEFyZWEuYzEgPSBDb3VudHkuSUQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnT1JERVIgQlkgQ291bnR5LnQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXJQcm9kdWN0czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIFVzZXJfUHJvZHVjdC4qLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnQgYXMgcnVsZV90LCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnZlciBhcyBydWxlX3ZlciwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS5kIGFzIHJ1bGVfZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFVzZXJfUHJvZHVjdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMRUZUIEpPSU4gUHJvZHVjdCBPTiBQcm9kdWN0LklEID0gVXNlcl9Qcm9kdWN0LnBpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMRUZUIEpPSU4gUnVsZSBPTiBSdWxlLklEID0gUHJvZHVjdC5yaSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0RmlzaGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKiBGUk9NIEZpc2gnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldEZpc2g6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUICogRlJPTSBGaXNoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIGlkID0gPydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0VGVjaG5pcXVlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUICogRlJPTSBUZWNobmlxdWUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRUZWNobmlxdWU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUICogRlJPTSBUZWNobmlxdWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgSUQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSlbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0T3JnYW5pemF0aW9uOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCAqIEZST00gT3JnYW5pemF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIElEID0gPydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXJJbmZvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFVzZXJfSW5mbydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KHVzZXIpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXJOdW1iZXJzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFVzZXJfTnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXNlckZhdm9yaXRlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIConLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBVc2VyX0Zhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0pPSU4gQXJlYSBPTiBVc2VyX0Zhdm9yaXRlLmEgPSBBcmVhLklEJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICByZW1vdmVGYXZvcml0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdERUxFVEUgRlJPTSBVc2VyX0Zhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIGEgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0UG9pczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBvcmdpZCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIFtpZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldFBvaVR5cGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvaV9UeXBlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRQb2x5Z29uczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvbHlnb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgb3JnaWQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXROZXdzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIE5ld3MnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXROZXdzSXRlbTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIE5ld3MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgSUQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmZpbHRlcnMnLCBbXSlcbi5maWx0ZXIoJ29uZWJyJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC8oPGJyPlxccyopKy9nLCAnPGJyPicpO1xuICAgIH07XG59KVxuLmZpbHRlcignbm9icnMnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoLyg8YnIoXFxzKlxcLykqPikrL2csICcnKTtcbiAgICB9O1xufSlcbi5maWx0ZXIoJ2NsZWFudGFibGVzJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvKDxcXC8/dGFibGU+KSsvZywgJycpO1xuICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoLyg8XFwvP3RyPikrL2csICcnKTtcbiAgICAgICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC8oPFxcLz90aD4pKy9nLCAnJyk7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvKDwoXFwvPyl0ZC4qPz4pKz8vZywgJzwkMnA+Jyk7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvPHA+XFxzKjxcXC9wPi9nLCAnJyk7XG4gICAgICAgIHJldHVybiBpbnB1dDtcbiAgICB9O1xufSk7XG4iLCIoZnVuY3Rpb24oYW5ndWxhciwgdW5kZWZpbmVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS51cGRhdGUnLCBbJ2lmaXNrZS5hcGknLCAnaWZpc2tlLmRiJywgJ2lmaXNrZS51dGlscyddKVxuICAgIC5wcm92aWRlcignVXBkYXRlJywgZnVuY3Rpb24gVXBkYXRlUHJvdmlkZXIoKSB7XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gW1xuICAgICAgICAgICAgJ0FQSScsXG4gICAgICAgICAgICAnREInLFxuICAgICAgICAgICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgICAgICAgICAnJHEnLFxuICAgICAgICAgICAgJyRpb25pY0xvYWRpbmcnLFxuICAgICAgICAgICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKEFQSSwgREIsIGxvY2FsU3RvcmFnZSwgJHEsICRpb25pY0xvYWRpbmcsIHNlc3Npb25EYXRhKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgTEFTVF9VUERBVEUgPSAnbGFzdF91cGRhdGUnO1xuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ3VzZXJfcHJvZHVjdHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVXNlcl9Qcm9kdWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICd1c2VyX2dldF9mYXZvcml0ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVXNlcl9GYXZvcml0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAndXNlcl9pbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlcl9JbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXJfTnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVycyA9IGRhdGEubnVtYmVycztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bUFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUFyci5wdXNoKHsnbnVtYmVyJzogbnVtYmVyc1tpXX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5hbGwoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREIucG9wdWxhdGVUYWJsZSgnVXNlcl9JbmZvJywgW2RhdGFdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdVc2VyX0luZm8nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ1VzZXJfTnVtYmVyJywgbnVtQXJyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdVc2VyX051bWJlcnMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB0aW1lZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X2FyZWFzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXNoQXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlzaGVzID0gZGF0YVtrZXldLmZpc2g7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmaXNoS2V5IGluIGZpc2hlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpc2hBcnIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJRCc6IGtleSArICdfJyArIGZpc2hLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZDogZmlzaEtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogZmlzaGVzW2Zpc2hLZXldWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50OiBmaXNoZXNbZmlzaEtleV1bMV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEuYWxsKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ0FyZWEnLCBkYXRhKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ0FyZWFfRmlzaCcsIGZpc2hBcnIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdBcmVhJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9wcm9kdWN0cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGU6ICdQcm9kdWN0J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9jb3VudGllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGU6ICdDb3VudHknXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X211bmljaXBhbGl0aWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ011bmljaXBhbGl0eSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfZmlzaGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ0Zpc2gnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X3J1bGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ1J1bGUnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X3RlY2huaXF1ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVGVjaG5pcXVlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9vcmdhbml6YXRpb25zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ09yZ2FuaXphdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfbWFwX3BvaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnUG9pJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9tYXBfcG9pX3R5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ1BvaV9UeXBlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9tYXBfcG9seWdvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnUG9seWdvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgYWx3YXlzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfY29udGVudF9tZW51JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXQoJ05FV1MnLCBkYXRhLnRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERCLnBvcHVsYXRlVGFibGUoJ05ld3MnLCBkYXRhLmNvbnRlbnRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTmV3cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfdGVybXNfb2Zfc2VydmljZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9uYW1lOiAndG9zJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9zbXNfdGVybXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VfbmFtZTogJ3Ntc190ZXJtcydcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfY29udGFjdF9pbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlX25hbWU6ICdjb250YWN0SW5mbydcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfbWFwYm94X2FwaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9uYW1lOiAnbWFwYm94X2FwaSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgdGltZWRVcGRhdGUgPSBmdW5jdGlvbihjdXJyZW50VGltZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXN0VXBkYXRlID0gbG9jYWxTdG9yYWdlLmdldChMQVNUX1VQREFURSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFXZWVrID0gMTAwMCAqIDM2MDAgKiAyNCAqIDc7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlKSA+IGFXZWVrO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9wdWxhdGUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQVBJW2l0ZW0uZW5kcG9pbnRdKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aGVuO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0uZiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhlbiA9IGl0ZW0uZjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVuID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEQi5wb3B1bGF0ZVRhYmxlKGl0ZW0udGFibGUsIGRhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRhYmxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IHdoYXQgaWYgd2UgbmVlZCB0byByZW1ha2UgdGhlIHRhYmxlcz9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5zdG9yYWdlX25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoZW4gPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldChpdGVtLnN0b3JhZ2VfbmFtZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHAudGhlbih0aGVuKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05PIEFDVElPTiEnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5Vc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdXBkYXRlcy5hdXRoLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1cGRhdGVzLmF1dGhbaV0udGFibGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB1cGRhdGVzLmF1dGhbaV0udGFibGUubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5wdXNoKERCLmNsZWFuVGFibGUodXBkYXRlcy5hdXRoW2ldLnRhYmxlW2pdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLnB1c2goREIuY2xlYW5UYWJsZSh1cGRhdGVzLmF1dGhbaV0udGFibGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEuYWxsKHApXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbW92ZWQgdXNlciBpbmZvIGZyb20gZGF0YWJhc2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ291bGQgbm90IHJlbW92ZSB1c2VyIGRhdGEgZnJvbSBkYXRhYmFzZSEnLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZUZ1bmMgPSBmdW5jdGlvbihmb3JjZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2VzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNob3VsZFVwZGF0ZSA9IChmb3JjZWQgfHwgdGltZWRVcGRhdGUoY3VycmVudFRpbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIERCLmluaXQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0luaXRpYWxpemVkIERCIHN5c3RlbScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdXBkYXRlcy5hbHdheXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChwb3B1bGF0ZSh1cGRhdGVzLmFsd2F5c1tpXSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbkRhdGEudG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHVwZGF0ZXMuYXV0aC5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChwb3B1bGF0ZSh1cGRhdGVzLmF1dGhbaV0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB1cGRhdGVzLnRpbWVkLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHBvcHVsYXRlKHVwZGF0ZXMudGltZWRbaV0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbihzdHVmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUG9wdWxhdGVkOicsIHN0dWZmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldChMQVNUX1VQREFURSwgY3VycmVudFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoJ1Bhc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVyci5lcnJvcl9jb2RlID09PSA3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBmYWlsdXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBTaG93IHRvIHVzZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFuVXNlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVBJLnVzZXJfbG9nb3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ2F1dGggZmFpbHVyZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdHb3QgYW4gZXJyb3IsIHJlY3JlYXRlIGFsbCB0YWJsZXM6JywgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEQi5jbGVhbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbih1cGRhdGVGdW5jKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlRnVuYygpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGZvcmNlZFVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlRnVuYyh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICB1c2VyX2xvZ291dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhblVzZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBBUEkudXNlcl9sb2dvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9sb2dpbjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQVBJLnVzZXJfbG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRnVuYygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0KExBU1RfVVBEQVRFKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLnV0aWxzJywgW10pXG5cbi5mYWN0b3J5KCdsb2NhbFN0b3JhZ2UnLCBbJyR3aW5kb3cnLCBmdW5jdGlvbigkd2luZG93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgICAgfVxuICAgIH07XG59XSlcbi5zZXJ2aWNlKCdzZXNzaW9uRGF0YScsIFsnbG9jYWxTdG9yYWdlJywgZnVuY3Rpb24obG9jYWxTdG9yYWdlKSB7XG4gICAgdGhpcy50b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXQoJ3Nlc3Npb24nKTtcblxuICAgIHRoaXMuc2V0VG9rZW4gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXQoJ3Nlc3Npb24nLCB0KTtcbiAgICAgICAgdGhpcy50b2tlbiA9IHQ7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0b2tlbiBzZXQnKTtcbiAgICB9O1xuICAgIHRoaXMuZGVsZXRlVG9rZW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZSgnc2Vzc2lvbicpO1xuICAgICAgICB0aGlzLnRva2VuID0gbnVsbDtcbiAgICAgICAgY29uc29sZS5sb2coJ3Rva2VuIHVuc2V0Jyk7XG4gICAgfTtcbn1dKVxuXG4uZmFjdG9yeSgnTGljZW5zZXMnLCBbXG4gICAgJyRodHRwJyxcbiAgICBmdW5jdGlvbigkaHR0cCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdzdGF0aWMvbGljZW5zZXMuanNvbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ25nQ29yZG92YVNtcycsIFtdKVxuLmRpcmVjdGl2ZSgnbmdDb3Jkb3ZhU21zJywgWyckY29yZG92YVNtcycsICckaW9uaWNQb3B1cCcsIGZ1bmN0aW9uKCRjb3Jkb3ZhU21zLCAkaW9uaWNQb3B1cCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xuICAgICAgICAgICAgZWwub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAkaW9uaWNQb3B1cC5wcm9tcHQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Nrcml2IGluIGRpdHQgbmFtbicsXG4gICAgICAgICAgICAgICAgICAgIGlucHV0VHlwZTogJ3RleHQnXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJ0ZJU0tBICcgKyBhdHRycy5uZ0NvcmRvdmFTbXMgKyAnICcgKyBuYW1lO1xuICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNtcy5zZW5kKCc3MjQ1NicsIG1lc3NhZ2UsICdJTlRFTlQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWNjdWVzcycpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5kaXJlY3RpdmVzJylcbiAgICAuZGlyZWN0aXZlKCdpZmlza2VJbnB1dCcsIGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4ge1xuXHQgICAgcmVzdHJpY3Q6ICdFJyxcblx0ICAgIHRyYW5zY2x1ZGU6IHRydWUsXG5cblx0ICAgIHNjb3BlOiB7XG5cdFx0bmFtZTogJ0AnLFxuXHRcdGlkOiAnQCcsXG5cdFx0bGFiZWw6ICdAJyxcblx0XHRwbGFjZWhvbGRlcjogJ0AnLFxuXHRcdHR5cGU6ICdAJyxcblx0XHRuZ1BhdHRlcm46ICdAJyxcblx0XHRuZ01vZGVsOiAnPT8nXG5cblx0ICAgIH0sXG5cdCAgICB0ZW1wbGF0ZVVybDogJ2RpcmVjdGl2ZXMvaW5wdXRfZmllbGQvaWZpc2tlX2lucHV0Lmh0bWwnLFxuXHQgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlKSB7XG5cdFx0JHNjb3BlLmlkID0gJHNjb3BlLmlkIHx8ICRzY29wZS5uYW1lO1xuXHRcdCRzY29wZS50eXBlID0gJHNjb3BlLnR5cGUgfHwgJ3RleHQnO1xuXHQgICAgfVxuXHR9XG4gICAgfSlcbiIsImFuZ3VsYXIubW9kdWxlKCdzeXN0ZW1Ccm93c2VyJywgW10pXG4uZGlyZWN0aXZlKCdzeXN0ZW1Ccm93c2VyJywgWyckY29yZG92YUluQXBwQnJvd3NlcicsIGZ1bmN0aW9uKCRjb3Jkb3ZhSW5BcHBCcm93c2VyKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzKSB7XG4gICAgICAgICAgICBlbC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgJGNvcmRvdmFJbkFwcEJyb3dzZXIub3BlbihlbFswXS5ocmVmLCAnX3N5c3RlbScpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1dKVxuLmRpcmVjdGl2ZSgnZ2xvYmFsU3lzdGVtQnJvd3NlcicsIFsnJGNvcmRvdmFJbkFwcEJyb3dzZXInLCBmdW5jdGlvbigkY29yZG92YUluQXBwQnJvd3Nlcikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xuICAgICAgICAgICAgZWwub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5ocmVmICYmIGUudGFyZ2V0Lmhvc3QgIT09IHdpbmRvdy5sb2NhdGlvbi5ob3N0KSB7XG4gICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhSW5BcHBCcm93c2VyLm9wZW4oZS50YXJnZXQuaHJlZiwgJ19zeXN0ZW0nKTtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1dKTtcbiIsIi8qYW5ndWxhci5tb2R1bGUoJ3RyZWVUYWJzJywgWydpb25pYyddKVxuICAgIC5kaXJlY3RpdmUoJ2lvblRhYnMnLCBbJyRyb290U2NvcGUnLCckc3RhdGUnLCckaW9uaWNIaXN0b3J5JywnJGlvbmljVmlld1N3aXRjaGVyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHN0YXRlLCAkaW9uaWNIaXN0b3J5LCAkaW9uaWNWaWV3U3dpdGNoZXIpIHtcblx0ZnVuY3Rpb24gZ2V0VGFiUm9vdFN0YXRlKHN0YXRlKSB7XG5cdCAgICB2YXIgaXNSb290U3RhdGU7XG5cblx0ICAgIGlmIChzdGF0ZS5wYXJlbnQuc2VsZi5hYnN0cmFjdCkge1xuXHRcdGlzUm9vdFN0YXRlID0gc3RhdGUuc2VsZi5uYW1lO1xuXHQgICAgfSBlbHNlIHtcblx0XHRpc1Jvb3RTdGF0ZSA9IGZhbHNlO1xuXHQgICAgfVxuXG5cdCAgICByZXR1cm4gIGlzUm9vdFN0YXRlIHx8IGdldFRhYlJvb3RTdGF0ZShzdGF0ZS5wYXJlbnQpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNUYWJSb290U3RhdGUoc3RhdGUpIHtcblx0ICAgIHJldHVybiBzdGF0ZS5zZWxmLm5hbWUgPT09IGdldFRhYlJvb3RTdGF0ZShzdGF0ZSk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHQgICAgcmVzdHJpY3Q6ICdFQScsXG5cdCAgICByZXF1aXJlOiAnaW9uVGFicycsXG5cdCAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xuXHRcdGNvbnNvbGUubG9nKCdzOiAnLHNjb3BlKTtcblx0XHRjb25zb2xlLmxvZygnZTogJyxlbGVtZW50KTtcblx0XHRjb25zb2xlLmxvZygnYTogJyxhdHRyKTtcblx0XHRjb25zb2xlLmxvZygnYzogJyxjdHJsKTtcblx0XHR2YXIgc2VsZWN0VGFiID0gY3RybC5zZWxlY3Q7XG5cdFx0Y3RybC5zZWxlY3QgPSBmdW5jdGlvbih0YWIsIHNob3VsZEVtaXRFdmVudCkge1xuXHRcdCAgICB2YXIgc2VsZWN0ZWRUYWIgPSBjdHJsLnNlbGVjdGVkVGFiKCk7XG5cblx0XHQgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcblx0XHRcdHNob3VsZEVtaXRFdmVudCA9ICEhKHRhYi5uYXZWaWV3TmFtZSB8fCB0YWIudWlTcmVmKTtcblx0XHQgICAgfVxuXG5cdFx0ICAgIGlmIChzZWxlY3RlZFRhYiAmJiBzZWxlY3RlZFRhYi4kaGlzdG9yeUlkID09IHRhYi4kaGlzdG9yeUlkICYmICFpc1RhYlJvb3RTdGF0ZSgkc3RhdGUuJGN1cnJlbnQpKSB7XG5cdFx0XHRpZiAoc2hvdWxkRW1pdEV2ZW50KSB7XG5cdFx0XHQgICAgJGlvbmljSGlzdG9yeS5uZXh0Vmlld09wdGlvbnMoe1xuXHRcdFx0XHRkaXNhYmxlQmFjazogdHJ1ZSxcblx0XHRcdFx0aGlzdG9yeVJvb3Q6IGZhbHNlXG5cdFx0XHQgICAgfSk7XG5cdFx0XHQgICAgJGlvbmljVmlld1N3aXRjaGVyLm5leHREaXJlY3Rpb24oJ2JhY2snKTtcblx0XHRcdCAgICAkc3RhdGUuZ28oZ2V0VGFiUm9vdFN0YXRlKCRzdGF0ZS4kY3VycmVudCkpO1xuXHRcdFx0fVxuXHRcdCAgICB9IGVsc2UgaWYgKHNlbGVjdGVkVGFiICYmIHNlbGVjdGVkVGFiLiRoaXN0b3J5SWQgPT0gdGFiLiRoaXN0b3J5SWQgJiYgaXNUYWJSb290U3RhdGUoJHN0YXRlLiRjdXJyZW50KSkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdCAgICB9IGVsc2Uge1xuXHRcdFx0c2VsZWN0VGFiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0ICAgIH1cblx0XHR9O1xuXHQgICAgfVxuXHR9O1xuICAgIH1dKTtcbiovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=