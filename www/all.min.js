// angular.module is a global place for creating, registering and retrieving Angular modules
// 'ifiske' is the name of this angular module (also set in a <body> attribute in index.html)
// the 2nd parameter is an array of 'requires'
// 'ifiske.controllers' is found in controllers.js

angular.module('ifiske', [
    'ionic',
    'ifiske.controllers',
    'ifiske.directives',
    'ifiske.api',
    'ifiske.db',
    'ifiske.utils',
    'ifiske.update',
    'ifiske.filters',
    'ionic.ion.headerShrink',
    'ngCordova',
    'systemBrowser',
    'ngCordovaSms',
    'ngMessages',
    'ImgCache',
    'leaflet-directive',
    'tabSlideBox'
])

.constant('$ionicLoadingConfig', {
    template: '<ion-spinner></ion-spinner>'
    // hideOnStateChange: true
})
.run([
    '$ionicPlatform',
    'Update',
    'ImgCache',
    '$rootScope',
    function($ionicPlatform, Update, ImgCache, $rootScope) {

        $rootScope.image_endpoint = 'http://www.ifiske.se';
        $ionicPlatform.ready(function() {
            // Hide the accessory bar above the keyboard for form inputs
            if (window.ionic && window.ionic.Keyboard) {
                window.ionic.Keyboard.hideKeyboardAccessoryBar(true);
            }
            if (window.StatusBar) {
                // org.apache.cordova.statusbar required
                window.StatusBar.styleDefault();
            }

            ImgCache.$init();
            Update.update();
        });
    }
])

.config([
    '$stateProvider',
    '$urlRouterProvider',
    '$ionicConfigProvider',
    'ImgCacheProvider',
    function($stateProvider, $urlRouterProvider, $ionicConfigProvider, ImgCacheProvider) {

        ImgCacheProvider.setOptions({
            debug: false,
            usePersistentCache: true
        });
        ImgCacheProvider.manualInit = true;

        //Disable swipe to go back since it is bugged
        $ionicConfigProvider.views.swipeBackEnabled(false);

        // Cache views in the forward stack
        $ionicConfigProvider.views.forwardCache(true);

        // Clear back button default text
        $ionicConfigProvider.backButton.previousTitleText(false).text('');

        // Tabs position
        $ionicConfigProvider.tabs.position('bottom');

        /**
         * Ionic uses AngularUI Router. Learn more here:
         * https://github.com/angular-ui/ui-router
         */

        var defaultUrl = '/app/login';
        if (window.localStorage.getItem('session')) {
            defaultUrl = '/app/home';
        }
        $urlRouterProvider.otherwise(defaultUrl);

        $stateProvider

        .state('app', {
            url: '/app',
            //abstract: true,
            templateUrl: 'components/menu/menu.html',
            controller: 'MenuCtrl'
        })

        .state('app.login', {
            url: '/login',
            templateUrl: 'components/login/login.html',
            controller: 'LoginCtrl'
        })

        // Account recovery
        .state('app.recover', {
            url: '/recover',
            templateUrl: 'components/recover/recover.html',
            controller: 'RecoverCtrl'
        })
        .state('app.recover.lostpassword', {
            url: '/lostpassword',
            templateUrl: 'components/recover/lostpassword.html'
        })
        .state('app.recover.resetpassword', {
            url: '/resetpassword',
            templateUrl: 'components/recover/resetpassword.html'
        })

        // Account registration
        .state('app.register', {
            url: '/register',
            templateUrl: 'components/register/register.html',
            controller: 'RegisterCtrl'
        })
        .state('app.register.details', {
            url: '/details',
            templateUrl: 'components/register/register_details.html'
        })
        .state('app.register.verify', {
            url: '/verify',
            templateUrl: 'components/register/register_verify.html'
        })

        //
        .state('app.home', {
            url: '/home',
            templateUrl: 'components/home/home.html',
            controller: 'HomeCtrl'
        })
        .state('app.info', {
            url: '/info',
            templateUrl: 'components/info/info.html'
        })

        .state('app.bugs', {
            url: '/info',
            templateUrl: 'components/menu/report.html'
        })
        .state('app.contact', {
            url: '/contact',
            templateUrl: 'components/contact/contact.html',
            controller: 'ContactCtrl'
        })
        .state('app.legal', {
            url: '/legal',
            templateUrl: 'components/legal/legal.html',
            controller: 'LegalCtrl'
        })
        .state('app.about', {
            url: '/about',
            templateUrl: 'components/about/about.html',
            controller: 'AboutCtrl'
        })
        .state('app.userinfo', {
            url: '/userinfo',
            controller: 'UserCtrl',
            templateUrl: 'components/user/user.html',
        })
        .state('app.find_areas', {
            url: '/find_areas',
            templateUrl: 'components/find_areas/tabs.html',
            controller: 'FindAreasCtrl',
            abstract: true
        })
        .state('app.find_areas.counties', {
            url: '/counties',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/find_areas/counties.html',
                    controller: 'CountiesCtrl'
                }
            }
        })
        .state('app.find_areas.favorites', {
            url: '/favorites',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/find_areas/favorites.html',
                    controller: 'FavoritesCtrl'
                }
            }
        })
        .state('app.areas', {
            url: '/areas',
            params: {'id': false, 'county': false, 'search': ''},
            templateUrl: 'components/area_list/area_list.html',
            controller: 'AreasCtrl'
        })
        .state('app.cards', {
            url: '/cards',
            templateUrl: 'components/user_cards/user_cards.html',
            controller: 'UserCardsCtrl'
        })
        .state('app.favorites', {
            url: '/favorites',
            templateUrl: 'components/favorites/favorites.html'
        })
        .state('app.fishes', {
            url: '/fishes',
            templateUrl: 'components/fishes/fishes.html',
            controller: 'FishesCtrl'
        })
        .state('app.fishdetail', {
            url: '/fishdetail/:id',
            params: {'id': false, 'fish': false},
            templateUrl: 'components/fish_detail/fish_detail.html',
            controller: 'FishDetailCtrl'
        })
        .state('app.map', {
            url: '/map',
            templateUrl: 'components/map/map.html',
            controller: 'MapCtrl'
        })
        .state('app.techniques', {
            url: '/techniques',
            templateUrl: 'components/techniques/techniques.html',
            controller: 'TechniquesCtrl'
        })
        .state('app.techniquedetail', {
            url: '/techniquedetail/:id',
            params: {'id': false, 'tech': false},
            templateUrl: 'components/technique_detail/technique_detail.html',
            controller: 'TechniqueDetailCtrl'
        })
        .state('app.news', {
            url: '/news',
            templateUrl: 'components/news/news.html',
            controller: 'NewsCtrl'
        })
        .state('app.newsitem', {
            url: '/news/:id',
            params: {'item': false, 'id': false},
            templateUrl: 'components/news/newsitem.html',
            controller: 'NewsItemCtrl'
        })

        .state('app.area', {
            abstract: true,
            url: '/area/:id',
            templateUrl: 'components/area/area.html',
            controller: 'AreaCtrl',
        })
        .state('app.area.info', {
            url: '/info',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/area/info.html',
                    controller: 'AreaInfoCtrl'
                }
            }
        })
        .state('app.area.map', {
            url: '/map',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/area/map.html',
                    controller: 'AreaMapCtrl'
                }
            }
        })
        .state('app.area.fish', {
            url: '/fish',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/area/fish.html',
                    controller: 'AreaFishCtrl'
                }
            }
        })
        .state('app.area.cards', {
            url: '/cards',
            views: {
                'ionic-tabs': {
                    templateUrl: 'components/area/cards.html',
                    controller: 'AreaCardsCtrl'
                }
            }
        });
    }
]);

angular.module('ifiske.controllers', []);
angular.module('ifiske.directives', []);
;
angular.module('ifiske.controllers')
.controller('AboutCtrl', [
    '$scope',
    '$cordovaAppVersion',
    '$ionicPlatform',
    '$ionicModal',
    'Update',
    'Licenses',
    function($scope, $cordovaAppVersion, $ionicPlatform, $ionicModal, Update, Licenses) {
        $scope.version = $scope.dbDate = 'Okänt';
        $scope.update = Update;

        $ionicPlatform.ready(function() {
            if (window.cordova) {
                $cordovaAppVersion.getVersionNumber().then(function(version) {
                    console.log('iFiske version:', version);
                    $scope.version = version;
                });
                $cordovaAppVersion.getVersionCode().then(function(build) {
                    $scope.build = build;
                });
            }
            Licenses.get().then(function(data) {
                $scope.licenses = data.data;
            });
            $scope.alert = function(l) {
                var scope = $scope.$new();
                scope.l = l;
                $ionicModal.fromTemplateUrl(
                    'components/about/license_modal.html',
                    {scope: scope}
                ).then(function(modal) {
                    scope.closeModal = function() {
                        modal.hide();
                    };
                    modal.show();
                });

            };

        });
    }
]);
;
angular.module('ifiske.controllers')
.controller('AreaCardsCtrl', [
    '$scope',
    '$ionicModal',
    'localStorage',
    function($scope, $ionicModal, localStorage) {
        $scope.$on('$ionicView.beforeEnter', function() {
            //Area_Cards
            $scope.smsterms = localStorage.get('sms_terms');
            $scope.predicate = 'so';

            //SMS-modal
            $ionicModal.fromTemplateUrl('components/area/sms_modal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.sms_modal = modal;
            });
            $scope.openModal = function(product) {
                $scope.sms_modal.show();
                $scope.product = product;
            };
            $scope.closeModal = function() {
                $scope.sms_modal.hide();
            };
            $scope.showTerms = function() {
                $scope.showingterms = !$scope.showingterms;
            };
            $scope.showingterms = false;

            //Rules modal
            $ionicModal.fromTemplateUrl('components/area/rules_modal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.rules_modal = modal;
            });
            $scope.openRulesModal = function(product) {
                $scope.rules_modal.show();
                $scope.product = product;
            };
            $scope.closeRulesModal = function() {
                $scope.rules_modal.hide();
            };

            $scope.$on('$destroy', function() {
                $scope.sms_modal.remove();
                $scope.rules_modal.remove();
            });
        });
    }
]);
;
angular.module('ifiske.controllers')
.controller('AreaCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    function($scope, $stateParams, DB) {
        $scope.$on('$ionicView.beforeEnter', function() {
            console.log('beforeenter area_controller.js');
        });

        DB.getArea($stateParams.id)
        .then(function(area) {
            $scope.area = area;
            $scope.$broadcast('ifiske-area');

            area.images.then(function(images) {
                $scope.images = images;
            }, function(err) {
                console.error(err);
            });

            DB.getOrganization(area.orgid)
            .then(function(org) {
                $scope.org = org;
            });
        }, function(err) {
            console.log(err);
        });

        DB.getAreaFishes($stateParams.id)
        .then(function(fishes) {
            console.log(fishes);
            $scope.fishes = fishes;
        }, function(err) {
            console.log(err);
        });

        DB.getProductsByArea($stateParams.id)
        .then(function(products) {
            $scope.products = products;
        }, function(err) {
            console.log(err);
        });

    }
]);
;
angular.module('ifiske.controllers')
.controller('AreaFishCtrl', [
    '$scope',
    function($scope) {
        $scope.$on('$ionicView.beforeEnter', function() {
            console.log('beforeenter area_fish_controller.js', $scope);
        });

        $scope.sortorder = '-amount';
    }
]);
;
angular.module('ifiske.controllers')
.controller('AreaInfoCtrl', [
    '$scope',
    '$ionicSlideBoxDelegate',
    'sessionData',
    '$ionicPopup',
    'API',
    'DB',
    '$ionicPlatform',
    '$cordovaToast',
    function($scope, $ionicSlideBoxDelegate, sessionData, $ionicPopup, API, DB, $ionicPlatform, $cordovaToast) {
        console.log($scope);
        $scope.gotoProducts = function() {
            $ionicSlideBoxDelegate.$getByHandle('tabs').slide(1);
        };
        $scope.$on('$ionicView.beforeEnter', function() {
        });

        $scope.changeFavorite = function() {
            if (sessionData.token) {
                $scope.area.favorite = !$scope.area.favorite;
                var promise;
                if ($scope.area.favorite) {
                    promise = API.user_add_favorite($scope.area.ID)
                    .then(function() {
                        return DB.addFavorite($scope.area.ID);
                    }).then(function() {
                        return $ionicPlatform.ready(function() {
                            $cordovaToast.show('Området är nu tillagt i dina favoriter', 'short', 'bottom');
                        });
                    });
                } else {
                    promise = API.user_remove_favorite($scope.area.ID).then(function() {
                        return DB.removeFavorite($scope.area.ID);
                    }).then(function() {
                        $ionicPlatform.ready(function() {
                            $cordovaToast.show('Området är nu borttaget från dina favoriter', 'short', 'bottom');
                        });
                    });
                }
                promise.catch(function(err) {
                    console.log(err);
                });
            } else {
                $ionicPopup.alert({
                    title: 'Du måste vara inloggad för att kunna markera fiskevatten som favoriter.',
                });
            }
        };
    }
]);
;
angular.module('ifiske.controllers')
.controller('AreaMapCtrl', [
    '$scope',
    'DB',
    'leafletEvents',
    '$ionicPlatform',
    '$cordovaGeolocation',
    '$cordovaDeviceOrientation',
    '$timeout',
    'localStorage',
    function($scope, DB, leafletEvents, $ionicPlatform) {
        $scope.map = {};
        var updateMap = function() {
            $scope.map.area = $scope.area;
            DB.getPois($scope.area.orgid)
            .then(function(pois) {
                $scope.map.pois = pois;
            }, function(err) {
                console.error(err);
            });
            DB.getPolygons($scope.area.orgid)
            .then(function(polygons) {
                $scope.map.polygons = polygons;
            }, function(err) {
                console.error(err);
            });
        };

        $scope.$on('$ionicView.beforeEnter', function() {
            if ($scope.area) {
                updateMap();
            }
            $scope.$on('ifiske-area', updateMap);


            $scope.navigate = function() {
                $ionicPlatform.ready(function() {
                    launchnavigator.navigate(
                        [$scope.navto.lat, $scope.navto.lng],
                        null,
                        function() {
                            console.log('Opening navigator');
                        },
                        function(error) {
                            alert('Navigation failed!', error);
                        });
                });
            };

            var enabledEvents = ['popupopen', 'popupclose'];
            $scope.events = {
                enabled: enabledEvents
            };

            $scope.$on('leafletDirectiveMarker.popupopen', function(event, args) {
                //show navtobutton
                $scope.navto = args.model;
            });

            $scope.$on('leafletDirectiveMarker.popupclose', function() {
                //hide navtobutton
                $scope.navto = null;
            });
        });
    }
]);
;
angular.module('ifiske.controllers')
.controller('AreasCtrl', [
    '$scope',
    '$stateParams',
    '$ionicScrollDelegate',
    'DB',
    function($scope, $stateParams, $ionicScrollDelegate, DB) {

        var copy = $stateParams.search;
        $scope.search = copy;
        $scope.county = $stateParams.county || 'Sökresultat';
        DB.search('', $stateParams.id)
        .then(function(data) {
            $scope.areas = data;
        }, function(err) {
            console.log(err);
        });
        $scope.clearSearch = function() {
            $scope.search = '';
        };
        $scope.scrollTop = function() {
            $ionicScrollDelegate.scrollTop();
        };

    }
]);

;
angular.module('ifiske.controllers')
.controller('ContactCtrl', ['$scope', '$state', 'localStorage', function($scope, $state, localStorage) {
        $scope.contactInfo = localStorage.get('contactInfo');
}]);
;
angular.module('ifiske.controllers')
.controller('CountiesCtrl', ['$scope', 'DB', '$state', '$ionicHistory', function($scope, DB, $state, $ionicHistory) {
    var initialize = function() {
        DB.getCounties()
        .then(function(data) {
            $scope.counties = data;
        }, function(err) {
            console.log(err);
        });
    };
    $scope.$on('$ionicView.beforeEnter', initialize);
}]);
;
angular.module('ifiske.controllers')
.controller('FavoritesCtrl', [
    '$scope',
    'DB',
    '$cordovaToast',
    'API',
    '$ionicActionSheet',
    '$ionicPlatform',
    '$ionicHistory',
    function($scope, DB, $cordovaToast, API, $ionicActionSheet, $ionicPlatform, $ionicHistory) {
        var initialize = function() {
            DB.getUserFavorites()
            .then(function(data) {
                $scope.favorites = data;
                console.log(data);
            });
        };

        $scope.$on('$ionicView.beforeEnter', initialize);

        var removeFavorite = function(area) {
            API.user_remove_favorite(area.ID).then(function() {
                DB.removeFavorite(area.ID);
                $scope.favorites.splice($scope.favorites.indexOf(area), 1);
                $ionicPlatform.ready(function() {
                    window.plugins.toast.hide();
                    $cordovaToast.show('Området är nu borttaget från dina favoriter', 'short', 'bottom');
                });
            });
        };

        $scope.notify = function(area) {
            console.log(area);
            API.user_set_favorite_notification(area.ID, area.not).then(function() {
                DB.setFavoriteNotification(area.ID, area.not);
                $ionicPlatform.ready(function() {
                    window.plugins.toast.hide();
                    $cordovaToast.show('Notifikationer är ' + (area.not ? 'på' : 'av'),
                                       'short', 'bottom');
                });
            });

        };
        $scope.openPopover = function(area) {
            $ionicActionSheet.show({
                buttons: [
                    {text: area.not ? 'Stäng av notifikationer' : 'Sätt på notifikationer'}
                ],
                destructiveText: 'Ta bort favorit',
                destructiveButtonClicked: function() {
                    removeFavorite(area);
                    return true;
                },
                titleText: 'Ändra din favorit',
                cancelText: 'Gör inget',
                buttonClicked: function() {
                    area.not = !area.not;
                    return true;
                },
                cancel: function() {}
            });
        };
    }
]);
;
angular.module('ifiske.controllers')
.controller('FindAreasCtrl', [
    '$scope',
    function($scope) {
    }
]);

;
angular.module('ifiske.controllers')
.controller('FishDetailCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    function($scope, $stateParams, DB) {
        $scope.fish = $stateParams.fish;
        if (!$scope.fish) {
            DB.getFish($stateParams.id)
            .then(function(data) {
                $scope.fish = data;
            }, function(err) {
                console.log(err);
            });
        }
    }
]);
;
angular.module('ifiske.controllers')
.controller('FishesCtrl', ['$scope', 'DB', function($scope, DB) {
    $scope.sortorder = 'so';
    DB.getFishes()
    .then(function(data) {
        $scope.fishes = data;
        $scope.default_img = data[0].img;
    }, function(err) {
        console.log(err);
    });
}]);
;
angular.module('ifiske.controllers')
.controller('HomeCtrl', [
    '$scope',
    '$state',
    '$ionicHistory',
    'localStorage',
    'sessionData',
    'Update',
    function($scope, $state, $ionicHistory, localStorage, sessionData, Update) {

        $scope.loggedIn = sessionData;

        $scope.update = Update;

        // Current history stack Id. See area_controller for usage.
        localStorage.set('homeHistoryId', $ionicHistory.currentHistoryId());

        $scope.newsTitle = localStorage.get('NEWS');

        $scope.myFunc = function($event) {
            if ($event.keyCode === 13 && !$event.shiftKey) { //if enter-key
                $state.go('app.areas', {search: $event.srcElement.value});
            }

        };
    }
]);
;
angular.module('ifiske.controllers')
.controller('LegalCtrl', ['$scope', '$state', 'localStorage', function($scope, $state, localStorage) {
    $scope.tos = localStorage.get('tos');
}]);
;
angular.module('ifiske.controllers')
.controller('LoginCtrl', [
    '$scope',
    '$state',
    'Update',
    '$ionicLoading',
    '$ionicHistory',
    '$ionicViewSwitcher',
    function($scope, $state, Update, $ionicLoading, $ionicHistory, $ionicViewSwitcher) {

        /**
         * signIn
         * Submit handler for login form. Validates login input.
         * Moves to home view on successful login.
         */
        $scope.signIn = function(loginForm) {
            $ionicLoading.show();

            Update.user_login(loginForm.username.$viewValue, loginForm.password.$viewValue)
            .then(function() {
                $ionicLoading.hide();
                loginForm.$setValidity('loginError', true);
                $ionicViewSwitcher.nextDirection('forward');
                $ionicHistory.nextViewOptions({
                    disableBack: true,
                    historyRoot: true
                });
                $state.go('app.home');
            }, function(error) {
                $ionicLoading.hide();
                loginForm.$setValidity('loginError', false);
                $scope.error = error.response;
            });
        };

        /**
         * skip
         * Skips to the home view. Forces forward transition and sets home as root view.
         */
        $scope.skip = function() {
            $ionicViewSwitcher.nextDirection('forward');
            $ionicHistory.nextViewOptions({
                disableBack: true,
                historyRoot: true
            });
            $state.go('app.home');
        };
    }
]);
;
angular.module('ifiske.controllers')
.controller('MapCtrl', [
    '$scope',
    'leafletData',
    '$ionicPlatform',
    'DB',
    '$cordovaGeolocation',
    '$cordovaDeviceOrientation',
    '$timeout',
    'localStorage',
    function($scope, leafletData, $ionicPlatform, DB) {

        console.log($scope);
        $scope.map = {};
        $scope.map.centerOnMe = true;
        $scope.$on('$ionicView.beforeEnter', function() {
            DB.search('').then(function(areas) {
                $scope.map.areas = areas;
            });
        });
    }
]);
;
angular.module('ifiske.controllers')
.controller('MenuCtrl', [
    '$scope',
    '$state',
    '$ionicViewSwitcher',
    '$ionicPopover',
    'sessionData',
    'Update',
    function($scope, $state, $ionicViewSwitcher, $ionicPopover, sessionData, Update) {

        $scope.sessionData = sessionData;

        $ionicPopover.fromTemplateUrl('components/menu/popover.html', {
            scope: $scope
        }).then(function(popover) {
            $scope.popover = popover;
        });

        $scope.userinfo = function() {
            $scope.popover.hide();
            $state.go('app.userinfo');
        };
        $scope.logout = function() {
            $scope.popover.hide();
            Update.user_logout();

            $state.go('app.login');
        };
        $scope.login = function() {
            $scope.popover.hide();
            $ionicViewSwitcher.nextDirection('back');
            $state.go('app.login');
        };
        $scope.register = function() {
            $scope.popover.hide();
            $state.go('app.register.details');
        };

        $scope.forcedUpdate = function() {
            Update.forcedUpdate();
        };

    }
]);
;
angular.module('ifiske.controllers')
.controller('NewsCtrl', [
    '$scope',
    'DB',
    'localStorage',
    function($scope, DB, localStorage) {
        $scope.newsTitle = localStorage.get('NEWS');

        DB.getNews().then(function(data) {
            $scope.content = data;
        });
    }
]);
;
angular.module('ifiske.controllers')
.controller('NewsItemCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    function($scope, $stateParams, DB) {
        if ($stateParams.item) {
            $scope.item = $stateParams.item;
        } else {
            DB.getNewsItem($stateParams.id).then(function(data) {
                $scope.item = data;
            });
        }
    }
]);
;

angular.module('ifiske.controllers')
    .controller('RecoverCtrl', [
	'$scope',
	'$state',
	'$ionicHistory',
	'$ionicPlatform',
	'$ionicLoading',
	'$cordovaToast',
	'API',
	function($scope, $state, $ionicHistory, $ionicPlatform, $ionicLoading, $cordovaToast, API) {
	    'use strict';
	    
	    var user = "";
	    
	    /**
             * ToDo: use to skip from lostpassword to resetpassword
	     * skip
	     * Submit handler for skip button
	     */
            /*
	      $scope.skip = function() {
	      $scope.info = "";
	      $state.go('^.resetpassword');
	      };
            */	    

	    /**
	     * lostPassword
	     * Submit handler for first form
	     */
	    $scope.lostPassword = function(form) {

	        $ionicLoading.show();

	        user = form.user.$viewValue;

	        API.user_lost_password(user)
		    .then(function(data) {
			
			// Set info message for next view
			$scope.info = 'En återställningskod kommer skickas till dig inom kort, via ';			
			if (data.mailed) {
			    $scope.info += 'e-mail';
			    if (data.texted) {
				$scope.info += ' och ';
			    }
			}
			if (data.texted) {
			    $scope.info += 'SMS';
			}
                        
			$state.go('^.resetpassword');

		    }, function(error) {
			//ToDo: handle timeout?
			//ToDo: check error codes?
			form.user.$setValidity('invalidUser', false);
		    })
		    .finally($ionicLoading.hide);
	    };


	    /**
	     * resetPassword
	     * Submit handler for second form
	     *
	     * ToDo: log in immediately?
	     */
	    $scope.resetPassword = function(form) {
		$ionicLoading.show();
		
		
		API.user_reset_password(user, form.password.$viewValue, form.code.$viewValue)
		    .then(function(data) {
		
                        //ToDo: handle timeouts?

                        //ToDo: .ready() needed?
	                // Success toast
		        $ionicPlatform.ready(function() {
		            $cordovaToast.showLongBottom('Ditt lösenord har ändrats');
		        });
	        			
                        $state.go('app.login');

                        // Navigate to current history root?
			//$ionicHistory.goToHistoryRoot($ionicHistory.currentView().historyId);	
		    }, function(error) {
                        switch(error.error_code) {
                        /*case 5:
                            //invalide username
                            break;*/
                        /*case 13:
                            form.password.$setValidity('passwordLength', false);
                            break;*/
                        case 16:
		            form.code.$setValidity('invalidCode',false);
                            break;
                        }
		    })
		    .finally($ionicLoading.hide);
	    };
	}]);
;
angular.module('ifiske.controllers')
    .controller('RegisterCtrl', [
        '$scope',
        '$state',
        '$ionicLoading',
        '$ionicModal',
        '$ionicScrollDelegate',
        '$ionicPlatform',
        '$cordovaToast',
        'API',
        'localStorage',
        function($scope, $state, $ionicLoading, $ionicModal, $ionicScrollDelegate, $ionicPlatform, $cordovaToast, API, localStorage) {

            var username;

            // Live check for username availability
            $scope.checkUsername = function(input) {
                API.user_exists(input.$viewValue)
                    .then(function(data) {
                        input.$setValidity('nameTaken', !data);
                    });
            };

            // Live check for email availability
            $scope.checkEmail = function(input) {
                API.user_exists(null, input.$viewValue)
                    .then(function(data) {
                        input.$setValidity('emailTaken', !data);
                    });
            };


            // Validation errors not tied to input field
            $scope.formErrors = {};

            /**
             * register
             * Submit handler for the registration form
             */
            $scope.register = function(form) {
                $ionicLoading.show();

                // Save phone number for next view
                $scope.phone = form.phone.$viewValue;

                // Save username for verify submit handler
                username = form.username.$viewValue;

                var password = form.password.$viewValue;
                var fullname = form.fullname.$viewValue;
                var email = form.email.$viewValue;

                API.user_register(username, fullname, password, email, $scope.phone)
                    .then(function(data) {
                        // Success: Go to verify account view
                        $ionicLoading.hide();
                        $scope.formErrors = {};
                        $state.go('^.verify');

                    }, function(error) {
                        /**
                         * Error: Inform the user about failed registration
                         * See API documentation for error codes
                         *
                         * ToDo: Handle timeout
                         */
                        $scope.formErrors.registrationError = true;
                        $ionicScrollDelegate.scrollTop(true);

                        // Invalid Email
                        if (error.error_code == 8) {
                            form.email.$setValidity('invalidEmail', false);
                        }
                        // Username or Email already registered
                        if (error.error_code == 9) {
                            $scope.checkUsername(form.username);
                            $scope.checkEmail(form.email);
                        }
                        // Invalid phone number
                        if (error.error_code == 10) {
                            form.phone.$setValidity('invalidPhone', false);
                        }

                        $ionicLoading.hide();
                    });
            };


            /**
             * verify
             * Submit handler for the verification form
             */
            $scope.verify = function(form) {
                $ionicLoading.show();

                var vercode = form.vercode;

                API.user_confirm(username, vercode.$viewValue)
                    .then(function(data) {
                        $ionicPlatform.ready(function() {
                            $cordovaToast.showLongBottom('Ditt konto har skapats');
                        });
                        $scope.formErrors.validationError = false;
                        $state.go('app.login');
                    }, function(error) {
                        if (error.error_code) {
                            vercode.$setValidity("verified", false);
                        } else {
                            $scope.formErrors.validationError = true;
                        }
                    })
                    .finally($ionicLoading.hide());
            };


            $scope.tos = localStorage.get('tos');
            //Modal with the EULA
            $ionicModal.fromTemplateUrl('components/register/eula.html', {
                scope: $scope,
                animation: 'slide-in-up'
            }).then(function(modal) {
                $scope.eula = modal;
            });
            $scope.showEula = function() {
                $scope.eula.show();
            };
            $scope.closeEula = function() {
                $scope.eula.hide();
            };
            $scope.$on('$destroy', function() {
                $scope.eula.remove();
            });

        }]);
;
angular.module('ifiske.controllers')
.controller('TechniqueDetailCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    '$ionicSlideBoxDelegate',
    function($scope, $stateParams, DB, $ionicSlideBoxDelegate) {
        $scope.tech = $stateParams.tech;
        $scope.images = [];

        if (!$scope.tech) {
            DB.getTechnique($stateParams.id)
            .then(function(data) {
                $scope.images = [data.img1, data.img2, data.img3].filter(function(el) {
                    return !/\/$/.test(el);
                });

                $ionicSlideBoxDelegate.update();
                $scope.tech = data;
            });
        } else {
            var data = $scope.tech;
            $scope.images = [data.img1, data.img2, data.img3].filter(function(el) {
                return !/\/$/.test(el);
            });

            $ionicSlideBoxDelegate.update();
        }
    }
]);
;
angular.module('ifiske.controllers')
.controller('TechniquesCtrl', ['$scope', 'DB', function($scope, DB) {

    $scope.sortorder = 'so';

    $scope.$on('$ionicView.beforeEnter', function() {
        DB.getTechniques()
        .then(function(data) {
            $scope.techniques = data;
        });
    });

}]);
;
angular.module('ifiske.controllers')
.controller('UserCtrl', ['$scope', 'DB', function($scope, DB) {
    DB.getUserInfo()
    .then(function(user) {
        $scope.user = user;
    });
    DB.getUserNumbers()
    .then(function(numbers) {
        $scope.numbers = numbers;
    });
}]);
;
angular.module('ifiske.controllers')
.controller('UserCardsCtrl', [
    '$scope',
    '$stateParams',
    'DB',
    'Update',
    '$ionicModal',
    '$ionicLoading',
    function($scope, $stateParams, DB, Update, $ionicModal, $ionicLoading) {
        $scope.pred = '-to';
        $scope.endpoint = 'https://www.ifiske.se';

        var initilize = function() {
            $ionicLoading.show();
            var a = Update.update();
            console.log(a);
            a.then(function(hi) {
                console.log(hi);
            });
            a.finally(function() {
                console.log('helloä');
                $scope.now = Date.now();
                DB.getUserProducts()
                .then(function(data) {
                    $scope.products = data;
                    console.log($scope);
                    $scope.$broadcast('scroll.refreshComplete');
                    $ionicLoading.hide();
                }, function(err) {
                    console.log(err);
                    $scope.$broadcast('scroll.refreshComplete');
                    $ionicLoading.hide();
                });
            });
        };

        $scope.$on('$ionicView.beforeEnter', initilize);
        //use the same modal as in area_cards
        $ionicModal.fromTemplateUrl('components/area_cards/rules_modal.html', {
            scope: $scope,
            animation: 'slide-in-up'
        }).then(function(modal) {
            $scope.rules_modal = modal;
        });
        $scope.openRulesModal = function(product) {
            $scope.rules_modal.show();
            console.log(product);
            $scope.product = product;
        };
        $scope.closeRulesModal = function() {
            $scope.rules_modal.hide();
        };

        $scope.$on('$destroy', function() {
            $scope.rules_modal.remove();
        });
        $scope.update = function() {
            initilize();
        };
    }
]);
;
(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.api', ['ifiske.utils'])
    .provider('API', function APIProvider() {

        this.base_url = 'https://www.ifiske.se/api/v2/api.php';

        this.$get = [
            '$http',
            'sessionData',
            'localStorage',
            '$q',
            function($http, sessionData, localStorage, $q) {
                var base_url = this.base_url;

                /**
                 * # api_call #
                 * handles http requests
                 * returns a $http object for the requested api call
                 */
                var api_call = function(params, cache) {
                    return $q(function(fulfill, reject) {
                        $http(
                            {
                                method:'get',
                                url: base_url,
                                params: angular.extend(params, {'key': 'ox07xh8aaypwvq7a'}),
                                timeout: 7000,
                                cache: (cache !== false)
                            }
                        )
                        // ToDo: Proper logging
                        .success(function(data) {
                            if (data.status === 'error') {
                                reject(data.message);
                            } else {
                                if (data.data) {
                                    fulfill(data.data.response);
                                } else {
                                    reject(data);
                                }
                            }
                        })
                        //.error(function(data, status, headers, config, statusText) {
                        .error(function(data, status) {
                            if (status === 0) {
                                reject(new Error('Request timeout'));
                            } else {
                                reject(data);
                            }
                        });
                    });
                };

                /**
                 * # session_api_call #
                 * wrapper for api_call - inserts the session token into params
                 */
                var session_api_call = function(params, cache) {
                    var session = sessionData.token;
                    return api_call(angular.extend(params, {s: session}), cache);
                };

                return {
                    get_municipalities: function() {
                        return api_call({m: 'get_municipalities'});
                    },
                    get_counties: function() {
                        return api_call({m: 'get_counties'});
                    },
                    user_exists: function(username, email) {
                        var args = {m: 'user_exists'};

                        if (username && typeof username === 'string') {
                            args.username = username;
                        }
                        if (email && typeof email === 'string') {
                            args.email = email;
                        }

                        return api_call(args, false);
                    },
                    user_register: function(username, fullname, password, email, phone) {
                        return api_call(
                            {m: 'user_register',
                                username: username,
                                fullname: fullname,
                                password: password,
                                email: email,
                                phone: phone
                            }, false);
                    },
                    user_confirm: function(username, pin) {
                        return api_call({
                            m: 'user_confirm',
                            username: username,
                            pin: pin
                        }, false);
                    },
                    user_info: function() {
                        return session_api_call({m: 'user_info'});
                    },
                    user_lost_password: function(user) {
                        return api_call(
                            {m: 'user_lost_password',
                                user_identification: user
                            }, false);
                    },
                    user_reset_password: function(user_identification, password, code) {
                        return api_call({
                            m: 'user_reset_password',
                            user_identification: user_identification,
                            password: password,
                            code: code
                        }, false);
                    },
                    user_change_password: function(old_password, new_password) {
                        return session_api_call({
                            m: 'user_change_password',
                            old_password: old_password,
                            new_password: new_password
                        }, false);
                    },
                    user_login: function(username, password) {
                        return api_call(
                            {m: 'user_login',
                                username: username,
                                password: password
                            }, false)
                            .then(function(data) {
                                sessionData.setToken(data);

                                //needed for chaining of promises
                                return data;
                            });
                    },
                    user_logout: function() {
                        return session_api_call({m: 'user_logout'}, false)
                        .then(function() {
                            sessionData.deleteToken();
                        });
                    },
                    user_products: function() {
                        return session_api_call({m: 'user_products'}, false);
                    },
                    get_fishes: function() {
                        return api_call({m: 'get_fishes'});
                    },
                    get_techniques: function() {
                        return api_call({m: 'get_techniques'});
                    },
                    get_baits: function() {
                        return api_call({m: 'get_baits'});
                    },
                    get_organizations: function(orgid) {
                        return api_call(
                            {m: 'get_organizations',
                                orgid: orgid
                            });
                    },
                    get_org_modified: function(orgid) {
                        return api_call(
                            {m: 'get_org_modified',
                                orgid: orgid
                            });
                    },
                    get_areas: function(areaid) {
                        return api_call(
                            {m: 'get_areas',
                                areaid: areaid
                            });
                    },
                    get_areas_modified: function(areaid) {
                        return api_call(
                            {m: 'get_areas_modified',
                                areaid: areaid
                            });
                    },
                    get_products: function(areaid) {
                        return api_call(
                            {m: 'get_products',
                                areaid: areaid
                            });
                    },
                    get_rules: function(ruleid) {
                        return api_call(
                            {m: 'get_rules',
                                ruleid: ruleid
                            });
                    },
                    get_photos: function(orgid, areaid) {
                        return api_call(
                            {m: 'get_photos',
                                orgid: orgid,
                                areaid: areaid
                            });
                    },
                    get_map_pois: function(orgid) {
                        return api_call(
                            {m: 'get_map_pois',
                                orgid: orgid
                            });
                    },
                    get_map_poi_types : function() {
                        return api_call({m: 'get_map_poi_types'});
                    },
                    get_map_polygons: function(orgid) {
                        return api_call(
                            {m: 'get_map_polygons',
                                orgid: orgid
                            });
                    },
                    user_get_favorites: function() {
                        return session_api_call({m: 'user_get_favorites'}, false);
                    },
                    user_add_favorite: function(area) {
                        //Flag 0 means to not get notifications on catch reports
                        return session_api_call({m: 'user_add_favorite', areaid: area, flag: 0}, false);
                    },
                    user_set_favorite_notification: function(area, flag) {
                        flag = flag ? 1 : 0;
                        return session_api_call({m: 'user_set_favorite_notification', areaid: area, flag: flag}, false);
                    },
                    user_remove_favorite: function(area) {
                        return session_api_call({m: 'user_remove_favorite', areaid: area}, false);
                    },
                    get_terms_of_service: function() {
                        return api_call({m: 'get_terms_of_service'});
                    },
                    get_contact_info: function() {
                        return api_call({m: 'get_contact_info'});
                    },
                    get_engine_policies: function() {
                        return api_call({m: 'get_engine_policies'});
                    },
                    get_sms_terms: function() {
                        return api_call({m: 'get_sms_terms'});
                    },
                    get_mapbox_api: function() {
                        return api_call({m: 'get_mapbox_apiaccesstoken'});
                    },
                    get_content_menu: function() {
                        return api_call({m: 'get_content_menu'});
                    }
                };
            }];
    });
})(window.angular);
;
(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.db', [])
    .provider('DB', function DBProvider() {

        this.$get = [
            '$cordovaSQLite',
            'API',
            '$q',
            '$rootScope',
            function($cordovaSQLite, API, $q, $rootScope) {

                var db;
                if (window.sqlitePlugin) {
                    db = $cordovaSQLite.openDB('fiskebasen.db');
                } else if (window.openDatabase) {
                    db = window.openDatabase(
                        'fiskebasen.db', '1.0', 'fiskebasen', 10 * 1024 * 1024);
                } else {
                    console.log('Not supported on this device, sorry');
                    return undefined;
                }

                var tableDef = {
                    'Area': [
                        ['ID',    'int'],
                        ['orgid', 'int'],
                        ['t',     'text'],
                        ['kw',    'text'],
                        ['note',  'text'],
                        ['c1',    'int'],
                        ['c2',    'int'],
                        ['c3',    'int'],
                        ['m1',    'int'],
                        ['m2',    'int'],
                        ['m3',    'int'],
                        ['lat',   'real'],
                        ['lng',   'real'],
                        ['zoom',  'text'],
                        ['pnt',   'int'],
                        ['car',   'int'],
                        ['eng',   'int'],
                        ['hcp',   'int'],
                        ['map',   'text'],
                        ['wsc',   'int'],
                        ['mod',   'int'],
                        ['d',     'text']
                    ],
                    'Area_Fish': [
                        ['ID',       'text'],
                        ['aid',      'int'],
                        ['fid',      'int'],
                        ['amount',   'int'],
                        ['comment',  'text']
                    ],
                    'Product': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['t2',     'text'],
                        ['no',     'text'],
                        ['im',     'text'],
                        ['pf',     'text'],
                        ['ai',     'int'],
                        ['ri',     'int'],
                        ['ch',     'int'],
                        ['price',  'int'],
                        ['mod',    'int'],
                        ['so',     'int'],
                        ['hl',     'text']
                    ],
                    'County': [
                        ['ID',   'int'],
                        ['s',    'text'],
                        ['t',    'text'],
                        ['d',    'text']
                    ],
                    'Municipality': [
                        ['ID',    'int'],
                        ['cID',   'int'],
                        ['name',  'text']
                    ],
                    'Fish': [
                        ['ID',    'int'],
                        ['t',     'text'],
                        ['d',     'text'],
                        ['mod',   'int'],
                        ['so',    'int'],
                        ['max',   'int'],
                        ['icon',  'text'],
                        ['img',   'text'],
                        ['in',    'text'],
                        ['geo',   'text'],
                        ['size',  'text'],
                        ['lat',   'text'],
                        ['rec',   'text']
                    ],
                    'Rule': [
                        ['ID',   'int'],
                        ['ver',  'int'],
                        ['d',    'text'],
                        ['t',    'text']
                    ],
                    'User_Product': [
                        ['ID',        'int'],
                        ['at',        'int'],
                        ['code',      'int'],
                        ['fr',        'int'],
                        ['fullname',  'text'],
                        ['ot',        'text'],
                        ['ref1',      'int'],
                        ['ref2',      'int'],
                        ['t',         'text'],
                        ['to',        'int'],
                        ['pid',       'int'],
                        ['pdf',       'text']
                    ],
                    'User_Info': [
                        ['ID',        'int'],
                        ['username',  'text'],
                        ['loggedin',  'text'],
                        ['IP1',       'text'],
                        ['IP2',       'text'],
                        ['name',      'text'],
                        ['email',     'text'],
                        ['created',   'text']
                    ],
                    'User_Number': [
                        ['number', 'text']
                    ],
                    'User_Favorite': [
                        ['ID',  'int'],
                        ['a',   'int'],
                        ['add', 'int'],
                        ['not', 'int'],
                        ['cnt', 'int'],
                    ],
                    'Technique': [
                        ['ID',       'int'],
                        ['t',        'text'],
                        ['d',        'text'],
                        ['so',       'int'],
                        ['de',       'text'],
                        ['da',       'text'],
                        ['icon',     'text'],
                        ['img1',     'text'],
                        ['img2',     'text'],
                        ['img3',     'text'],
                        ['youtube',  'text']
                    ],
                    'Organization': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['d',      'text'],
                        ['cp',     'text'],
                        ['url',    'text'],
                        ['co',     'int'],
                        ['mod',    'int'],
                        ['vat',    'int'],
                        ['dp',     'int'],
                        ['fva',    'int'],
                        ['org',    'int'],
                        ['ml',     'int']
                    ],
                    'Poi': [
                        ['ID',     'int'],
                        ['orgid',  'int'],
                        ['type',   'int'],
                        ['price',  'int'],
                        ['t',      'text'],
                        ['d',      'text'],
                        ['la',     'real'],
                        ['lo',     'real']
                    ],
                    'Poi_Type': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['icon',   'text'],
                    ],
                    'Polygon': [
                        ['ID',     'int'],
                        ['orgid',  'int'],
                        ['t',      'text'],
                        ['c',      'text'],
                        ['ver',    'int'],
                        ['mod',    'int'],
                        ['poly',   'text']
                    ],
                    'News': [
                        ['ID',     'int'],
                        ['t',      'text'],
                        ['text',   'text'],
                        ['img',    'text'],
                        ['icon',   'text']
                    ]

                };

                var createObject = function(data) {
                    var retval = [];
                    for (var i = 0; i < data.rows.length; ++i) {
                        retval.push(angular.copy(data.rows.item(i)));
                    }
                    return retval;
                };

                return {
                    populateTable: function(table, data) {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                tx.executeSql('DELETE FROM ' + table + ';');

                                for (var id in data) {
                                    var singleData = data[id];
                                    var insertData = [];
                                    for (var i = 0; i < tableDef[table].length; ++i) {
                                        insertData.push(singleData[tableDef[table][i][0]]);
                                    }
                                    var query = [
                                        'INSERT INTO',
                                        table,
                                        'VALUES(?',
                                        ',?'.repeat(insertData.length - 1),
                                        ')'
                                    ].join(' ');

                                    tx.executeSql(query, insertData);
                                }
                            },
                            reject,
                            fulfill);
                        });

                    },

                    cleanTable: function(table) {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                tx.executeSql('DELETE FROM ' + table + ';');
                            },
                            reject,
                            fulfill);
                        });
                    },

                    /**
                     * Drops all tables in the database
                     * @method clean
                     */
                    clean: function() {
                        return $q(function(fulfill, reject) {
                            db.transaction(
                                function(tx) {
                                    for (var table in tableDef) {
                                        tx.executeSql('DROP TABLE IF EXISTS ' + table + ';');
                                    }
                                },
                                reject,
                                fulfill
                            );
                        })
                        .then(function() {
                            console.log('Removed all tables');
                        });
                    },

                    /**
                     * Initialies the tables in the database
                     * @method init
                     */
                    init: function() {
                        return $q(function(fulfill, reject) {
                            db.transaction(function(tx) {
                                for (var t in tableDef) {
                                    var table = tableDef[t];
                                    var tableValues = [];

                                    /*
                                     * Builds a string with "" around all names, so that
                                     * it can be used to create an SQL Table witout having
                                     * to worry about using reserved keywords.
                                     */
                                    for (var i = 0; i < table.length; ++i) {
                                        tableValues.push('"' + table[i][0] + '" ' + table[i][1]);
                                    }
                                    tableValues = tableValues.join(', ');

                                    var query = [
                                        'CREATE TABLE IF NOT EXISTS',
                                        t,
                                        '(',
                                        tableValues,
                                        ', PRIMARY KEY(',
                                        '"' + table[0][0] + '"',
                                        '));'
                                    ].join(' ');
                                    tx.executeSql(query);
                                }
                            },
                            reject,
                            fulfill);
                        });
                    },



                    /**
                     * Gets information about an area
                     * @method getArea
                     * @param {Integer} id
                     */
                    getArea: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT Area.*,',
                                'CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite',
                                'FROM Area',
                                'LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID',
                                'WHERE Area.ID = ?'
                            ].join(' '), Array.isArray(id) ? id : [id])
                            .then(function(area) {
                                console.log(area);
                                var object = createObject(area)[0];
                                //TODO: DB should not need API
                                object.images = API.get_photos(object.orgid);
                                fulfill(object);
                            }, reject);
                        });
                    },

                    getAreaFishes: function(aid) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Area_Fish',
                                'JOIN Fish ON Area_Fish.fid = Fish.ID',
                                'WHERE Area_Fish.aid = ?'
                            ].join(' '), [aid])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Searches the database using a query
                     *
                     * The query is matched to a name and/or keyword
                     * @method search
                     * @param {String} searchstring
                     */
                    search: function(searchstring, county_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT Area.*,',
                                'CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite',
                                'FROM Area',
                                'LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID',
                                'WHERE t LIKE ?',
                                (county_id ? 'AND ? IN (c1,c2,c3)' : ''),
                                'ORDER BY t'
                            ].join(' '),
                            county_id ?
                                ['%' + searchstring + '%', county_id] :
                                ['%' + searchstring + '%'])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Gets information about a product
                     * @method getProduct
                     * @param {Integer} product_id
                     */
                    getProduct: function(product_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM Product',
                                'JOIN Rule ON Rule.ID = Product.ri',
                                'WHERE ID = ?',
                                'ORDER BY so'
                            ].join(' '),
                            [product_id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    /**
                     * Gets all products from an area
                     * @method getProductsByArea
                     * @param {Integer} area_id
                     */
                    getProductsByArea: function(area_id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM Product',
                                'JOIN Rule ON Rule.ID = Product.ri',
                                'WHERE ai = ?',
                                'ORDER BY so'
                            ].join(' '),
                            [area_id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getCounties: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT DISTINCT County.*',
                                'FROM County',
                                'JOIN Area ON Area.c1 = County.ID',
                                'ORDER BY County.t'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getUserProducts: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT User_Product.*,',
                                'Rule.t as rule_t,',
                                'Rule.ver as rule_ver,',
                                'Rule.d as rule_d',
                                'FROM User_Product',
                                'LEFT JOIN Product ON Product.ID = User_Product.pid',
                                'LEFT JOIN Rule ON Rule.ID = Product.ri'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getFishes: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Fish'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getFish: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Fish',
                                'WHERE id = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },

                    getTechniques: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Technique'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getTechnique: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Technique',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },
                    getOrganization: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT * FROM Organization',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    },
                    getUserInfo: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Info'
                            ].join(' '))
                            .then(function(user) {
                                fulfill(createObject(user)[0]);
                            }, reject);
                        });
                    },
                    getUserNumbers: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Number'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getUserFavorites: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM User_Favorite',
                                'JOIN Area ON User_Favorite.a = Area.ID'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    removeFavorite: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'DELETE FROM User_Favorite',
                                'WHERE a = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(data);
                            }, reject);
                        });
                    },
                    addFavorite: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'INSERT INTO User_Favorite',
                                '(a, "not") VALUES (?, 0)',
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(data);
                            }, reject);
                        });
                    },
                    setFavoriteNotification: function(id, not) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'UPDATE User_Favorite',
                                'SET "not" = ? WHERE a = ?'
                            ].join(' '), [not, id])
                            .then(function(data) {
                                fulfill(data);
                            }, reject);
                        });
                    },

                    getPois: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Poi',
                                'WHERE orgid = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getPoiTypes: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Poi_Type'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getPolygons: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM Polygon',
                                'WHERE orgid = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },

                    getNews: function() {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM News'
                            ].join(' '))
                            .then(function(data) {
                                fulfill(createObject(data));
                            }, reject);
                        });
                    },
                    getNewsItem: function(id) {
                        return $q(function(fulfill, reject) {
                            $cordovaSQLite.execute(db, [
                                'SELECT *',
                                'FROM News',
                                'WHERE ID = ?'
                            ].join(' '), [id])
                            .then(function(data) {
                                fulfill(createObject(data)[0]);
                            }, reject);
                        });
                    }
                };
            }
        ];
    });
})(window.angular);
;
angular.module('ifiske.filters', [])
.filter('onebr', function() {
    return function(input) {
        return input.replace(/(<br>\s*)+/g, '<br>');
    };
})
.filter('nobrs', function() {
    return function(input) {
        return input.replace(/(<br(\s*\/)*>)+/g, '');
    };
})
.filter('cleantables', function() {
    return function(input) {
        input = input.replace(/(<\/?table>)+/g, '');
        input = input.replace(/(<\/?tr>)+/g, '');
        input = input.replace(/(<\/?th>)+/g, '');
        input = input.replace(/(<(\/?)td.*?>)+?/g, '<$2p>');
        input = input.replace(/<p>\s*<\/p>/g, '');
        return input;
    };
});
;
(function(angular, undefined) {
    'use strict';

    angular.module('ifiske.update', ['ifiske.api', 'ifiske.db', 'ifiske.utils'])
    .provider('Update', function UpdateProvider() {

        this.$get = [
            'API',
            'DB',
            'localStorage',
            '$q',
            '$ionicLoading',
            'sessionData',
            function(API, DB, localStorage, $q, $ionicLoading, sessionData) {

                var LAST_UPDATE = 'last_update';

                var updates = {
                    auth: [
                        {
                            endpoint: 'user_products',
                            table: 'User_Product',
                        },
                        {
                            endpoint: 'user_get_favorites',
                            table: 'User_Favorite',
                        },
                        {
                            endpoint: 'user_info',
                            table: [
                                'User_Info',
                                'User_Number'
                            ],
                            f: function(data) {
                                var numbers = data.numbers;
                                var numArr = [];
                                for (var i = 0; i < numbers.length; ++i) {
                                    numArr.push({'number': numbers[i]});
                                }
                                return $q.all([
                                    DB.populateTable('User_Info', [data])
                                    .then(function() {
                                        return 'User_Info';
                                    }, function(err) {
                                        console.log(data);
                                        console.log(err);
                                        return $q.reject(err);
                                    }),
                                    DB.populateTable('User_Number', numArr)
                                    .then(function() {
                                        return 'User_Numbers';
                                    }, function(err) {
                                        console.log(err);
                                        return $q.reject(err);
                                    }),
                                ]);
                            }
                        }
                    ],
                    timed: [
                        {
                            endpoint: 'get_areas',
                            f: function(data) {
                                var fishArr = [];
                                for (var key in data) {
                                    var fishes = data[key].fish;
                                    for (var fishKey in fishes) {
                                        fishArr.push({
                                            'ID': key + '_' + fishKey,
                                            fid: fishKey,
                                            aid: key,
                                            amount: fishes[fishKey][0],
                                            comment: fishes[fishKey][1]
                                        });
                                    }
                                }
                                return $q.all([
                                    DB.populateTable('Area', data),
                                    DB.populateTable('Area_Fish', fishArr)
                                ])
                                .then(function() {
                                    return 'Area';
                                }, function(err) {
                                    console.warn(err);
                                    return $q.reject(err);
                                });
                            }
                        },
                        {
                            endpoint: 'get_products',
                            table: 'Product'
                        },
                        {
                            endpoint: 'get_counties',
                            table: 'County'
                        },
                        {
                            endpoint: 'get_municipalities',
                            table: 'Municipality'
                        },
                        {
                            endpoint: 'get_fishes',
                            table: 'Fish'
                        },
                        {
                            endpoint: 'get_rules',
                            table: 'Rule'
                        },
                        {
                            endpoint: 'get_techniques',
                            table: 'Technique'
                        },
                        {
                            endpoint: 'get_organizations',
                            table: 'Organization'
                        },
                        {
                            endpoint: 'get_map_pois',
                            table: 'Poi'
                        },
                        {
                            endpoint: 'get_map_poi_types',
                            table: 'Poi_Type'
                        },
                        {
                            endpoint: 'get_map_polygons',
                            table: 'Polygon'
                        }
                    ],
                    always: [
                        {
                            endpoint: 'get_content_menu',
                            f: function(data) {
                                localStorage.set('NEWS', data.title);
                                return DB.populateTable('News', data.contents)
                                .then(function() {
                                    return 'News';
                                }, function(err) {
                                    console.warn(err);
                                    return $q.reject(err);
                                });
                            }
                        },
                        {
                            endpoint: 'get_terms_of_service',
                            storage_name: 'tos'
                        },
                        {
                            endpoint: 'get_sms_terms',
                            storage_name: 'sms_terms'
                        },
                        {
                            endpoint: 'get_contact_info',
                            storage_name: 'contactInfo'
                        },
                        {
                            endpoint: 'get_mapbox_api',
                            storage_name: 'mapbox_api'
                        }
                    ]
                };

                var timedUpdate = function(currentTime) {

                    var lastUpdate = localStorage.get(LAST_UPDATE);

                    var aWeek = 1000 * 3600 * 24 * 7;
                    return (currentTime - lastUpdate) > aWeek;
                };

                var populate = function(item) {
                    console.log(item);

                    var p = API[item.endpoint]();
                    var then;
                    if (typeof item.f === 'function') {
                        then = item.f;
                    } else if (item.table) {
                        then = function(data) {
                            return DB.populateTable(item.table, data)
                            .then(function() {
                                return item.table;
                            }, function(err) {
                                //TODO: what if we need to remake the tables?
                                console.warn(err);
                                return $q.reject(err);
                            });
                        };
                    } else if (item.storage_name) {
                        then = function(data) {
                            return localStorage.set(item.storage_name, data);
                        };
                    }

                    if (then) {
                        return p.then(then);
                    } else {
                        console.error('NO ACTION!');
                    }
                };

                var cleanUser = function() {
                    var p = [];
                    for (var i = 0; i < updates.auth.length; ++i) {
                        if (Array.isArray(updates.auth[i].table)) {
                            for (var j = 0; j < updates.auth[i].table.length; ++j) {
                                p.push(DB.cleanTable(updates.auth[i].table[j]));
                            }
                        } else {
                            p.push(DB.cleanTable(updates.auth[i].table));
                        }
                    }
                    return $q.all(p)
                    .then(function() {
                        console.log('Removed user info from database');
                    }, function(err) {
                        console.log('Could not remove user data from database!', err);
                    });
                };

                var updateFunc = function(forced) {
                    $ionicLoading.show();
                    return $q(function(fulfill, reject) {

                        var promises = [];
                        var currentTime = Date.now();
                        var shouldUpdate = (forced || timedUpdate(currentTime));
                        DB.init()
                        .then(function() {
                            console.log('Initialized DB system');
                            for (var i = 0; i < updates.always.length; ++i) {
                                promises.push(populate(updates.always[i]));
                            }
                            if (sessionData.token) {
                                for (i = 0; i < updates.auth.length; ++i) {
                                    promises.push(populate(updates.auth[i]));
                                }
                            }
                            if (shouldUpdate) {
                                for (i = 0; i < updates.timed.length; ++i) {
                                    promises.push(populate(updates.timed[i]));
                                }
                            }

                            $q.all(promises).then(function(stuff) {
                                console.log('Populated:', stuff);
                                if (shouldUpdate) {
                                    localStorage.set(LAST_UPDATE, currentTime);
                                }
                                fulfill('Pass');
                            }, function(err) {
                                if (err.error_code === 7) {
                                    // Authentication failure
                                    // TODO: Show to user
                                    cleanUser();
                                    API.user_logout();
                                    reject('auth failure');
                                } else {
                                    console.warn('Got an error, recreate all tables:', err);
                                    return DB.clean()
                                    .then(updateFunc);
                                }
                            })
                            .finally(function() {
                                $ionicLoading.hide();
                            });
                        });

                    });
                };

                return {
                    update: function() {
                        return updateFunc();
                    },

                    forcedUpdate: function() {
                        return updateFunc(true);
                    },

                    user_logout: function() {
                        cleanUser();
                        return API.user_logout();
                    },
                    user_login: function(username, password) {
                        return API.user_login(username, password)
                        .then(function() {
                            updateFunc();
                        });
                    },
                    last_update: function() {
                        return localStorage.get(LAST_UPDATE);
                    }
                };
            }
        ];
    });
})(window.angular);
;
angular.module('ifiske.utils', [])

.factory('localStorage', ['$window', function($window) {
    return {
        set: function(key, value) {
            $window.localStorage.setItem(key, value);
        },
        get: function(key) {
            return $window.localStorage.getItem(key);
        },
        remove: function(key) {
            $window.localStorage.removeItem(key);
        }
    };
}])
.service('sessionData', ['localStorage', function(localStorage) {
    this.token = localStorage.get('session');

    this.setToken = function(t) {
        localStorage.set('session', t);
        this.token = t;
        console.log('token set');
    };
    this.deleteToken = function() {
        localStorage.remove('session');
        this.token = null;
        console.log('token unset');
    };
}])

.factory('Licenses', [
    '$http',
    function($http) {
        return {
            get: function() {
                return $http.get('static/licenses.json');
            }
        };
    }
]);
;
angular.module('ngCordovaSms', [])
.directive('ngCordovaSms', ['$cordovaSms', '$ionicPopup', function($cordovaSms, $ionicPopup) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                e.preventDefault();
                $ionicPopup.prompt({
                    title: 'Skriv in ditt namn',
                    inputType: 'text'
                }).then(function(name) {
                    var message = 'FISKA ' + attrs.ngCordovaSms + ' ' + name;
                    $cordovaSms.send('72456', message, 'INTENT', function() {
                        console.log('succuess');
                    }, function(err) {
                        console.log(err);
                    });
                });
            });
        }
    };
}]);
;
angular.module('ifiske.directives')
.directive('ifiskeInput', function() {
    return {
        restrict: 'E',
        transclude: true,

        scope: {
            name: '@',
            id: '@',
            label: '@',
            placeholder: '@',
            type: '@',
            ngPattern: '@',
            ngModel: '=?'

        },
        templateUrl: 'directives/input_field/ifiske_input.html',
        controller: function($scope) {
            $scope.id = $scope.id || $scope.name;
            $scope.type = $scope.type || 'text';
        }
    }
})
;
angular.module('ifiske.directives', [])
.directive('ifiskeMap', function() {
    return {
        restrict: 'E',
        transclude: false,
        templateUrl: 'directives/map/map.html',
        link: function(scope, iElement, iAttrs, ctrl) {
            console.debug(scope, ctrl);
        },
        scope: {
            mapData: '='
        },
        controller: function($scope, $timeout, localStorage, DB, $q) {
            var mapboxUrl = 'http://api.tiles.mapbox.com/v4/{maptype}/{z}/{x}/{y}@2x.png?access_token={apikey}';
            var apikey = localStorage.get('mapbox_api');

            var lc = new L.control.locate({
                follow: false,
                position: 'bottomright',
                keepCurrentZoomLevel: false,
                stopFollowingOnDrag: true,
                remainActive: true,
                onLocationError: function(err) {
                    console.error(err);
                    $timeout(function() {
                        lc.start(); //try again
                    });
                },
                onLocationOutsideMapBounds: function(context) {
                    console.log(context);
                },
                locateOptions: {
                    maxZoom: 14
                },
                icon: 'icon ion-android-locate'

            });

            var overlayParams ={
                showOnSelector: false,
                disableClusteringAtZoom: 9,
                chunkedLoading: true,
                showCoverageOnHover: false,
                removeOutsideVisibleBounds: true
            };

            angular.extend($scope, {
                map: {
                    paths: {},
                    markers: {},
                    layers: {
                        baselayers: {
                            outdoors: {
                                name: 'Utomhus',
                                type: 'xyz',
                                url: mapboxUrl,
                                layerOptions: {
                                    maptype: 'mapbox.outdoors',
                                    apikey: apikey
                                }
                            },
                            satellite: {
                                name: 'Satellit',
                                type: 'xyz',
                                url: mapboxUrl,
                                layerOptions: {
                                    maptype: 'mapbox.satellite',
                                    apikey: apikey
                                }
                            }
                        },
                        overlays: {
                            areas: {
                                name: 'Fiskeområden',
                                type: 'markercluster',
                                visible: true,
                                layerParams: overlayParams
                            },
                            pois: {
                                name: 'Pois',
                                type: 'markercluster',
                                visible: true,
                                layerParams: overlayParams
                            }
                        }
                    },
                    center: {
                        lat: 62.0,
                        lng: 15.0,
                        zoom: 9
                    },
                    controls: {
                        custom: [
                            lc
                        ]
                    }
                }
            });

            var createscope = function(a) {
                return function() {
                    var new_scope = $scope.$new();
                    new_scope.area = a;
                    console.log(a);
                    return new_scope;
                };
            };

            var icons;
            var createIcons = function () {
                if (icons) {
                    return $q.when(icons);
                } else {
                    return DB.getPoiTypes()
                    .then(function(poi_types) {
                        icons = {};
                        for (var i = 0; i < poi_types.length; ++i) {
                            var type = poi_types[i];
                            icons[type.ID] = {
                                iconUrl: 'http://www.ifiske.se' + type.icon,
                                iconAnchor: [16, 37], // point of the icon which will correspond to marker's location
                                popupAnchor: [0, -35],
                            };
                        }
                    });
                }
            };

            var createMarkers = function(areas) {
                for(var i = 0; i < areas.length; ++i) {
                    var a = areas[i];
                    $scope.map.markers['area_' + i] = {
                        layer: 'areas',
                        lat: a.lat,
                        lng: a.lng,
                        getMessageScope: createscope(a), //TODO: dont create multiple scopes
                        message: '<a ui-sref="app.area.info({id: area.ID })" ng-bind="area.t"></a>',
                        icon: {
                            type: 'awesomeMarker',
                            icon: a.favorite ? 'star': '',
                            markerColor: a.wsc ? (a.favorite ? 'orange' : 'blue') : 'lightgray',
                            prefix: 'ion'
                        }
                    };
                }
            };

            var createPois = function(pois) {
                createIcons().then(function() {
                    for (var i = 0; i < pois.length; ++i) {
                        var poi = pois[i];

                        $scope.map.markers['poi_' + i] = {
                            layer: 'pois',
                            lat: poi.la,
                            lng: poi.lo,
                            icon: icons[poi.type],
                            message: '<h4>' + poi.t + '</h4><p>' + poi.d + '</p>',
                            popupOptions: {
                                maxWidth: window.innerWidth - 50
                            }
                        };
                    }
                });
            };

            var createPolygons = function(polygons) {
                $scope.map.paths = polygons.map(function(poly) {
                    return {
                        latlngs: JSON.parse('[' + poly.poly + ']'),
                        color: poly.c,
                        weight: 2,
                        opacity: 0.5,
                        fillColor: poly.c,
                        type: 'polygon'
                    };
                });
            };

            var createArea = function(area) {
                $scope.map.markers.area = {
                    layer: 'pois',
                    lat: area.lat,
                    lng: area.lng,
                    message: area.t
                };
                $scope.map.center = {
                    lat: area.lat,
                    lng: area.lng,
                    zoom: Number(area.zoom) ? Number(area.zoom) : 9
                };
            };

            $scope.$watch('mapData', function(data) {
                if (data.centerOnMe) {
                    $scope.map.center.autoDiscover = true;
                }
                if(data.areas) {
                    createMarkers(data.areas);
                }
                if (data.pois) {
                    createPois(data.pois);
                }
                if (data.polygons) {
                    createPolygons(data.polygons);
                }
                if (data.area) {
                    createArea(data.area);
                }
            }, true);
        }
    };
});
;
angular.module('systemBrowser', [])
.directive('systemBrowser', ['$cordovaInAppBrowser', function($cordovaInAppBrowser) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                $cordovaInAppBrowser.open(el[0].href, '_system');
                e.preventDefault();
            });
        }
    };
}])
.directive('globalSystemBrowser', ['$cordovaInAppBrowser', function($cordovaInAppBrowser) {
    'use strict';
    return {
        restrict: 'A',
        link: function (scope, el, attrs) {
            el.on('click', function(e) {
                if (e.target.href && e.target.host !== window.location.host) {
                    $cordovaInAppBrowser.open(e.target.href, '_system');
                    e.preventDefault();
                }
            });
        }
    };
}]);
;
angular.module('ifiske.directives', [])
.directive('ionicTabs', function() {
    return {
        scope: true,
        restrict: 'E',
        transclude: true,
        templateUrl: 'directives/tabs/tabs.html',
        link: function(scope) {
            console.log(scope);
        },
        controller: function($scope, $ionicHistory, $state, $ionicViewSwitcher) {
            // $scope is the appropriate scope for the directive
            $scope.tabs = [];
            this.addChild = function(nestedDirective) {
                $scope.tabs.push(nestedDirective);
            };
            $scope.goto = function(state) {
                $ionicHistory.viewHistory().currentView = $ionicHistory.viewHistory().backView;
                $ionicViewSwitcher.nextTransition('none');
                $state.go(state, null, {
                    location: 'replace'
                });
            };
        }
    };
})
.directive('ionicTab', function() {
    return {
        scope:{
            icon: '@',
            name: '@',
            viewName: '@'
        },
        restrict: 'E',
        require: '^ionicTabs',
        link: function(scope, elem, attrs, controllerInstance) {
            console.log(scope);
            console.log(scope.$parent.area);
            controllerInstance.addChild(scope);
        }
    };
});

;
/*angular.module('treeTabs', ['ionic'])
    .directive('ionTabs', ['$rootScope','$state','$ionicHistory','$ionicViewSwitcher', function($rootScope, $state, $ionicHistory, $ionicViewSwitcher) {
	function getTabRootState(state) {
	    var isRootState;

	    if (state.parent.self.abstract) {
		isRootState = state.self.name;
	    } else {
		isRootState = false;
	    }

	    return  isRootState || getTabRootState(state.parent);
	}

	function isTabRootState(state) {
	    return state.self.name === getTabRootState(state);
	}

	return {
	    restrict: 'EA',
	    require: 'ionTabs',
	    link: function(scope, element, attr, ctrl) {
		console.log('s: ',scope);
		console.log('e: ',element);
		console.log('a: ',attr);
		console.log('c: ',ctrl);
		var selectTab = ctrl.select;
		ctrl.select = function(tab, shouldEmitEvent) {
		    var selectedTab = ctrl.selectedTab();

		    if (arguments.length === 1) {
			shouldEmitEvent = !!(tab.navViewName || tab.uiSref);
		    }

		    if (selectedTab && selectedTab.$historyId == tab.$historyId && !isTabRootState($state.$current)) {
			if (shouldEmitEvent) {
			    $ionicHistory.nextViewOptions({
				disableBack: true,
				historyRoot: false
			    });
			    $ionicViewSwitcher.nextDirection('back');
			    $state.go(getTabRootState($state.$current));
			}
		    } else if (selectedTab && selectedTab.$historyId == tab.$historyId && isTabRootState($state.$current)) {
			return;
		    } else {
			selectTab.apply(this, arguments);
		    }
		};
	    }
	};
    }]);
*/

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFib3V0L2Fib3V0X2NvbnRyb2xsZXIuanMiLCJhcmVhL2FyZWFfY2FyZHNfY29udHJvbGxlci5qcyIsImFyZWEvYXJlYV9jb250cm9sbGVyLmpzIiwiYXJlYS9hcmVhX2Zpc2hfY29udHJvbGxlci5qcyIsImFyZWEvYXJlYV9pbmZvX2NvbnRyb2xsZXIuanMiLCJhcmVhL2FyZWFfbWFwX2NvbnRyb2xsZXIuanMiLCJhcmVhX2xpc3QvYXJlYV9saXN0X2NvbnRyb2xsZXIuanMiLCJjb250YWN0L2NvbnRhY3RfY29udHJvbGxlci5qcyIsImZpbmRfYXJlYXMvY291bnRpZXNfY29udHJvbGxlci5qcyIsImZpbmRfYXJlYXMvZmF2b3JpdGVzX2NvbnRyb2xsZXIuanMiLCJmaW5kX2FyZWFzL3RhYnNfY29udHJvbGxlci5qcyIsImZpc2hfZGV0YWlsL2Zpc2hfZGV0YWlsX2NvbnRyb2xsZXIuanMiLCJmaXNoZXMvZmlzaGVzX2NvbnRyb2xsZXIuanMiLCJob21lL2hvbWVfY29udHJvbGxlci5qcyIsImxlZ2FsL2xlZ2FsX2NvbnRyb2xsZXIuanMiLCJsb2dpbi9sb2dpbl9jb250cm9sbGVyLmpzIiwibWFwL21hcF9jb250cm9sbGVyLmpzIiwibWVudS9tZW51X2NvbnRyb2xsZXIuanMiLCJuZXdzL25ld3NfY29udHJvbGxlci5qcyIsIm5ld3MvbmV3c2l0ZW1fY29udHJvbGxlci5qcyIsInJlY292ZXIvcmVjb3Zlcl9jb250cm9sbGVyLmpzIiwicmVnaXN0ZXIvcmVnaXN0ZXJfY29udHJvbGxlci5qcyIsInRlY2huaXF1ZV9kZXRhaWwvdGVjaG5pcXVlX2RldGFpbF9jb250cm9sbGVyLmpzIiwidGVjaG5pcXVlcy90ZWNobmlxdWVzX2NvbnRyb2xsZXIuanMiLCJ1c2VyL3VzZXJfY29udHJvbGxlci5qcyIsInVzZXJfY2FyZHMvdXNlcl9jYXJkc19jb250cm9sbGVyLmpzIiwiYXBpLmpzIiwiZGIuanMiLCJmaWx0ZXIuanMiLCJ1cGRhdGUuanMiLCJ1dGlscy5qcyIsImlmaXNrZV9zbXMvaWZpc2tlX3Ntcy5qcyIsImlucHV0X2ZpZWxkL2lmaXNrZV9pbnB1dC5qcyIsIm1hcC9tYXAuanMiLCJzeXN0ZW1fYnJvd3Nlci9zeXN0ZW1fYnJvd3Nlci5qcyIsInRhYnMvdGFicy5qcyIsInRyZWVfdGFicy90cmVlX3RhYnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDelBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNob0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDck5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhbmd1bGFyLm1vZHVsZSBpcyBhIGdsb2JhbCBwbGFjZSBmb3IgY3JlYXRpbmcsIHJlZ2lzdGVyaW5nIGFuZCByZXRyaWV2aW5nIEFuZ3VsYXIgbW9kdWxlc1xuLy8gJ2lmaXNrZScgaXMgdGhlIG5hbWUgb2YgdGhpcyBhbmd1bGFyIG1vZHVsZSAoYWxzbyBzZXQgaW4gYSA8Ym9keT4gYXR0cmlidXRlIGluIGluZGV4Lmh0bWwpXG4vLyB0aGUgMm5kIHBhcmFtZXRlciBpcyBhbiBhcnJheSBvZiAncmVxdWlyZXMnXG4vLyAnaWZpc2tlLmNvbnRyb2xsZXJzJyBpcyBmb3VuZCBpbiBjb250cm9sbGVycy5qc1xuXG5hbmd1bGFyLm1vZHVsZSgnaWZpc2tlJywgW1xuICAgICdpb25pYycsXG4gICAgJ2lmaXNrZS5jb250cm9sbGVycycsXG4gICAgJ2lmaXNrZS5kaXJlY3RpdmVzJyxcbiAgICAnaWZpc2tlLmFwaScsXG4gICAgJ2lmaXNrZS5kYicsXG4gICAgJ2lmaXNrZS51dGlscycsXG4gICAgJ2lmaXNrZS51cGRhdGUnLFxuICAgICdpZmlza2UuZmlsdGVycycsXG4gICAgJ2lvbmljLmlvbi5oZWFkZXJTaHJpbmsnLFxuICAgICduZ0NvcmRvdmEnLFxuICAgICdzeXN0ZW1Ccm93c2VyJyxcbiAgICAnbmdDb3Jkb3ZhU21zJyxcbiAgICAnbmdNZXNzYWdlcycsXG4gICAgJ0ltZ0NhY2hlJyxcbiAgICAnbGVhZmxldC1kaXJlY3RpdmUnLFxuICAgICd0YWJTbGlkZUJveCdcbl0pXG5cbi5jb25zdGFudCgnJGlvbmljTG9hZGluZ0NvbmZpZycsIHtcbiAgICB0ZW1wbGF0ZTogJzxpb24tc3Bpbm5lcj48L2lvbi1zcGlubmVyPidcbiAgICAvLyBoaWRlT25TdGF0ZUNoYW5nZTogdHJ1ZVxufSlcbi5ydW4oW1xuICAgICckaW9uaWNQbGF0Zm9ybScsXG4gICAgJ1VwZGF0ZScsXG4gICAgJ0ltZ0NhY2hlJyxcbiAgICAnJHJvb3RTY29wZScsXG4gICAgZnVuY3Rpb24oJGlvbmljUGxhdGZvcm0sIFVwZGF0ZSwgSW1nQ2FjaGUsICRyb290U2NvcGUpIHtcblxuICAgICAgICAkcm9vdFNjb3BlLmltYWdlX2VuZHBvaW50ID0gJ2h0dHA6Ly93d3cuaWZpc2tlLnNlJztcbiAgICAgICAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBIaWRlIHRoZSBhY2Nlc3NvcnkgYmFyIGFib3ZlIHRoZSBrZXlib2FyZCBmb3IgZm9ybSBpbnB1dHNcbiAgICAgICAgICAgIGlmICh3aW5kb3cuaW9uaWMgJiYgd2luZG93LmlvbmljLktleWJvYXJkKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmlvbmljLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3aW5kb3cuU3RhdHVzQmFyKSB7XG4gICAgICAgICAgICAgICAgLy8gb3JnLmFwYWNoZS5jb3Jkb3ZhLnN0YXR1c2JhciByZXF1aXJlZFxuICAgICAgICAgICAgICAgIHdpbmRvdy5TdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEltZ0NhY2hlLiRpbml0KCk7XG4gICAgICAgICAgICBVcGRhdGUudXBkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbl0pXG5cbi5jb25maWcoW1xuICAgICckc3RhdGVQcm92aWRlcicsXG4gICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgJyRpb25pY0NvbmZpZ1Byb3ZpZGVyJyxcbiAgICAnSW1nQ2FjaGVQcm92aWRlcicsXG4gICAgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGlvbmljQ29uZmlnUHJvdmlkZXIsIEltZ0NhY2hlUHJvdmlkZXIpIHtcblxuICAgICAgICBJbWdDYWNoZVByb3ZpZGVyLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAgICAgdXNlUGVyc2lzdGVudENhY2hlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBJbWdDYWNoZVByb3ZpZGVyLm1hbnVhbEluaXQgPSB0cnVlO1xuXG4gICAgICAgIC8vRGlzYWJsZSBzd2lwZSB0byBnbyBiYWNrIHNpbmNlIGl0IGlzIGJ1Z2dlZFxuICAgICAgICAkaW9uaWNDb25maWdQcm92aWRlci52aWV3cy5zd2lwZUJhY2tFbmFibGVkKGZhbHNlKTtcblxuICAgICAgICAvLyBDYWNoZSB2aWV3cyBpbiB0aGUgZm9yd2FyZCBzdGFja1xuICAgICAgICAkaW9uaWNDb25maWdQcm92aWRlci52aWV3cy5mb3J3YXJkQ2FjaGUodHJ1ZSk7XG5cbiAgICAgICAgLy8gQ2xlYXIgYmFjayBidXR0b24gZGVmYXVsdCB0ZXh0XG4gICAgICAgICRpb25pY0NvbmZpZ1Byb3ZpZGVyLmJhY2tCdXR0b24ucHJldmlvdXNUaXRsZVRleHQoZmFsc2UpLnRleHQoJycpO1xuXG4gICAgICAgIC8vIFRhYnMgcG9zaXRpb25cbiAgICAgICAgJGlvbmljQ29uZmlnUHJvdmlkZXIudGFicy5wb3NpdGlvbignYm90dG9tJyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIElvbmljIHVzZXMgQW5ndWxhclVJIFJvdXRlci4gTGVhcm4gbW9yZSBoZXJlOlxuICAgICAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci11aS91aS1yb3V0ZXJcbiAgICAgICAgICovXG5cbiAgICAgICAgdmFyIGRlZmF1bHRVcmwgPSAnL2FwcC9sb2dpbic7XG4gICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Nlc3Npb24nKSkge1xuICAgICAgICAgICAgZGVmYXVsdFVybCA9ICcvYXBwL2hvbWUnO1xuICAgICAgICB9XG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoZGVmYXVsdFVybCk7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcblxuICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgIHVybDogJy9hcHAnLFxuICAgICAgICAgICAgLy9hYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9tZW51L21lbnUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWVudUN0cmwnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLnN0YXRlKCdhcHAubG9naW4nLCB7XG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2xvZ2luL2xvZ2luLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ3RybCdcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBBY2NvdW50IHJlY292ZXJ5XG4gICAgICAgIC5zdGF0ZSgnYXBwLnJlY292ZXInLCB7XG4gICAgICAgICAgICB1cmw6ICcvcmVjb3ZlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvcmVjb3Zlci9yZWNvdmVyLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlY292ZXJDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5yZWNvdmVyLmxvc3RwYXNzd29yZCcsIHtcbiAgICAgICAgICAgIHVybDogJy9sb3N0cGFzc3dvcmQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3JlY292ZXIvbG9zdHBhc3N3b3JkLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLnJlY292ZXIucmVzZXRwYXNzd29yZCcsIHtcbiAgICAgICAgICAgIHVybDogJy9yZXNldHBhc3N3b3JkJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9yZWNvdmVyL3Jlc2V0cGFzc3dvcmQuaHRtbCdcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBBY2NvdW50IHJlZ2lzdHJhdGlvblxuICAgICAgICAuc3RhdGUoJ2FwcC5yZWdpc3RlcicsIHtcbiAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvcmVnaXN0ZXIvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUmVnaXN0ZXJDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5yZWdpc3Rlci5kZXRhaWxzJywge1xuICAgICAgICAgICAgdXJsOiAnL2RldGFpbHMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3JlZ2lzdGVyL3JlZ2lzdGVyX2RldGFpbHMuaHRtbCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAucmVnaXN0ZXIudmVyaWZ5Jywge1xuICAgICAgICAgICAgdXJsOiAnL3ZlcmlmeScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvcmVnaXN0ZXIvcmVnaXN0ZXJfdmVyaWZ5Lmh0bWwnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy9cbiAgICAgICAgLnN0YXRlKCdhcHAuaG9tZScsIHtcbiAgICAgICAgICAgIHVybDogJy9ob21lJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9ob21lL2hvbWUuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmluZm8nLCB7XG4gICAgICAgICAgICB1cmw6ICcvaW5mbycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvaW5mby9pbmZvLmh0bWwnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLnN0YXRlKCdhcHAuYnVncycsIHtcbiAgICAgICAgICAgIHVybDogJy9pbmZvJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9tZW51L3JlcG9ydC5odG1sJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5jb250YWN0Jywge1xuICAgICAgICAgICAgdXJsOiAnL2NvbnRhY3QnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2NvbnRhY3QvY29udGFjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb250YWN0Q3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAubGVnYWwnLCB7XG4gICAgICAgICAgICB1cmw6ICcvbGVnYWwnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2xlZ2FsL2xlZ2FsLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xlZ2FsQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuYWJvdXQnLCB7XG4gICAgICAgICAgICB1cmw6ICcvYWJvdXQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2Fib3V0L2Fib3V0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0Fib3V0Q3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAudXNlcmluZm8nLCB7XG4gICAgICAgICAgICB1cmw6ICcvdXNlcmluZm8nLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJDdHJsJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy91c2VyL3VzZXIuaHRtbCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmZpbmRfYXJlYXMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZmluZF9hcmVhcycsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmluZF9hcmVhcy90YWJzLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0ZpbmRBcmVhc0N0cmwnLFxuICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWVcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuZmluZF9hcmVhcy5jb3VudGllcycsIHtcbiAgICAgICAgICAgIHVybDogJy9jb3VudGllcycsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICdpb25pYy10YWJzJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmluZF9hcmVhcy9jb3VudGllcy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvdW50aWVzQ3RybCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmZpbmRfYXJlYXMuZmF2b3JpdGVzJywge1xuICAgICAgICAgICAgdXJsOiAnL2Zhdm9yaXRlcycsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICdpb25pYy10YWJzJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmluZF9hcmVhcy9mYXZvcml0ZXMuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdGYXZvcml0ZXNDdHJsJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuYXJlYXMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvYXJlYXMnLFxuICAgICAgICAgICAgcGFyYW1zOiB7J2lkJzogZmFsc2UsICdjb3VudHknOiBmYWxzZSwgJ3NlYXJjaCc6ICcnfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hcmVhX2xpc3QvYXJlYV9saXN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFzQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuY2FyZHMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvY2FyZHMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL3VzZXJfY2FyZHMvdXNlcl9jYXJkcy5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2VyQ2FyZHNDdHJsJ1xuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5mYXZvcml0ZXMnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZmF2b3JpdGVzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9mYXZvcml0ZXMvZmF2b3JpdGVzLmh0bWwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmZpc2hlcycsIHtcbiAgICAgICAgICAgIHVybDogJy9maXNoZXMnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2Zpc2hlcy9maXNoZXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmlzaGVzQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuZmlzaGRldGFpbCcsIHtcbiAgICAgICAgICAgIHVybDogJy9maXNoZGV0YWlsLzppZCcsXG4gICAgICAgICAgICBwYXJhbXM6IHsnaWQnOiBmYWxzZSwgJ2Zpc2gnOiBmYWxzZX0sXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvZmlzaF9kZXRhaWwvZmlzaF9kZXRhaWwuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnRmlzaERldGFpbEN0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLm1hcCcsIHtcbiAgICAgICAgICAgIHVybDogJy9tYXAnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL21hcC9tYXAuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWFwQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAudGVjaG5pcXVlcycsIHtcbiAgICAgICAgICAgIHVybDogJy90ZWNobmlxdWVzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy90ZWNobmlxdWVzL3RlY2huaXF1ZXMuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnVGVjaG5pcXVlc0N0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLnRlY2huaXF1ZWRldGFpbCcsIHtcbiAgICAgICAgICAgIHVybDogJy90ZWNobmlxdWVkZXRhaWwvOmlkJyxcbiAgICAgICAgICAgIHBhcmFtczogeydpZCc6IGZhbHNlLCAndGVjaCc6IGZhbHNlfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy90ZWNobmlxdWVfZGV0YWlsL3RlY2huaXF1ZV9kZXRhaWwuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnVGVjaG5pcXVlRGV0YWlsQ3RybCdcbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAubmV3cycsIHtcbiAgICAgICAgICAgIHVybDogJy9uZXdzJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9uZXdzL25ld3MuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTmV3c0N0cmwnXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLm5ld3NpdGVtJywge1xuICAgICAgICAgICAgdXJsOiAnL25ld3MvOmlkJyxcbiAgICAgICAgICAgIHBhcmFtczogeydpdGVtJzogZmFsc2UsICdpZCc6IGZhbHNlfSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9uZXdzL25ld3NpdGVtLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ05ld3NJdGVtQ3RybCdcbiAgICAgICAgfSlcblxuICAgICAgICAuc3RhdGUoJ2FwcC5hcmVhJywge1xuICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICB1cmw6ICcvYXJlYS86aWQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2FyZWEvYXJlYS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBcmVhQ3RybCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5zdGF0ZSgnYXBwLmFyZWEuaW5mbycsIHtcbiAgICAgICAgICAgIHVybDogJy9pbmZvJyxcbiAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgJ2lvbmljLXRhYnMnOiB7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29tcG9uZW50cy9hcmVhL2luZm8uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBcmVhSW5mb0N0cmwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5hcmVhLm1hcCcsIHtcbiAgICAgICAgICAgIHVybDogJy9tYXAnLFxuICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAnaW9uaWMtdGFicyc6IHtcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb21wb25lbnRzL2FyZWEvbWFwLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQXJlYU1hcEN0cmwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuc3RhdGUoJ2FwcC5hcmVhLmZpc2gnLCB7XG4gICAgICAgICAgICB1cmw6ICcvZmlzaCcsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICdpb25pYy10YWJzJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvYXJlYS9maXNoLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQXJlYUZpc2hDdHJsJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnN0YXRlKCdhcHAuYXJlYS5jYXJkcycsIHtcbiAgICAgICAgICAgIHVybDogJy9jYXJkcycsXG4gICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICdpb25pYy10YWJzJzoge1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBvbmVudHMvYXJlYS9jYXJkcy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0FyZWFDYXJkc0N0cmwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5dKTtcblxuYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycsIFtdKTtcbmFuZ3VsYXIubW9kdWxlKCdpZmlza2UuZGlyZWN0aXZlcycsIFtdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0Fib3V0Q3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJGNvcmRvdmFBcHBWZXJzaW9uJyxcbiAgICAnJGlvbmljUGxhdGZvcm0nLFxuICAgICckaW9uaWNNb2RhbCcsXG4gICAgJ1VwZGF0ZScsXG4gICAgJ0xpY2Vuc2VzJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRjb3Jkb3ZhQXBwVmVyc2lvbiwgJGlvbmljUGxhdGZvcm0sICRpb25pY01vZGFsLCBVcGRhdGUsIExpY2Vuc2VzKSB7XG4gICAgICAgICRzY29wZS52ZXJzaW9uID0gJHNjb3BlLmRiRGF0ZSA9ICdPa8OkbnQnO1xuICAgICAgICAkc2NvcGUudXBkYXRlID0gVXBkYXRlO1xuXG4gICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhKSB7XG4gICAgICAgICAgICAgICAgJGNvcmRvdmFBcHBWZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKS50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2lGaXNrZSB2ZXJzaW9uOicsIHZlcnNpb24pO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJGNvcmRvdmFBcHBWZXJzaW9uLmdldFZlcnNpb25Db2RlKCkudGhlbihmdW5jdGlvbihidWlsZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYnVpbGQgPSBidWlsZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIExpY2Vuc2VzLmdldCgpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5saWNlbnNlcyA9IGRhdGEuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLmFsZXJ0ID0gZnVuY3Rpb24obCkge1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9ICRzY29wZS4kbmV3KCk7XG4gICAgICAgICAgICAgICAgc2NvcGUubCA9IGw7XG4gICAgICAgICAgICAgICAgJGlvbmljTW9kYWwuZnJvbVRlbXBsYXRlVXJsKFxuICAgICAgICAgICAgICAgICAgICAnY29tcG9uZW50cy9hYm91dC9saWNlbnNlX21vZGFsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICB7c2NvcGU6IHNjb3BlfVxuICAgICAgICAgICAgICAgICkudGhlbihmdW5jdGlvbihtb2RhbCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLnNob3coKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFDYXJkc0N0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJyRpb25pY01vZGFsJyxcbiAgICAnbG9jYWxTdG9yYWdlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRpb25pY01vZGFsLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy9BcmVhX0NhcmRzXG4gICAgICAgICAgICAkc2NvcGUuc21zdGVybXMgPSBsb2NhbFN0b3JhZ2UuZ2V0KCdzbXNfdGVybXMnKTtcbiAgICAgICAgICAgICRzY29wZS5wcmVkaWNhdGUgPSAnc28nO1xuXG4gICAgICAgICAgICAvL1NNUy1tb2RhbFxuICAgICAgICAgICAgJGlvbmljTW9kYWwuZnJvbVRlbXBsYXRlVXJsKCdjb21wb25lbnRzL2FyZWEvc21zX21vZGFsLmh0bWwnLCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246ICdzbGlkZS1pbi11cCdcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24obW9kYWwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zX21vZGFsID0gbW9kYWw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5vcGVuTW9kYWwgPSBmdW5jdGlvbihwcm9kdWN0KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNtc19tb2RhbC5zaG93KCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3QgPSBwcm9kdWN0O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNtc19tb2RhbC5oaWRlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJHNjb3BlLnNob3dUZXJtcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zaG93aW5ndGVybXMgPSAhJHNjb3BlLnNob3dpbmd0ZXJtcztcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkc2NvcGUuc2hvd2luZ3Rlcm1zID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vUnVsZXMgbW9kYWxcbiAgICAgICAgICAgICRpb25pY01vZGFsLmZyb21UZW1wbGF0ZVVybCgnY29tcG9uZW50cy9hcmVhL3J1bGVzX21vZGFsLmh0bWwnLCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246ICdzbGlkZS1pbi11cCdcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24obW9kYWwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucnVsZXNfbW9kYWwgPSBtb2RhbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLm9wZW5SdWxlc01vZGFsID0gZnVuY3Rpb24ocHJvZHVjdCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5zaG93KCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3QgPSBwcm9kdWN0O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICRzY29wZS5jbG9zZVJ1bGVzTW9kYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucnVsZXNfbW9kYWwuaGlkZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc21zX21vZGFsLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGVQYXJhbXMnLFxuICAgICdEQicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIERCKSB7XG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmVlbnRlciBhcmVhX2NvbnRyb2xsZXIuanMnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgREIuZ2V0QXJlYSgkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGFyZWEpIHtcbiAgICAgICAgICAgICRzY29wZS5hcmVhID0gYXJlYTtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdpZmlza2UtYXJlYScpO1xuXG4gICAgICAgICAgICBhcmVhLmltYWdlcy50aGVuKGZ1bmN0aW9uKGltYWdlcykge1xuICAgICAgICAgICAgICAgICRzY29wZS5pbWFnZXMgPSBpbWFnZXM7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgREIuZ2V0T3JnYW5pemF0aW9uKGFyZWEub3JnaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihvcmcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUub3JnID0gb3JnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgREIuZ2V0QXJlYUZpc2hlcygkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGZpc2hlcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZmlzaGVzKTtcbiAgICAgICAgICAgICRzY29wZS5maXNoZXMgPSBmaXNoZXM7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgREIuZ2V0UHJvZHVjdHNCeUFyZWEoJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAudGhlbihmdW5jdGlvbihwcm9kdWN0cykge1xuICAgICAgICAgICAgJHNjb3BlLnByb2R1Y3RzID0gcHJvZHVjdHM7XG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFGaXNoQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUpIHtcbiAgICAgICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2JlZm9yZWVudGVyIGFyZWFfZmlzaF9jb250cm9sbGVyLmpzJywgJHNjb3BlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLnNvcnRvcmRlciA9ICctYW1vdW50JztcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFJbmZvQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJGlvbmljU2xpZGVCb3hEZWxlZ2F0ZScsXG4gICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAnJGlvbmljUG9wdXAnLFxuICAgICdBUEknLFxuICAgICdEQicsXG4gICAgJyRpb25pY1BsYXRmb3JtJyxcbiAgICAnJGNvcmRvdmFUb2FzdCcsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkaW9uaWNTbGlkZUJveERlbGVnYXRlLCBzZXNzaW9uRGF0YSwgJGlvbmljUG9wdXAsIEFQSSwgREIsICRpb25pY1BsYXRmb3JtLCAkY29yZG92YVRvYXN0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZSk7XG4gICAgICAgICRzY29wZS5nb3RvUHJvZHVjdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpb25pY1NsaWRlQm94RGVsZWdhdGUuJGdldEJ5SGFuZGxlKCd0YWJzJykuc2xpZGUoMSk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLmNoYW5nZUZhdm9yaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbkRhdGEudG9rZW4pIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYXJlYS5mYXZvcml0ZSA9ICEkc2NvcGUuYXJlYS5mYXZvcml0ZTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZTtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFyZWEuZmF2b3JpdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IEFQSS51c2VyX2FkZF9mYXZvcml0ZSgkc2NvcGUuYXJlYS5JRClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gREIuYWRkRmF2b3JpdGUoJHNjb3BlLmFyZWEuSUQpO1xuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvdygnT21yw6VkZXQgw6RyIG51IHRpbGxhZ3QgaSBkaW5hIGZhdm9yaXRlcicsICdzaG9ydCcsICdib3R0b20nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gQVBJLnVzZXJfcmVtb3ZlX2Zhdm9yaXRlKCRzY29wZS5hcmVhLklEKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERCLnJlbW92ZUZhdm9yaXRlKCRzY29wZS5hcmVhLklEKTtcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvdygnT21yw6VkZXQgw6RyIG51IGJvcnR0YWdldCBmcsOlbiBkaW5hIGZhdm9yaXRlcicsICdzaG9ydCcsICdib3R0b20nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0R1IG3DpXN0ZSB2YXJhIGlubG9nZ2FkIGbDtnIgYXR0IGt1bm5hIG1hcmtlcmEgZmlza2V2YXR0ZW4gc29tIGZhdm9yaXRlci4nLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignQXJlYU1hcEN0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgJ0RCJyxcbiAgICAnbGVhZmxldEV2ZW50cycsXG4gICAgJyRpb25pY1BsYXRmb3JtJyxcbiAgICAnJGNvcmRvdmFHZW9sb2NhdGlvbicsXG4gICAgJyRjb3Jkb3ZhRGV2aWNlT3JpZW50YXRpb24nLFxuICAgICckdGltZW91dCcsXG4gICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBEQiwgbGVhZmxldEV2ZW50cywgJGlvbmljUGxhdGZvcm0pIHtcbiAgICAgICAgJHNjb3BlLm1hcCA9IHt9O1xuICAgICAgICB2YXIgdXBkYXRlTWFwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUubWFwLmFyZWEgPSAkc2NvcGUuYXJlYTtcbiAgICAgICAgICAgIERCLmdldFBvaXMoJHNjb3BlLmFyZWEub3JnaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihwb2lzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5wb2lzID0gcG9pcztcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgREIuZ2V0UG9seWdvbnMoJHNjb3BlLmFyZWEub3JnaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihwb2x5Z29ucykge1xuICAgICAgICAgICAgICAgICRzY29wZS5tYXAucG9seWdvbnMgPSBwb2x5Z29ucztcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYXJlYSkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZU1hcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHNjb3BlLiRvbignaWZpc2tlLWFyZWEnLCB1cGRhdGVNYXApO1xuXG5cbiAgICAgICAgICAgICRzY29wZS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsYXVuY2huYXZpZ2F0b3IubmF2aWdhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBbJHNjb3BlLm5hdnRvLmxhdCwgJHNjb3BlLm5hdnRvLmxuZ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wZW5pbmcgbmF2aWdhdG9yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgnTmF2aWdhdGlvbiBmYWlsZWQhJywgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZW5hYmxlZEV2ZW50cyA9IFsncG9wdXBvcGVuJywgJ3BvcHVwY2xvc2UnXTtcbiAgICAgICAgICAgICRzY29wZS5ldmVudHMgPSB7XG4gICAgICAgICAgICAgICAgZW5hYmxlZDogZW5hYmxlZEV2ZW50c1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignbGVhZmxldERpcmVjdGl2ZU1hcmtlci5wb3B1cG9wZW4nLCBmdW5jdGlvbihldmVudCwgYXJncykge1xuICAgICAgICAgICAgICAgIC8vc2hvdyBuYXZ0b2J1dHRvblxuICAgICAgICAgICAgICAgICRzY29wZS5uYXZ0byA9IGFyZ3MubW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignbGVhZmxldERpcmVjdGl2ZU1hcmtlci5wb3B1cGNsb3NlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy9oaWRlIG5hdnRvYnV0dG9uXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hdnRvID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0FyZWFzQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAnJGlvbmljU2Nyb2xsRGVsZWdhdGUnLFxuICAgICdEQicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsICRpb25pY1Njcm9sbERlbGVnYXRlLCBEQikge1xuXG4gICAgICAgIHZhciBjb3B5ID0gJHN0YXRlUGFyYW1zLnNlYXJjaDtcbiAgICAgICAgJHNjb3BlLnNlYXJjaCA9IGNvcHk7XG4gICAgICAgICRzY29wZS5jb3VudHkgPSAkc3RhdGVQYXJhbXMuY291bnR5IHx8ICdTw7ZrcmVzdWx0YXQnO1xuICAgICAgICBEQi5zZWFyY2goJycsICRzdGF0ZVBhcmFtcy5pZClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmFyZWFzID0gZGF0YTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLmNsZWFyU2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VhcmNoID0gJyc7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5zY3JvbGxUb3AgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpb25pY1Njcm9sbERlbGVnYXRlLnNjcm9sbFRvcCgpO1xuICAgICAgICB9O1xuXG4gICAgfVxuXSk7XG5cbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0NvbnRhY3RDdHJsJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJ2xvY2FsU3RvcmFnZScsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgJHNjb3BlLmNvbnRhY3RJbmZvID0gbG9jYWxTdG9yYWdlLmdldCgnY29udGFjdEluZm8nKTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0NvdW50aWVzQ3RybCcsIFsnJHNjb3BlJywgJ0RCJywgJyRzdGF0ZScsICckaW9uaWNIaXN0b3J5JywgZnVuY3Rpb24oJHNjb3BlLCBEQiwgJHN0YXRlLCAkaW9uaWNIaXN0b3J5KSB7XG4gICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgREIuZ2V0Q291bnRpZXMoKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUuY291bnRpZXMgPSBkYXRhO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGluaXRpYWxpemUpO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignRmF2b3JpdGVzQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnREInLFxuICAgICckY29yZG92YVRvYXN0JyxcbiAgICAnQVBJJyxcbiAgICAnJGlvbmljQWN0aW9uU2hlZXQnLFxuICAgICckaW9uaWNQbGF0Zm9ybScsXG4gICAgJyRpb25pY0hpc3RvcnknLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgREIsICRjb3Jkb3ZhVG9hc3QsIEFQSSwgJGlvbmljQWN0aW9uU2hlZXQsICRpb25pY1BsYXRmb3JtLCAkaW9uaWNIaXN0b3J5KSB7XG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBEQi5nZXRVc2VyRmF2b3JpdGVzKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmF2b3JpdGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kb24oJyRpb25pY1ZpZXcuYmVmb3JlRW50ZXInLCBpbml0aWFsaXplKTtcblxuICAgICAgICB2YXIgcmVtb3ZlRmF2b3JpdGUgPSBmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICBBUEkudXNlcl9yZW1vdmVfZmF2b3JpdGUoYXJlYS5JRCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBEQi5yZW1vdmVGYXZvcml0ZShhcmVhLklEKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmF2b3JpdGVzLnNwbGljZSgkc2NvcGUuZmF2b3JpdGVzLmluZGV4T2YoYXJlYSksIDEpO1xuICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGx1Z2lucy50b2FzdC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvdygnT21yw6VkZXQgw6RyIG51IGJvcnR0YWdldCBmcsOlbiBkaW5hIGZhdm9yaXRlcicsICdzaG9ydCcsICdib3R0b20nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5ub3RpZnkgPSBmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcmVhKTtcbiAgICAgICAgICAgIEFQSS51c2VyX3NldF9mYXZvcml0ZV9ub3RpZmljYXRpb24oYXJlYS5JRCwgYXJlYS5ub3QpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgREIuc2V0RmF2b3JpdGVOb3RpZmljYXRpb24oYXJlYS5JRCwgYXJlYS5ub3QpO1xuICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGx1Z2lucy50b2FzdC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvdygnTm90aWZpa2F0aW9uZXIgw6RyICcgKyAoYXJlYS5ub3QgPyAncMOlJyA6ICdhdicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Nob3J0JywgJ2JvdHRvbScpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLm9wZW5Qb3BvdmVyID0gZnVuY3Rpb24oYXJlYSkge1xuICAgICAgICAgICAgJGlvbmljQWN0aW9uU2hlZXQuc2hvdyh7XG4gICAgICAgICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAgICAgICAgICB7dGV4dDogYXJlYS5ub3QgPyAnU3TDpG5nIGF2IG5vdGlmaWthdGlvbmVyJyA6ICdTw6R0dCBww6Ugbm90aWZpa2F0aW9uZXInfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgZGVzdHJ1Y3RpdmVUZXh0OiAnVGEgYm9ydCBmYXZvcml0JyxcbiAgICAgICAgICAgICAgICBkZXN0cnVjdGl2ZUJ1dHRvbkNsaWNrZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVGYXZvcml0ZShhcmVhKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aXRsZVRleHQ6ICfDhG5kcmEgZGluIGZhdm9yaXQnLFxuICAgICAgICAgICAgICAgIGNhbmNlbFRleHQ6ICdHw7ZyIGluZ2V0JyxcbiAgICAgICAgICAgICAgICBidXR0b25DbGlja2VkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJlYS5ub3QgPSAhYXJlYS5ub3Q7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbigpIHt9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0ZpbmRBcmVhc0N0cmwnLCBbXG4gICAgJyRzY29wZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlKSB7XG4gICAgfVxuXSk7XG5cbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0Zpc2hEZXRhaWxDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICckc3RhdGVQYXJhbXMnLFxuICAgICdEQicsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMsIERCKSB7XG4gICAgICAgICRzY29wZS5maXNoID0gJHN0YXRlUGFyYW1zLmZpc2g7XG4gICAgICAgIGlmICghJHNjb3BlLmZpc2gpIHtcbiAgICAgICAgICAgIERCLmdldEZpc2goJHN0YXRlUGFyYW1zLmlkKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5maXNoID0gZGF0YTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignRmlzaGVzQ3RybCcsIFsnJHNjb3BlJywgJ0RCJywgZnVuY3Rpb24oJHNjb3BlLCBEQikge1xuICAgICRzY29wZS5zb3J0b3JkZXIgPSAnc28nO1xuICAgIERCLmdldEZpc2hlcygpXG4gICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAkc2NvcGUuZmlzaGVzID0gZGF0YTtcbiAgICAgICAgJHNjb3BlLmRlZmF1bHRfaW1nID0gZGF0YVswXS5pbWc7XG4gICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSk7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdIb21lQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnJGlvbmljSGlzdG9yeScsXG4gICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAnVXBkYXRlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGlvbmljSGlzdG9yeSwgbG9jYWxTdG9yYWdlLCBzZXNzaW9uRGF0YSwgVXBkYXRlKSB7XG5cbiAgICAgICAgJHNjb3BlLmxvZ2dlZEluID0gc2Vzc2lvbkRhdGE7XG5cbiAgICAgICAgJHNjb3BlLnVwZGF0ZSA9IFVwZGF0ZTtcblxuICAgICAgICAvLyBDdXJyZW50IGhpc3Rvcnkgc3RhY2sgSWQuIFNlZSBhcmVhX2NvbnRyb2xsZXIgZm9yIHVzYWdlLlxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0KCdob21lSGlzdG9yeUlkJywgJGlvbmljSGlzdG9yeS5jdXJyZW50SGlzdG9yeUlkKCkpO1xuXG4gICAgICAgICRzY29wZS5uZXdzVGl0bGUgPSBsb2NhbFN0b3JhZ2UuZ2V0KCdORVdTJyk7XG5cbiAgICAgICAgJHNjb3BlLm15RnVuYyA9IGZ1bmN0aW9uKCRldmVudCkge1xuICAgICAgICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSAxMyAmJiAhJGV2ZW50LnNoaWZ0S2V5KSB7IC8vaWYgZW50ZXIta2V5XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuYXJlYXMnLCB7c2VhcmNoOiAkZXZlbnQuc3JjRWxlbWVudC52YWx1ZX0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdMZWdhbEN0cmwnLCBbJyRzY29wZScsICckc3RhdGUnLCAnbG9jYWxTdG9yYWdlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIGxvY2FsU3RvcmFnZSkge1xuICAgICRzY29wZS50b3MgPSBsb2NhbFN0b3JhZ2UuZ2V0KCd0b3MnKTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnVXBkYXRlJyxcbiAgICAnJGlvbmljTG9hZGluZycsXG4gICAgJyRpb25pY0hpc3RvcnknLFxuICAgICckaW9uaWNWaWV3U3dpdGNoZXInLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBVcGRhdGUsICRpb25pY0xvYWRpbmcsICRpb25pY0hpc3RvcnksICRpb25pY1ZpZXdTd2l0Y2hlcikge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBzaWduSW5cbiAgICAgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIGxvZ2luIGZvcm0uIFZhbGlkYXRlcyBsb2dpbiBpbnB1dC5cbiAgICAgICAgICogTW92ZXMgdG8gaG9tZSB2aWV3IG9uIHN1Y2Nlc3NmdWwgbG9naW4uXG4gICAgICAgICAqL1xuICAgICAgICAkc2NvcGUuc2lnbkluID0gZnVuY3Rpb24obG9naW5Gb3JtKSB7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuICAgICAgICAgICAgVXBkYXRlLnVzZXJfbG9naW4obG9naW5Gb3JtLnVzZXJuYW1lLiR2aWV3VmFsdWUsIGxvZ2luRm9ybS5wYXNzd29yZC4kdmlld1ZhbHVlKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgbG9naW5Gb3JtLiRzZXRWYWxpZGl0eSgnbG9naW5FcnJvcicsIHRydWUpO1xuICAgICAgICAgICAgICAgICRpb25pY1ZpZXdTd2l0Y2hlci5uZXh0RGlyZWN0aW9uKCdmb3J3YXJkJyk7XG4gICAgICAgICAgICAgICAgJGlvbmljSGlzdG9yeS5uZXh0Vmlld09wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlQmFjazogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVJvb3Q6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5ob21lJyk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICAgICAgICAgIGxvZ2luRm9ybS4kc2V0VmFsaWRpdHkoJ2xvZ2luRXJyb3InLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gZXJyb3IucmVzcG9uc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogc2tpcFxuICAgICAgICAgKiBTa2lwcyB0byB0aGUgaG9tZSB2aWV3LiBGb3JjZXMgZm9yd2FyZCB0cmFuc2l0aW9uIGFuZCBzZXRzIGhvbWUgYXMgcm9vdCB2aWV3LlxuICAgICAgICAgKi9cbiAgICAgICAgJHNjb3BlLnNraXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpb25pY1ZpZXdTd2l0Y2hlci5uZXh0RGlyZWN0aW9uKCdmb3J3YXJkJyk7XG4gICAgICAgICAgICAkaW9uaWNIaXN0b3J5Lm5leHRWaWV3T3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgZGlzYWJsZUJhY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgaGlzdG9yeVJvb3Q6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAuaG9tZScpO1xuICAgICAgICB9O1xuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignTWFwQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnbGVhZmxldERhdGEnLFxuICAgICckaW9uaWNQbGF0Zm9ybScsXG4gICAgJ0RCJyxcbiAgICAnJGNvcmRvdmFHZW9sb2NhdGlvbicsXG4gICAgJyRjb3Jkb3ZhRGV2aWNlT3JpZW50YXRpb24nLFxuICAgICckdGltZW91dCcsXG4gICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBsZWFmbGV0RGF0YSwgJGlvbmljUGxhdGZvcm0sIERCKSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJHNjb3BlKTtcbiAgICAgICAgJHNjb3BlLm1hcCA9IHt9O1xuICAgICAgICAkc2NvcGUubWFwLmNlbnRlck9uTWUgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmJlZm9yZUVudGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBEQi5zZWFyY2goJycpLnRoZW4oZnVuY3Rpb24oYXJlYXMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFwLmFyZWFzID0gYXJlYXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbi5jb250cm9sbGVyKCdNZW51Q3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlJyxcbiAgICAnJGlvbmljVmlld1N3aXRjaGVyJyxcbiAgICAnJGlvbmljUG9wb3ZlcicsXG4gICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAnVXBkYXRlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGlvbmljVmlld1N3aXRjaGVyLCAkaW9uaWNQb3BvdmVyLCBzZXNzaW9uRGF0YSwgVXBkYXRlKSB7XG5cbiAgICAgICAgJHNjb3BlLnNlc3Npb25EYXRhID0gc2Vzc2lvbkRhdGE7XG5cbiAgICAgICAgJGlvbmljUG9wb3Zlci5mcm9tVGVtcGxhdGVVcmwoJ2NvbXBvbmVudHMvbWVudS9wb3BvdmVyLmh0bWwnLCB7XG4gICAgICAgICAgICBzY29wZTogJHNjb3BlXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocG9wb3Zlcikge1xuICAgICAgICAgICAgJHNjb3BlLnBvcG92ZXIgPSBwb3BvdmVyO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUudXNlcmluZm8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5wb3BvdmVyLmhpZGUoKTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLnVzZXJpbmZvJyk7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5wb3BvdmVyLmhpZGUoKTtcbiAgICAgICAgICAgIFVwZGF0ZS51c2VyX2xvZ291dCgpO1xuXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5sb2dpbicpO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5wb3BvdmVyLmhpZGUoKTtcbiAgICAgICAgICAgICRpb25pY1ZpZXdTd2l0Y2hlci5uZXh0RGlyZWN0aW9uKCdiYWNrJyk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5sb2dpbicpO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5wb3BvdmVyLmhpZGUoKTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLnJlZ2lzdGVyLmRldGFpbHMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZm9yY2VkVXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBVcGRhdGUuZm9yY2VkVXBkYXRlKCk7XG4gICAgICAgIH07XG5cbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ05ld3NDdHJsJywgW1xuICAgICckc2NvcGUnLFxuICAgICdEQicsXG4gICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgZnVuY3Rpb24oJHNjb3BlLCBEQiwgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgICRzY29wZS5uZXdzVGl0bGUgPSBsb2NhbFN0b3JhZ2UuZ2V0KCdORVdTJyk7XG5cbiAgICAgICAgREIuZ2V0TmV3cygpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuLmNvbnRyb2xsZXIoJ05ld3NJdGVtQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAnREInLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlUGFyYW1zLCBEQikge1xuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLml0ZW0pIHtcbiAgICAgICAgICAgICRzY29wZS5pdGVtID0gJHN0YXRlUGFyYW1zLml0ZW07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBEQi5nZXROZXdzSXRlbSgkc3RhdGVQYXJhbXMuaWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5pdGVtID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXSk7XG4iLCJcbmFuZ3VsYXIubW9kdWxlKCdpZmlza2UuY29udHJvbGxlcnMnKVxuICAgIC5jb250cm9sbGVyKCdSZWNvdmVyQ3RybCcsIFtcblx0JyRzY29wZScsXG5cdCckc3RhdGUnLFxuXHQnJGlvbmljSGlzdG9yeScsXG5cdCckaW9uaWNQbGF0Zm9ybScsXG5cdCckaW9uaWNMb2FkaW5nJyxcblx0JyRjb3Jkb3ZhVG9hc3QnLFxuXHQnQVBJJyxcblx0ZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRpb25pY0hpc3RvcnksICRpb25pY1BsYXRmb3JtLCAkaW9uaWNMb2FkaW5nLCAkY29yZG92YVRvYXN0LCBBUEkpIHtcblx0ICAgICd1c2Ugc3RyaWN0Jztcblx0ICAgIFxuXHQgICAgdmFyIHVzZXIgPSBcIlwiO1xuXHQgICAgXG5cdCAgICAvKipcbiAgICAgICAgICAgICAqIFRvRG86IHVzZSB0byBza2lwIGZyb20gbG9zdHBhc3N3b3JkIHRvIHJlc2V0cGFzc3dvcmRcblx0ICAgICAqIHNraXBcblx0ICAgICAqIFN1Ym1pdCBoYW5kbGVyIGZvciBza2lwIGJ1dHRvblxuXHQgICAgICovXG4gICAgICAgICAgICAvKlxuXHQgICAgICAkc2NvcGUuc2tpcCA9IGZ1bmN0aW9uKCkge1xuXHQgICAgICAkc2NvcGUuaW5mbyA9IFwiXCI7XG5cdCAgICAgICRzdGF0ZS5nbygnXi5yZXNldHBhc3N3b3JkJyk7XG5cdCAgICAgIH07XG4gICAgICAgICAgICAqL1x0ICAgIFxuXG5cdCAgICAvKipcblx0ICAgICAqIGxvc3RQYXNzd29yZFxuXHQgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIGZpcnN0IGZvcm1cblx0ICAgICAqL1xuXHQgICAgJHNjb3BlLmxvc3RQYXNzd29yZCA9IGZ1bmN0aW9uKGZvcm0pIHtcblxuXHQgICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG5cdCAgICAgICAgdXNlciA9IGZvcm0udXNlci4kdmlld1ZhbHVlO1xuXG5cdCAgICAgICAgQVBJLnVzZXJfbG9zdF9wYXNzd29yZCh1c2VyKVxuXHRcdCAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRcblx0XHRcdC8vIFNldCBpbmZvIG1lc3NhZ2UgZm9yIG5leHQgdmlld1xuXHRcdFx0JHNjb3BlLmluZm8gPSAnRW4gw6V0ZXJzdMOkbGxuaW5nc2tvZCBrb21tZXIgc2tpY2thcyB0aWxsIGRpZyBpbm9tIGtvcnQsIHZpYSAnO1x0XHRcdFxuXHRcdFx0aWYgKGRhdGEubWFpbGVkKSB7XG5cdFx0XHQgICAgJHNjb3BlLmluZm8gKz0gJ2UtbWFpbCc7XG5cdFx0XHQgICAgaWYgKGRhdGEudGV4dGVkKSB7XG5cdFx0XHRcdCRzY29wZS5pbmZvICs9ICcgb2NoICc7XG5cdFx0XHQgICAgfVxuXHRcdFx0fVxuXHRcdFx0aWYgKGRhdGEudGV4dGVkKSB7XG5cdFx0XHQgICAgJHNjb3BlLmluZm8gKz0gJ1NNUyc7XG5cdFx0XHR9XG4gICAgICAgICAgICAgICAgICAgICAgICBcblx0XHRcdCRzdGF0ZS5nbygnXi5yZXNldHBhc3N3b3JkJyk7XG5cblx0XHQgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdC8vVG9EbzogaGFuZGxlIHRpbWVvdXQ/XG5cdFx0XHQvL1RvRG86IGNoZWNrIGVycm9yIGNvZGVzP1xuXHRcdFx0Zm9ybS51c2VyLiRzZXRWYWxpZGl0eSgnaW52YWxpZFVzZXInLCBmYWxzZSk7XG5cdFx0ICAgIH0pXG5cdFx0ICAgIC5maW5hbGx5KCRpb25pY0xvYWRpbmcuaGlkZSk7XG5cdCAgICB9O1xuXG5cblx0ICAgIC8qKlxuXHQgICAgICogcmVzZXRQYXNzd29yZFxuXHQgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIHNlY29uZCBmb3JtXG5cdCAgICAgKlxuXHQgICAgICogVG9EbzogbG9nIGluIGltbWVkaWF0ZWx5P1xuXHQgICAgICovXG5cdCAgICAkc2NvcGUucmVzZXRQYXNzd29yZCA9IGZ1bmN0aW9uKGZvcm0pIHtcblx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblx0XHRcblx0XHRcblx0XHRBUEkudXNlcl9yZXNldF9wYXNzd29yZCh1c2VyLCBmb3JtLnBhc3N3b3JkLiR2aWV3VmFsdWUsIGZvcm0uY29kZS4kdmlld1ZhbHVlKVxuXHRcdCAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cdFx0XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1RvRG86IGhhbmRsZSB0aW1lb3V0cz9cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy9Ub0RvOiAucmVhZHkoKSBuZWVkZWQ/XG5cdCAgICAgICAgICAgICAgICAvLyBTdWNjZXNzIHRvYXN0XG5cdFx0ICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbigpIHtcblx0XHQgICAgICAgICAgICAkY29yZG92YVRvYXN0LnNob3dMb25nQm90dG9tKCdEaXR0IGzDtnNlbm9yZCBoYXIgw6RuZHJhdHMnKTtcblx0XHQgICAgICAgIH0pO1xuXHQgICAgICAgIFx0XHRcdFxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAubG9naW4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTmF2aWdhdGUgdG8gY3VycmVudCBoaXN0b3J5IHJvb3Q/XG5cdFx0XHQvLyRpb25pY0hpc3RvcnkuZ29Ub0hpc3RvcnlSb290KCRpb25pY0hpc3RvcnkuY3VycmVudFZpZXcoKS5oaXN0b3J5SWQpO1x0XG5cdFx0ICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goZXJyb3IuZXJyb3JfY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLypjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pbnZhbGlkZSB1c2VybmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmNhc2UgMTM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5wYXNzd29yZC4kc2V0VmFsaWRpdHkoJ3Bhc3N3b3JkTGVuZ3RoJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyovXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OlxuXHRcdCAgICAgICAgICAgIGZvcm0uY29kZS4kc2V0VmFsaWRpdHkoJ2ludmFsaWRDb2RlJyxmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cdFx0ICAgIH0pXG5cdFx0ICAgIC5maW5hbGx5KCRpb25pY0xvYWRpbmcuaGlkZSk7XG5cdCAgICB9O1xuXHR9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmNvbnRyb2xsZXJzJylcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgW1xuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJyRzdGF0ZScsXG4gICAgICAgICckaW9uaWNMb2FkaW5nJyxcbiAgICAgICAgJyRpb25pY01vZGFsJyxcbiAgICAgICAgJyRpb25pY1Njcm9sbERlbGVnYXRlJyxcbiAgICAgICAgJyRpb25pY1BsYXRmb3JtJyxcbiAgICAgICAgJyRjb3Jkb3ZhVG9hc3QnLFxuICAgICAgICAnQVBJJyxcbiAgICAgICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCAkaW9uaWNMb2FkaW5nLCAkaW9uaWNNb2RhbCwgJGlvbmljU2Nyb2xsRGVsZWdhdGUsICRpb25pY1BsYXRmb3JtLCAkY29yZG92YVRvYXN0LCBBUEksIGxvY2FsU3RvcmFnZSkge1xuXG4gICAgICAgICAgICB2YXIgdXNlcm5hbWU7XG5cbiAgICAgICAgICAgIC8vIExpdmUgY2hlY2sgZm9yIHVzZXJuYW1lIGF2YWlsYWJpbGl0eVxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrVXNlcm5hbWUgPSBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgIEFQSS51c2VyX2V4aXN0cyhpbnB1dC4kdmlld1ZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC4kc2V0VmFsaWRpdHkoJ25hbWVUYWtlbicsICFkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBMaXZlIGNoZWNrIGZvciBlbWFpbCBhdmFpbGFiaWxpdHlcbiAgICAgICAgICAgICRzY29wZS5jaGVja0VtYWlsID0gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBBUEkudXNlcl9leGlzdHMobnVsbCwgaW5wdXQuJHZpZXdWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuJHNldFZhbGlkaXR5KCdlbWFpbFRha2VuJywgIWRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgLy8gVmFsaWRhdGlvbiBlcnJvcnMgbm90IHRpZWQgdG8gaW5wdXQgZmllbGRcbiAgICAgICAgICAgICRzY29wZS5mb3JtRXJyb3JzID0ge307XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogcmVnaXN0ZXJcbiAgICAgICAgICAgICAqIFN1Ym1pdCBoYW5kbGVyIGZvciB0aGUgcmVnaXN0cmF0aW9uIGZvcm1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24oZm9ybSkge1xuICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG4gICAgICAgICAgICAgICAgLy8gU2F2ZSBwaG9uZSBudW1iZXIgZm9yIG5leHQgdmlld1xuICAgICAgICAgICAgICAgICRzY29wZS5waG9uZSA9IGZvcm0ucGhvbmUuJHZpZXdWYWx1ZTtcblxuICAgICAgICAgICAgICAgIC8vIFNhdmUgdXNlcm5hbWUgZm9yIHZlcmlmeSBzdWJtaXQgaGFuZGxlclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZm9ybS51c2VybmFtZS4kdmlld1ZhbHVlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gZm9ybS5wYXNzd29yZC4kdmlld1ZhbHVlO1xuICAgICAgICAgICAgICAgIHZhciBmdWxsbmFtZSA9IGZvcm0uZnVsbG5hbWUuJHZpZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICB2YXIgZW1haWwgPSBmb3JtLmVtYWlsLiR2aWV3VmFsdWU7XG5cbiAgICAgICAgICAgICAgICBBUEkudXNlcl9yZWdpc3Rlcih1c2VybmFtZSwgZnVsbG5hbWUsIHBhc3N3b3JkLCBlbWFpbCwgJHNjb3BlLnBob25lKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWNjZXNzOiBHbyB0byB2ZXJpZnkgYWNjb3VudCB2aWV3XG4gICAgICAgICAgICAgICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5mb3JtRXJyb3JzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ14udmVyaWZ5Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgICogRXJyb3I6IEluZm9ybSB0aGUgdXNlciBhYm91dCBmYWlsZWQgcmVnaXN0cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBTZWUgQVBJIGRvY3VtZW50YXRpb24gZm9yIGVycm9yIGNvZGVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAgICAgICAgICogVG9EbzogSGFuZGxlIHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1FcnJvcnMucmVnaXN0cmF0aW9uRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGlvbmljU2Nyb2xsRGVsZWdhdGUuc2Nyb2xsVG9wKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnZhbGlkIEVtYWlsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZXJyb3JfY29kZSA9PSA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5lbWFpbC4kc2V0VmFsaWRpdHkoJ2ludmFsaWRFbWFpbCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZXJuYW1lIG9yIEVtYWlsIGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yX2NvZGUgPT0gOSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jaGVja1VzZXJuYW1lKGZvcm0udXNlcm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jaGVja0VtYWlsKGZvcm0uZW1haWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW52YWxpZCBwaG9uZSBudW1iZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5lcnJvcl9jb2RlID09IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5waG9uZS4kc2V0VmFsaWRpdHkoJ2ludmFsaWRQaG9uZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIHZlcmlmeVxuICAgICAgICAgICAgICogU3VibWl0IGhhbmRsZXIgZm9yIHRoZSB2ZXJpZmljYXRpb24gZm9ybVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUudmVyaWZ5ID0gZnVuY3Rpb24oZm9ybSkge1xuICAgICAgICAgICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHZlcmNvZGUgPSBmb3JtLnZlcmNvZGU7XG5cbiAgICAgICAgICAgICAgICBBUEkudXNlcl9jb25maXJtKHVzZXJuYW1lLCB2ZXJjb2RlLiR2aWV3VmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhVG9hc3Quc2hvd0xvbmdCb3R0b20oJ0RpdHQga29udG8gaGFyIHNrYXBhdHMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1FcnJvcnMudmFsaWRhdGlvbkVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5sb2dpbicpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmVycm9yX2NvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJjb2RlLiRzZXRWYWxpZGl0eShcInZlcmlmaWVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1FcnJvcnMudmFsaWRhdGlvbkVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbmFsbHkoJGlvbmljTG9hZGluZy5oaWRlKCkpO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAkc2NvcGUudG9zID0gbG9jYWxTdG9yYWdlLmdldCgndG9zJyk7XG4gICAgICAgICAgICAvL01vZGFsIHdpdGggdGhlIEVVTEFcbiAgICAgICAgICAgICRpb25pY01vZGFsLmZyb21UZW1wbGF0ZVVybCgnY29tcG9uZW50cy9yZWdpc3Rlci9ldWxhLmh0bWwnLCB7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246ICdzbGlkZS1pbi11cCdcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24obW9kYWwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXVsYSA9IG1vZGFsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUuc2hvd0V1bGEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXVsYS5zaG93KCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJHNjb3BlLmNsb3NlRXVsYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ldWxhLmhpZGUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5ldWxhLnJlbW92ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignVGVjaG5pcXVlRGV0YWlsQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAnREInLFxuICAgICckaW9uaWNTbGlkZUJveERlbGVnYXRlJyxcbiAgICBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZVBhcmFtcywgREIsICRpb25pY1NsaWRlQm94RGVsZWdhdGUpIHtcbiAgICAgICAgJHNjb3BlLnRlY2ggPSAkc3RhdGVQYXJhbXMudGVjaDtcbiAgICAgICAgJHNjb3BlLmltYWdlcyA9IFtdO1xuXG4gICAgICAgIGlmICghJHNjb3BlLnRlY2gpIHtcbiAgICAgICAgICAgIERCLmdldFRlY2huaXF1ZSgkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmltYWdlcyA9IFtkYXRhLmltZzEsIGRhdGEuaW1nMiwgZGF0YS5pbWczXS5maWx0ZXIoZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEvXFwvJC8udGVzdChlbCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkaW9uaWNTbGlkZUJveERlbGVnYXRlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICRzY29wZS50ZWNoID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSAkc2NvcGUudGVjaDtcbiAgICAgICAgICAgICRzY29wZS5pbWFnZXMgPSBbZGF0YS5pbWcxLCBkYXRhLmltZzIsIGRhdGEuaW1nM10uZmlsdGVyKGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEvXFwvJC8udGVzdChlbCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGlvbmljU2xpZGVCb3hEZWxlZ2F0ZS51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cbl0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignVGVjaG5pcXVlc0N0cmwnLCBbJyRzY29wZScsICdEQicsIGZ1bmN0aW9uKCRzY29wZSwgREIpIHtcblxuICAgICRzY29wZS5zb3J0b3JkZXIgPSAnc28nO1xuXG4gICAgJHNjb3BlLiRvbignJGlvbmljVmlldy5iZWZvcmVFbnRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICBEQi5nZXRUZWNobmlxdWVzKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLnRlY2huaXF1ZXMgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignVXNlckN0cmwnLCBbJyRzY29wZScsICdEQicsIGZ1bmN0aW9uKCRzY29wZSwgREIpIHtcbiAgICBEQi5nZXRVc2VySW5mbygpXG4gICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XG4gICAgfSk7XG4gICAgREIuZ2V0VXNlck51bWJlcnMoKVxuICAgIC50aGVuKGZ1bmN0aW9uKG51bWJlcnMpIHtcbiAgICAgICAgJHNjb3BlLm51bWJlcnMgPSBudW1iZXJzO1xuICAgIH0pO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5jb250cm9sbGVycycpXG4uY29udHJvbGxlcignVXNlckNhcmRzQ3RybCcsIFtcbiAgICAnJHNjb3BlJyxcbiAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAnREInLFxuICAgICdVcGRhdGUnLFxuICAgICckaW9uaWNNb2RhbCcsXG4gICAgJyRpb25pY0xvYWRpbmcnLFxuICAgIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlUGFyYW1zLCBEQiwgVXBkYXRlLCAkaW9uaWNNb2RhbCwgJGlvbmljTG9hZGluZykge1xuICAgICAgICAkc2NvcGUucHJlZCA9ICctdG8nO1xuICAgICAgICAkc2NvcGUuZW5kcG9pbnQgPSAnaHR0cHM6Ly93d3cuaWZpc2tlLnNlJztcblxuICAgICAgICB2YXIgaW5pdGlsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcbiAgICAgICAgICAgIHZhciBhID0gVXBkYXRlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYSk7XG4gICAgICAgICAgICBhLnRoZW4oZnVuY3Rpb24oaGkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhoaSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGEuZmluYWxseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaGVsbG/DpCcpO1xuICAgICAgICAgICAgICAgICRzY29wZS5ub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIERCLmdldFVzZXJQcm9kdWN0cygpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvZHVjdHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xuICAgICAgICAgICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcbiAgICAgICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJG9uKCckaW9uaWNWaWV3LmJlZm9yZUVudGVyJywgaW5pdGlsaXplKTtcbiAgICAgICAgLy91c2UgdGhlIHNhbWUgbW9kYWwgYXMgaW4gYXJlYV9jYXJkc1xuICAgICAgICAkaW9uaWNNb2RhbC5mcm9tVGVtcGxhdGVVcmwoJ2NvbXBvbmVudHMvYXJlYV9jYXJkcy9ydWxlc19tb2RhbC5odG1sJywge1xuICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgIGFuaW1hdGlvbjogJ3NsaWRlLWluLXVwJ1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKG1vZGFsKSB7XG4gICAgICAgICAgICAkc2NvcGUucnVsZXNfbW9kYWwgPSBtb2RhbDtcbiAgICAgICAgfSk7XG4gICAgICAgICRzY29wZS5vcGVuUnVsZXNNb2RhbCA9IGZ1bmN0aW9uKHByb2R1Y3QpIHtcbiAgICAgICAgICAgICRzY29wZS5ydWxlc19tb2RhbC5zaG93KCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9kdWN0KTtcbiAgICAgICAgICAgICRzY29wZS5wcm9kdWN0ID0gcHJvZHVjdDtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmNsb3NlUnVsZXNNb2RhbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJ1bGVzX21vZGFsLmhpZGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJ1bGVzX21vZGFsLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaW5pdGlsaXplKCk7XG4gICAgICAgIH07XG4gICAgfVxuXSk7XG4iLCIoZnVuY3Rpb24oYW5ndWxhciwgdW5kZWZpbmVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS5hcGknLCBbJ2lmaXNrZS51dGlscyddKVxuICAgIC5wcm92aWRlcignQVBJJywgZnVuY3Rpb24gQVBJUHJvdmlkZXIoKSB7XG5cbiAgICAgICAgdGhpcy5iYXNlX3VybCA9ICdodHRwczovL3d3dy5pZmlza2Uuc2UvYXBpL3YyL2FwaS5waHAnO1xuXG4gICAgICAgIHRoaXMuJGdldCA9IFtcbiAgICAgICAgICAgICckaHR0cCcsXG4gICAgICAgICAgICAnc2Vzc2lvbkRhdGEnLFxuICAgICAgICAgICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgICAgICAgICAnJHEnLFxuICAgICAgICAgICAgZnVuY3Rpb24oJGh0dHAsIHNlc3Npb25EYXRhLCBsb2NhbFN0b3JhZ2UsICRxKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJhc2VfdXJsID0gdGhpcy5iYXNlX3VybDtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqICMgYXBpX2NhbGwgI1xuICAgICAgICAgICAgICAgICAqIGhhbmRsZXMgaHR0cCByZXF1ZXN0c1xuICAgICAgICAgICAgICAgICAqIHJldHVybnMgYSAkaHR0cCBvYmplY3QgZm9yIHRoZSByZXF1ZXN0ZWQgYXBpIGNhbGxcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB2YXIgYXBpX2NhbGwgPSBmdW5jdGlvbihwYXJhbXMsIGNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRodHRwKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOidnZXQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGJhc2VfdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IGFuZ3VsYXIuZXh0ZW5kKHBhcmFtcywgeydrZXknOiAnb3gwN3hoOGFheXB3dnE3YSd9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNzAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IChjYWNoZSAhPT0gZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVG9EbzogUHJvcGVyIGxvZ2dpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChkYXRhLmRhdGEucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnLCBzdGF0dXNUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdSZXF1ZXN0IHRpbWVvdXQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogIyBzZXNzaW9uX2FwaV9jYWxsICNcbiAgICAgICAgICAgICAgICAgKiB3cmFwcGVyIGZvciBhcGlfY2FsbCAtIGluc2VydHMgdGhlIHNlc3Npb24gdG9rZW4gaW50byBwYXJhbXNcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbl9hcGlfY2FsbCA9IGZ1bmN0aW9uKHBhcmFtcywgY2FjaGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlc3Npb24gPSBzZXNzaW9uRGF0YS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKGFuZ3VsYXIuZXh0ZW5kKHBhcmFtcywge3M6IHNlc3Npb259KSwgY2FjaGUpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBnZXRfbXVuaWNpcGFsaXRpZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X211bmljaXBhbGl0aWVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfY291bnRpZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X2NvdW50aWVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2V4aXN0czogZnVuY3Rpb24odXNlcm5hbWUsIGVtYWlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IHttOiAndXNlcl9leGlzdHMnfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJuYW1lICYmIHR5cGVvZiB1c2VybmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW1haWwgJiYgdHlwZW9mIGVtYWlsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MuZW1haWwgPSBlbWFpbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKGFyZ3MsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9yZWdpc3RlcjogZnVuY3Rpb24odXNlcm5hbWUsIGZ1bGxuYW1lLCBwYXNzd29yZCwgZW1haWwsIHBob25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICd1c2VyX3JlZ2lzdGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogZnVsbG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZTogcGhvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfY29uZmlybTogZnVuY3Rpb24odXNlcm5hbWUsIHBpbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtOiAndXNlcl9jb25maXJtJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGluOiBwaW5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9pbmZvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9pbmZvJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2xvc3RfcGFzc3dvcmQ6IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bTogJ3VzZXJfbG9zdF9wYXNzd29yZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaWRlbnRpZmljYXRpb246IHVzZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfcmVzZXRfcGFzc3dvcmQ6IGZ1bmN0aW9uKHVzZXJfaWRlbnRpZmljYXRpb24sIHBhc3N3b3JkLCBjb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG06ICd1c2VyX3Jlc2V0X3Bhc3N3b3JkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkZW50aWZpY2F0aW9uOiB1c2VyX2lkZW50aWZpY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfY2hhbmdlX3Bhc3N3b3JkOiBmdW5jdGlvbihvbGRfcGFzc3dvcmQsIG5ld19wYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXBpX2NhbGwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG06ICd1c2VyX2NoYW5nZV9wYXNzd29yZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkX3Bhc3N3b3JkOiBvbGRfcGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3Bhc3N3b3JkOiBuZXdfcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9sb2dpbjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICd1c2VyX2xvZ2luJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLnNldFRva2VuKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbmVlZGVkIGZvciBjaGFpbmluZyBvZiBwcm9taXNlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9sb2dvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXBpX2NhbGwoe206ICd1c2VyX2xvZ291dCd9LCBmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25EYXRhLmRlbGV0ZVRva2VuKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9wcm9kdWN0czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbl9hcGlfY2FsbCh7bTogJ3VzZXJfcHJvZHVjdHMnfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfZmlzaGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9maXNoZXMnfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF90ZWNobmlxdWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF90ZWNobmlxdWVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfYmFpdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X2JhaXRzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfb3JnYW5pemF0aW9uczogZnVuY3Rpb24ob3JnaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bTogJ2dldF9vcmdhbml6YXRpb25zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnaWQ6IG9yZ2lkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9vcmdfbW9kaWZpZWQ6IGZ1bmN0aW9uKG9yZ2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfb3JnX21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnaWQ6IG9yZ2lkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9hcmVhczogZnVuY3Rpb24oYXJlYWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfYXJlYXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhaWQ6IGFyZWFpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfYXJlYXNfbW9kaWZpZWQ6IGZ1bmN0aW9uKGFyZWFpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X2FyZWFzX21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJlYWlkOiBhcmVhaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X3Byb2R1Y3RzOiBmdW5jdGlvbihhcmVhaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bTogJ2dldF9wcm9kdWN0cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZWFpZDogYXJlYWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9ydWxlczogZnVuY3Rpb24ocnVsZWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfcnVsZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlaWQ6IHJ1bGVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfcGhvdG9zOiBmdW5jdGlvbihvcmdpZCwgYXJlYWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfcGhvdG9zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnaWQ6IG9yZ2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhaWQ6IGFyZWFpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfbWFwX3BvaXM6IGZ1bmN0aW9uKG9yZ2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge206ICdnZXRfbWFwX3BvaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmdpZDogb3JnaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X21hcF9wb2lfdHlwZXMgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9tYXBfcG9pX3R5cGVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfbWFwX3BvbHlnb25zOiBmdW5jdGlvbihvcmdpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHttOiAnZ2V0X21hcF9wb2x5Z29ucycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2lkOiBvcmdpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2dldF9mYXZvcml0ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXBpX2NhbGwoe206ICd1c2VyX2dldF9mYXZvcml0ZXMnfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2FkZF9mYXZvcml0ZTogZnVuY3Rpb24oYXJlYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9GbGFnIDAgbWVhbnMgdG8gbm90IGdldCBub3RpZmljYXRpb25zIG9uIGNhdGNoIHJlcG9ydHNcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9hZGRfZmF2b3JpdGUnLCBhcmVhaWQ6IGFyZWEsIGZsYWc6IDB9LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0X2Zhdm9yaXRlX25vdGlmaWNhdGlvbjogZnVuY3Rpb24oYXJlYSwgZmxhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZyA9IGZsYWcgPyAxIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2FwaV9jYWxsKHttOiAndXNlcl9zZXRfZmF2b3JpdGVfbm90aWZpY2F0aW9uJywgYXJlYWlkOiBhcmVhLCBmbGFnOiBmbGFnfSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX3JlbW92ZV9mYXZvcml0ZTogZnVuY3Rpb24oYXJlYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXBpX2NhbGwoe206ICd1c2VyX3JlbW92ZV9mYXZvcml0ZScsIGFyZWFpZDogYXJlYX0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X3Rlcm1zX29mX3NlcnZpY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X3Rlcm1zX29mX3NlcnZpY2UnfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9jb250YWN0X2luZm86IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X2NvbnRhY3RfaW5mbyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0X2VuZ2luZV9wb2xpY2llczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXBpX2NhbGwoe206ICdnZXRfZW5naW5lX3BvbGljaWVzJ30pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRfc21zX3Rlcm1zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9zbXNfdGVybXMnfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9tYXBib3hfYXBpOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcGlfY2FsbCh7bTogJ2dldF9tYXBib3hfYXBpYWNjZXNzdG9rZW4nfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldF9jb250ZW50X21lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwaV9jYWxsKHttOiAnZ2V0X2NvbnRlbnRfbWVudSd9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XTtcbiAgICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcbiIsIihmdW5jdGlvbihhbmd1bGFyLCB1bmRlZmluZWQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmRiJywgW10pXG4gICAgLnByb3ZpZGVyKCdEQicsIGZ1bmN0aW9uIERCUHJvdmlkZXIoKSB7XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gW1xuICAgICAgICAgICAgJyRjb3Jkb3ZhU1FMaXRlJyxcbiAgICAgICAgICAgICdBUEknLFxuICAgICAgICAgICAgJyRxJyxcbiAgICAgICAgICAgICckcm9vdFNjb3BlJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRjb3Jkb3ZhU1FMaXRlLCBBUEksICRxLCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGI7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5zcWxpdGVQbHVnaW4pIHtcbiAgICAgICAgICAgICAgICAgICAgZGIgPSAkY29yZG92YVNRTGl0ZS5vcGVuREIoJ2Zpc2tlYmFzZW4uZGInKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5vcGVuRGF0YWJhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGIgPSB3aW5kb3cub3BlbkRhdGFiYXNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Zpc2tlYmFzZW4uZGInLCAnMS4wJywgJ2Zpc2tlYmFzZW4nLCAxMCAqIDEwMjQgKiAxMDI0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm90IHN1cHBvcnRlZCBvbiB0aGlzIGRldmljZSwgc29ycnknKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFibGVEZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgICdBcmVhJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnb3JnaWQnLCAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsna3cnLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydub3RlJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2MxJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjMicsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYzMnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ20xJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtMicsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbTMnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xhdCcsICAgJ3JlYWwnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbG5nJywgICAncmVhbCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd6b29tJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3BudCcsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjYXInLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZW5nJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2hjcCcsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtYXAnLCAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3dzYycsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtb2QnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdBcmVhX0Zpc2gnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYWlkJywgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpZCcsICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydhbW91bnQnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY29tbWVudCcsICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdQcm9kdWN0JzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QyJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ25vJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ltJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3BmJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2FpJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncmknLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjaCcsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3ByaWNlJywgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbW9kJywgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydzbycsICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2hsJywgICAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ0NvdW50eSc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncycsICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydkJywgICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnTXVuaWNpcGFsaXR5JzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY0lEJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ25hbWUnLCAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnRmlzaCc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtb2QnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnc28nLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ21heCcsICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpY29uJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ltZycsICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnaW4nLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydnZW8nLCAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3NpemUnLCAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbGF0JywgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydyZWMnLCAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1J1bGUnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3ZlcicsICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2QnLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnVXNlcl9Qcm9kdWN0JzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2F0JywgICAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY29kZScsICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydmcicsICAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2Z1bGxuYW1lJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ290JywgICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3JlZjEnLCAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncmVmMicsICAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0bycsICAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3BpZCcsICAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncGRmJywgICAgICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnVXNlcl9JbmZvJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3VzZXJuYW1lJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2xvZ2dlZGluJywgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lQMScsICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lQMicsICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ25hbWUnLCAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2VtYWlsJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NyZWF0ZWQnLCAgICd0ZXh0J11cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1VzZXJfTnVtYmVyJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydudW1iZXInLCAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdVc2VyX0Zhdm9yaXRlJzogW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJRCcsICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2EnLCAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnYWRkJywgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydub3QnLCAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2NudCcsICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1RlY2huaXF1ZSc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3QnLCAgICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydzbycsICAgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZGUnLCAgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydkYScsICAgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ljb24nLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnaW1nMScsICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpbWcyJywgICAgICd0ZXh0J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ2ltZzMnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsneW91dHViZScsICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdPcmdhbml6YXRpb24nOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY3AnLCAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndXJsJywgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnY28nLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydtb2QnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3ZhdCcsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZHAnLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydmdmEnLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ29yZycsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbWwnLCAgICAgJ2ludCddXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICdQb2knOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnb3JnaWQnLCAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0eXBlJywgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ3ByaWNlJywgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnZCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbGEnLCAgICAgJ3JlYWwnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnbG8nLCAgICAgJ3JlYWwnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnUG9pX1R5cGUnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsndCcsICAgICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnaWNvbicsICAgJ3RleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgJ1BvbHlnb24nOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0lEJywgICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnb3JnaWQnLCAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydjJywgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd2ZXInLCAgICAnaW50J10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ21vZCcsICAgICdpbnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsncG9seScsICAgJ3RleHQnXVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAnTmV3cyc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnSUQnLCAgICAgJ2ludCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0JywgICAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWyd0ZXh0JywgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpbWcnLCAgICAndGV4dCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydpY29uJywgICAndGV4dCddXG4gICAgICAgICAgICAgICAgICAgIF1cblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlT2JqZWN0ID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dmFsID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5yb3dzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR2YWwucHVzaChhbmd1bGFyLmNvcHkoZGF0YS5yb3dzLml0ZW0oaSkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dmFsO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVRhYmxlOiBmdW5jdGlvbih0YWJsZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiLnRyYW5zYWN0aW9uKGZ1bmN0aW9uKHR4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVTcWwoJ0RFTEVURSBGUk9NICcgKyB0YWJsZSArICc7Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaWQgaW4gZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpbmdsZURhdGEgPSBkYXRhW2lkXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNlcnREYXRhID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlRGVmW3RhYmxlXS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc2VydERhdGEucHVzaChzaW5nbGVEYXRhW3RhYmxlRGVmW3RhYmxlXVtpXVswXV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJTlNFUlQgSU5UTycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1ZBTFVFUyg/JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLD8nLnJlcGVhdChpbnNlcnREYXRhLmxlbmd0aCAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVTcWwocXVlcnksIGluc2VydERhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGNsZWFuVGFibGU6IGZ1bmN0aW9uKHRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIudHJhbnNhY3Rpb24oZnVuY3Rpb24odHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHguZXhlY3V0ZVNxbCgnREVMRVRFIEZST00gJyArIHRhYmxlICsgJzsnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBEcm9wcyBhbGwgdGFibGVzIGluIHRoZSBkYXRhYmFzZVxuICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGNsZWFuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBjbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIudHJhbnNhY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHR4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0YWJsZSBpbiB0YWJsZURlZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVTcWwoJ0RST1AgVEFCTEUgSUYgRVhJU1RTICcgKyB0YWJsZSArICc7Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlbW92ZWQgYWxsIHRhYmxlcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEluaXRpYWxpZXMgdGhlIHRhYmxlcyBpbiB0aGUgZGF0YWJhc2VcbiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBpbml0XG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYi50cmFuc2FjdGlvbihmdW5jdGlvbih0eCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0IGluIHRhYmxlRGVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSB0YWJsZURlZlt0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVZhbHVlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQnVpbGRzIGEgc3RyaW5nIHdpdGggXCJcIiBhcm91bmQgYWxsIG5hbWVzLCBzbyB0aGF0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBpdCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgYW4gU1FMIFRhYmxlIHdpdG91dCBoYXZpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHRvIHdvcnJ5IGFib3V0IHVzaW5nIHJlc2VydmVkIGtleXdvcmRzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVWYWx1ZXMucHVzaCgnXCInICsgdGFibGVbaV1bMF0gKyAnXCIgJyArIHRhYmxlW2ldWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlVmFsdWVzID0gdGFibGVWYWx1ZXMuam9pbignLCAnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnKCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVWYWx1ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJywgUFJJTUFSWSBLRVkoJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXCInICsgdGFibGVbMF1bMF0gKyAnXCInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcpKTsnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVTcWwocXVlcnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEdldHMgaW5mb3JtYXRpb24gYWJvdXQgYW4gYXJlYVxuICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIGdldEFyZWFcbiAgICAgICAgICAgICAgICAgICAgICogQHBhcmFtIHtJbnRlZ2VyfSBpZFxuICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgZ2V0QXJlYTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgQXJlYS4qLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDQVNFIFdIRU4gVXNlcl9GYXZvcml0ZS5JRCBJUyBOVUxMIFRIRU4gMCBFTFNFIDEgRU5EIGFzIGZhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZST00gQXJlYScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdMRUZUIEpPSU4gVXNlcl9GYXZvcml0ZSBPTiBVc2VyX0Zhdm9yaXRlLmEgPSBBcmVhLklEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIEFyZWEuSUQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBBcnJheS5pc0FycmF5KGlkKSA/IGlkIDogW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZWEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0gY3JlYXRlT2JqZWN0KGFyZWEpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IERCIHNob3VsZCBub3QgbmVlZCBBUElcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LmltYWdlcyA9IEFQSS5nZXRfcGhvdG9zKG9iamVjdC5vcmdpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwob2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0QXJlYUZpc2hlczogZnVuY3Rpb24oYWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIConLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBBcmVhX0Zpc2gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSk9JTiBGaXNoIE9OIEFyZWFfRmlzaC5maWQgPSBGaXNoLklEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIEFyZWFfRmlzaC5haWQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbYWlkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIFNlYXJjaGVzIHRoZSBkYXRhYmFzZSB1c2luZyBhIHF1ZXJ5XG4gICAgICAgICAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgICAgICAgICAqIFRoZSBxdWVyeSBpcyBtYXRjaGVkIHRvIGEgbmFtZSBhbmQvb3Iga2V5d29yZFxuICAgICAgICAgICAgICAgICAgICAgKiBAbWV0aG9kIHNlYXJjaFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VhcmNoc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uKHNlYXJjaHN0cmluZywgY291bnR5X2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIEFyZWEuKiwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ0FTRSBXSEVOIFVzZXJfRmF2b3JpdGUuSUQgSVMgTlVMTCBUSEVOIDAgRUxTRSAxIEVORCBhcyBmYXZvcml0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIEFyZWEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTEVGVCBKT0lOIFVzZXJfRmF2b3JpdGUgT04gVXNlcl9GYXZvcml0ZS5hID0gQXJlYS5JRCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSB0IExJS0UgPycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb3VudHlfaWQgPyAnQU5EID8gSU4gKGMxLGMyLGMzKScgOiAnJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPUkRFUiBCWSB0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50eV9pZCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnJScgKyBzZWFyY2hzdHJpbmcgKyAnJScsIGNvdW50eV9pZF0gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJyUnICsgc2VhcmNoc3RyaW5nICsgJyUnXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIEdldHMgaW5mb3JtYXRpb24gYWJvdXQgYSBwcm9kdWN0XG4gICAgICAgICAgICAgICAgICAgICAqIEBtZXRob2QgZ2V0UHJvZHVjdFxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IHByb2R1Y3RfaWRcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGdldFByb2R1Y3Q6IGZ1bmN0aW9uKHByb2R1Y3RfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgRElTVElOQ1QgUHJvZHVjdC4qLCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnQgYXMgcnVsZV90LCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSdWxlLnZlciBhcyBydWxlX3ZlciwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS5kIGFzIHJ1bGVfZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFByb2R1Y3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSk9JTiBSdWxlIE9OIFJ1bGUuSUQgPSBQcm9kdWN0LnJpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIElEID0gPycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPUkRFUiBCWSBzbydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcHJvZHVjdF9pZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgKiBHZXRzIGFsbCBwcm9kdWN0cyBmcm9tIGFuIGFyZWFcbiAgICAgICAgICAgICAgICAgICAgICogQG1ldGhvZCBnZXRQcm9kdWN0c0J5QXJlYVxuICAgICAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IGFyZWFfaWRcbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGdldFByb2R1Y3RzQnlBcmVhOiBmdW5jdGlvbihhcmVhX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIERJU1RJTkNUIFByb2R1Y3QuKiwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS50IGFzIHJ1bGVfdCwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS52ZXIgYXMgcnVsZV92ZXIsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1J1bGUuZCBhcyBydWxlX2QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBQcm9kdWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0pPSU4gUnVsZSBPTiBSdWxlLklEID0gUHJvZHVjdC5yaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBhaSA9ID8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnT1JERVIgQlkgc28nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW2FyZWFfaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRDb3VudGllczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIERJU1RJTkNUIENvdW50eS4qJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZST00gQ291bnR5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0pPSU4gQXJlYSBPTiBBcmVhLmMxID0gQ291bnR5LklEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ09SREVSIEJZIENvdW50eS50J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyUHJvZHVjdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCBVc2VyX1Byb2R1Y3QuKiwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS50IGFzIHJ1bGVfdCwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUnVsZS52ZXIgYXMgcnVsZV92ZXIsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1J1bGUuZCBhcyBydWxlX2QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBVc2VyX1Byb2R1Y3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTEVGVCBKT0lOIFByb2R1Y3QgT04gUHJvZHVjdC5JRCA9IFVzZXJfUHJvZHVjdC5waWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTEVGVCBKT0lOIFJ1bGUgT04gUnVsZS5JRCA9IFByb2R1Y3QucmknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldEZpc2hlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUICogRlJPTSBGaXNoJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRGaXNoOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCAqIEZST00gRmlzaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBpZCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIFtpZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldFRlY2huaXF1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCAqIEZST00gVGVjaG5pcXVlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZ2V0VGVjaG5pcXVlOiBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCAqIEZST00gVGVjaG5pcXVlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1dIRVJFIElEID0gPydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldE9yZ2FuaXphdGlvbjogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKiBGUk9NIE9yZ2FuaXphdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBJRCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIFtpZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VySW5mbzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIConLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBVc2VyX0luZm8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdCh1c2VyKVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyTnVtYmVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU0VMRUNUIConLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRlJPTSBVc2VyX051bWJlcidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXJGYXZvcml0ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFTEVDVCAqJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZST00gVXNlcl9GYXZvcml0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdKT0lOIEFyZWEgT04gVXNlcl9GYXZvcml0ZS5hID0gQXJlYS5JRCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoY3JlYXRlT2JqZWN0KGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRmF2b3JpdGU6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24oZnVsZmlsbCwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcmRvdmFTUUxpdGUuZXhlY3V0ZShkYiwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnREVMRVRFIEZST00gVXNlcl9GYXZvcml0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBhID0gPydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhZGRGYXZvcml0ZTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJTlNFUlQgSU5UTyBVc2VyX0Zhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyhhLCBcIm5vdFwiKSBWQUxVRVMgKD8sIDApJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW2lkXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGZpbGwoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZXRGYXZvcml0ZU5vdGlmaWNhdGlvbjogZnVuY3Rpb24oaWQsIG5vdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU1FMaXRlLmV4ZWN1dGUoZGIsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VQREFURSBVc2VyX0Zhdm9yaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NFVCBcIm5vdFwiID0gPyBXSEVSRSBhID0gPydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKSwgW25vdCwgaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0UG9pczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXSEVSRSBvcmdpZCA9ID8nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyksIFtpZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGdldFBvaVR5cGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvaV9UeXBlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXRQb2x5Z29uczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIFBvbHlnb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgb3JnaWQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBnZXROZXdzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIE5ld3MnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxmaWxsKGNyZWF0ZU9iamVjdChkYXRhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBnZXROZXdzSXRlbTogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcShmdW5jdGlvbihmdWxmaWxsLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29yZG92YVNRTGl0ZS5leGVjdXRlKGRiLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTRUxFQ1QgKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdGUk9NIE5ld3MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnV0hFUkUgSUQgPSA/J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpLCBbaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbChjcmVhdGVPYmplY3QoZGF0YSlbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfSk7XG59KSh3aW5kb3cuYW5ndWxhcik7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmZpbHRlcnMnLCBbXSlcbi5maWx0ZXIoJ29uZWJyJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC8oPGJyPlxccyopKy9nLCAnPGJyPicpO1xuICAgIH07XG59KVxuLmZpbHRlcignbm9icnMnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoLyg8YnIoXFxzKlxcLykqPikrL2csICcnKTtcbiAgICB9O1xufSlcbi5maWx0ZXIoJ2NsZWFudGFibGVzJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvKDxcXC8/dGFibGU+KSsvZywgJycpO1xuICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoLyg8XFwvP3RyPikrL2csICcnKTtcbiAgICAgICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC8oPFxcLz90aD4pKy9nLCAnJyk7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvKDwoXFwvPyl0ZC4qPz4pKz8vZywgJzwkMnA+Jyk7XG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvPHA+XFxzKjxcXC9wPi9nLCAnJyk7XG4gICAgICAgIHJldHVybiBpbnB1dDtcbiAgICB9O1xufSk7XG4iLCIoZnVuY3Rpb24oYW5ndWxhciwgdW5kZWZpbmVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2lmaXNrZS51cGRhdGUnLCBbJ2lmaXNrZS5hcGknLCAnaWZpc2tlLmRiJywgJ2lmaXNrZS51dGlscyddKVxuICAgIC5wcm92aWRlcignVXBkYXRlJywgZnVuY3Rpb24gVXBkYXRlUHJvdmlkZXIoKSB7XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gW1xuICAgICAgICAgICAgJ0FQSScsXG4gICAgICAgICAgICAnREInLFxuICAgICAgICAgICAgJ2xvY2FsU3RvcmFnZScsXG4gICAgICAgICAgICAnJHEnLFxuICAgICAgICAgICAgJyRpb25pY0xvYWRpbmcnLFxuICAgICAgICAgICAgJ3Nlc3Npb25EYXRhJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKEFQSSwgREIsIGxvY2FsU3RvcmFnZSwgJHEsICRpb25pY0xvYWRpbmcsIHNlc3Npb25EYXRhKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgTEFTVF9VUERBVEUgPSAnbGFzdF91cGRhdGUnO1xuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ3VzZXJfcHJvZHVjdHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVXNlcl9Qcm9kdWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICd1c2VyX2dldF9mYXZvcml0ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVXNlcl9GYXZvcml0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAndXNlcl9pbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlcl9JbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXJfTnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZjogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVycyA9IGRhdGEubnVtYmVycztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bUFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUFyci5wdXNoKHsnbnVtYmVyJzogbnVtYmVyc1tpXX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5hbGwoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREIucG9wdWxhdGVUYWJsZSgnVXNlcl9JbmZvJywgW2RhdGFdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdVc2VyX0luZm8nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ1VzZXJfTnVtYmVyJywgbnVtQXJyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdVc2VyX051bWJlcnMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB0aW1lZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X2FyZWFzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXNoQXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlzaGVzID0gZGF0YVtrZXldLmZpc2g7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmaXNoS2V5IGluIGZpc2hlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpc2hBcnIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJRCc6IGtleSArICdfJyArIGZpc2hLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZDogZmlzaEtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWlkOiBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogZmlzaGVzW2Zpc2hLZXldWzBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50OiBmaXNoZXNbZmlzaEtleV1bMV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEuYWxsKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ0FyZWEnLCBkYXRhKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCLnBvcHVsYXRlVGFibGUoJ0FyZWFfRmlzaCcsIGZpc2hBcnIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdBcmVhJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9wcm9kdWN0cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGU6ICdQcm9kdWN0J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9jb3VudGllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGU6ICdDb3VudHknXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X211bmljaXBhbGl0aWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ011bmljaXBhbGl0eSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfZmlzaGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ0Zpc2gnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X3J1bGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ1J1bGUnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnZ2V0X3RlY2huaXF1ZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnVGVjaG5pcXVlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9vcmdhbml6YXRpb25zJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ09yZ2FuaXphdGlvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfbWFwX3BvaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnUG9pJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9tYXBfcG9pX3R5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZTogJ1BvaV9UeXBlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9tYXBfcG9seWdvbnMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlOiAnUG9seWdvbidcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgYWx3YXlzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfY29udGVudF9tZW51JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXQoJ05FV1MnLCBkYXRhLnRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERCLnBvcHVsYXRlVGFibGUoJ05ld3MnLCBkYXRhLmNvbnRlbnRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnTmV3cyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfdGVybXNfb2Zfc2VydmljZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9uYW1lOiAndG9zJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogJ2dldF9zbXNfdGVybXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VfbmFtZTogJ3Ntc190ZXJtcydcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfY29udGFjdF9pbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlX25hbWU6ICdjb250YWN0SW5mbydcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6ICdnZXRfbWFwYm94X2FwaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9uYW1lOiAnbWFwYm94X2FwaSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgdGltZWRVcGRhdGUgPSBmdW5jdGlvbihjdXJyZW50VGltZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXN0VXBkYXRlID0gbG9jYWxTdG9yYWdlLmdldChMQVNUX1VQREFURSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFXZWVrID0gMTAwMCAqIDM2MDAgKiAyNCAqIDc7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlKSA+IGFXZWVrO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9wdWxhdGUgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwID0gQVBJW2l0ZW0uZW5kcG9pbnRdKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aGVuO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0uZiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhlbiA9IGl0ZW0uZjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGVuID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEQi5wb3B1bGF0ZVRhYmxlKGl0ZW0udGFibGUsIGRhdGEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRhYmxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE86IHdoYXQgaWYgd2UgbmVlZCB0byByZW1ha2UgdGhlIHRhYmxlcz9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5zdG9yYWdlX25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoZW4gPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5zZXQoaXRlbS5zdG9yYWdlX25hbWUsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC50aGVuKHRoZW4pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTk8gQUNUSU9OIScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBjbGVhblVzZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1cGRhdGVzLmF1dGgubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVwZGF0ZXMuYXV0aFtpXS50YWJsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHVwZGF0ZXMuYXV0aFtpXS50YWJsZS5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLnB1c2goREIuY2xlYW5UYWJsZSh1cGRhdGVzLmF1dGhbaV0udGFibGVbal0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAucHVzaChEQi5jbGVhblRhYmxlKHVwZGF0ZXMuYXV0aFtpXS50YWJsZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5hbGwocClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUmVtb3ZlZCB1c2VyIGluZm8gZnJvbSBkYXRhYmFzZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb3VsZCBub3QgcmVtb3ZlIHVzZXIgZGF0YSBmcm9tIGRhdGFiYXNlIScsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRnVuYyA9IGZ1bmN0aW9uKGZvcmNlZCkge1xuICAgICAgICAgICAgICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKGZ1bGZpbGwsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2hvdWxkVXBkYXRlID0gKGZvcmNlZCB8fCB0aW1lZFVwZGF0ZShjdXJyZW50VGltZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgREIuaW5pdCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnSW5pdGlhbGl6ZWQgREIgc3lzdGVtJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1cGRhdGVzLmFsd2F5cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHBvcHVsYXRlKHVwZGF0ZXMuYWx3YXlzW2ldKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uRGF0YS50b2tlbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdXBkYXRlcy5hdXRoLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHBvcHVsYXRlKHVwZGF0ZXMuYXV0aFtpXSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHVwZGF0ZXMudGltZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2gocG9wdWxhdGUodXBkYXRlcy50aW1lZFtpXSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHEuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uKHN0dWZmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQb3B1bGF0ZWQ6Jywgc3R1ZmYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0KExBU1RfVVBEQVRFLCBjdXJyZW50VGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsZmlsbCgnUGFzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLmVycm9yX2NvZGUgPT09IDcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF1dGhlbnRpY2F0aW9uIGZhaWx1cmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFNob3cgdG8gdXNlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYW5Vc2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBUEkudXNlcl9sb2dvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnYXV0aCBmYWlsdXJlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0dvdCBhbiBlcnJvciwgcmVjcmVhdGUgYWxsIHRhYmxlczonLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERCLmNsZWFuKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHVwZGF0ZUZ1bmMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVGdW5jKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZm9yY2VkVXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVGdW5jKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfbG9nb3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFuVXNlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFQSS51c2VyX2xvZ291dCgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB1c2VyX2xvZ2luOiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBBUEkudXNlcl9sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVGdW5jKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXQoTEFTVF9VUERBVEUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICB9KTtcbn0pKHdpbmRvdy5hbmd1bGFyKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UudXRpbHMnLCBbXSlcblxuLmZhY3RvcnkoJ2xvY2FsU3RvcmFnZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldDogZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgICAgICB9XG4gICAgfTtcbn1dKVxuLnNlcnZpY2UoJ3Nlc3Npb25EYXRhJywgWydsb2NhbFN0b3JhZ2UnLCBmdW5jdGlvbihsb2NhbFN0b3JhZ2UpIHtcbiAgICB0aGlzLnRva2VuID0gbG9jYWxTdG9yYWdlLmdldCgnc2Vzc2lvbicpO1xuXG4gICAgdGhpcy5zZXRUb2tlbiA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldCgnc2Vzc2lvbicsIHQpO1xuICAgICAgICB0aGlzLnRva2VuID0gdDtcbiAgICAgICAgY29uc29sZS5sb2coJ3Rva2VuIHNldCcpO1xuICAgIH07XG4gICAgdGhpcy5kZWxldGVUb2tlbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlKCdzZXNzaW9uJyk7XG4gICAgICAgIHRoaXMudG9rZW4gPSBudWxsO1xuICAgICAgICBjb25zb2xlLmxvZygndG9rZW4gdW5zZXQnKTtcbiAgICB9O1xufV0pXG5cbi5mYWN0b3J5KCdMaWNlbnNlcycsIFtcbiAgICAnJGh0dHAnLFxuICAgIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ3N0YXRpYy9saWNlbnNlcy5qc29uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnbmdDb3Jkb3ZhU21zJywgW10pXG4uZGlyZWN0aXZlKCduZ0NvcmRvdmFTbXMnLCBbJyRjb3Jkb3ZhU21zJywgJyRpb25pY1BvcHVwJywgZnVuY3Rpb24oJGNvcmRvdmFTbXMsICRpb25pY1BvcHVwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzKSB7XG4gICAgICAgICAgICBlbC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICRpb25pY1BvcHVwLnByb21wdCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU2tyaXYgaW4gZGl0dCBuYW1uJyxcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRUeXBlOiAndGV4dCdcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnRklTS0EgJyArIGF0dHJzLm5nQ29yZG92YVNtcyArICcgJyArIG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICRjb3Jkb3ZhU21zLnNlbmQoJzcyNDU2JywgbWVzc2FnZSwgJ0lOVEVOVCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N1Y2N1ZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmRpcmVjdGl2ZXMnKVxuLmRpcmVjdGl2ZSgnaWZpc2tlSW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBuYW1lOiAnQCcsXG4gICAgICAgICAgICBpZDogJ0AnLFxuICAgICAgICAgICAgbGFiZWw6ICdAJyxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnQCcsXG4gICAgICAgICAgICB0eXBlOiAnQCcsXG4gICAgICAgICAgICBuZ1BhdHRlcm46ICdAJyxcbiAgICAgICAgICAgIG5nTW9kZWw6ICc9PydcblxuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2RpcmVjdGl2ZXMvaW5wdXRfZmllbGQvaWZpc2tlX2lucHV0Lmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpIHtcbiAgICAgICAgICAgICRzY29wZS5pZCA9ICRzY29wZS5pZCB8fCAkc2NvcGUubmFtZTtcbiAgICAgICAgICAgICRzY29wZS50eXBlID0gJHNjb3BlLnR5cGUgfHwgJ3RleHQnO1xuICAgICAgICB9XG4gICAgfVxufSlcbiIsImFuZ3VsYXIubW9kdWxlKCdpZmlza2UuZGlyZWN0aXZlcycsIFtdKVxuLmRpcmVjdGl2ZSgnaWZpc2tlTWFwJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZGlyZWN0aXZlcy9tYXAvbWFwLmh0bWwnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgaUVsZW1lbnQsIGlBdHRycywgY3RybCkge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhzY29wZSwgY3RybCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBtYXBEYXRhOiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgbG9jYWxTdG9yYWdlLCBEQiwgJHEpIHtcbiAgICAgICAgICAgIHZhciBtYXBib3hVcmwgPSAnaHR0cDovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3ttYXB0eXBlfS97en0ve3h9L3t5fUAyeC5wbmc/YWNjZXNzX3Rva2VuPXthcGlrZXl9JztcbiAgICAgICAgICAgIHZhciBhcGlrZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0KCdtYXBib3hfYXBpJyk7XG5cbiAgICAgICAgICAgIHZhciBsYyA9IG5ldyBMLmNvbnRyb2wubG9jYXRlKHtcbiAgICAgICAgICAgICAgICBmb2xsb3c6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYm90dG9tcmlnaHQnLFxuICAgICAgICAgICAgICAgIGtlZXBDdXJyZW50Wm9vbUxldmVsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzdG9wRm9sbG93aW5nT25EcmFnOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlbWFpbkFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBvbkxvY2F0aW9uRXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGMuc3RhcnQoKTsgLy90cnkgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkxvY2F0aW9uT3V0c2lkZU1hcEJvdW5kczogZnVuY3Rpb24oY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjb250ZXh0KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxvY2F0ZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgbWF4Wm9vbTogMTRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGljb246ICdpY29uIGlvbi1hbmRyb2lkLWxvY2F0ZSdcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBvdmVybGF5UGFyYW1zID17XG4gICAgICAgICAgICAgICAgc2hvd09uU2VsZWN0b3I6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc2FibGVDbHVzdGVyaW5nQXRab29tOiA5LFxuICAgICAgICAgICAgICAgIGNodW5rZWRMb2FkaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlbW92ZU91dHNpZGVWaXNpYmxlQm91bmRzOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkc2NvcGUsIHtcbiAgICAgICAgICAgICAgICBtYXA6IHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzOiB7fSxcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlbGF5ZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZG9vcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1V0b21odXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAneHl6JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBtYXBib3hVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwdHlwZTogJ21hcGJveC5vdXRkb29ycycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlrZXk6IGFwaWtleVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXRlbGxpdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1NhdGVsbGl0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3h5eicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbWFwYm94VXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllck9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHR5cGU6ICdtYXBib3guc2F0ZWxsaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaWtleTogYXBpa2V5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmxheXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnRmlza2VvbXLDpWRlbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdtYXJrZXJjbHVzdGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXJQYXJhbXM6IG92ZXJsYXlQYXJhbXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1BvaXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbWFya2VyY2x1c3RlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyUGFyYW1zOiBvdmVybGF5UGFyYW1zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhdDogNjIuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxuZzogMTUuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHpvb206IDlcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxjXG4gICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGNyZWF0ZXNjb3BlID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld19zY29wZSA9ICRzY29wZS4kbmV3KCk7XG4gICAgICAgICAgICAgICAgICAgIG5ld19zY29wZS5hcmVhID0gYTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdfc2NvcGU7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBpY29ucztcbiAgICAgICAgICAgIHZhciBjcmVhdGVJY29ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaWNvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxLndoZW4oaWNvbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBEQi5nZXRQb2lUeXBlcygpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHBvaV90eXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9pX3R5cGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBwb2lfdHlwZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnNbdHlwZS5JRF0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25Vcmw6ICdodHRwOi8vd3d3LmlmaXNrZS5zZScgKyB0eXBlLmljb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25BbmNob3I6IFsxNiwgMzddLCAvLyBwb2ludCBvZiB0aGUgaWNvbiB3aGljaCB3aWxsIGNvcnJlc3BvbmQgdG8gbWFya2VyJ3MgbG9jYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXBBbmNob3I6IFswLCAtMzVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBjcmVhdGVNYXJrZXJzID0gZnVuY3Rpb24oYXJlYXMpIHtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYXJlYXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBhcmVhc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5tYXJrZXJzWydhcmVhXycgKyBpXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyOiAnYXJlYXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGF0OiBhLmxhdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxuZzogYS5sbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRNZXNzYWdlU2NvcGU6IGNyZWF0ZXNjb3BlKGEpLCAvL1RPRE86IGRvbnQgY3JlYXRlIG11bHRpcGxlIHNjb3Blc1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJzxhIHVpLXNyZWY9XCJhcHAuYXJlYS5pbmZvKHtpZDogYXJlYS5JRCB9KVwiIG5nLWJpbmQ9XCJhcmVhLnRcIj48L2E+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYXdlc29tZU1hcmtlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogYS5mYXZvcml0ZSA/ICdzdGFyJzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyQ29sb3I6IGEud3NjID8gKGEuZmF2b3JpdGUgPyAnb3JhbmdlJyA6ICdibHVlJykgOiAnbGlnaHRncmF5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6ICdpb24nXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNyZWF0ZVBvaXMgPSBmdW5jdGlvbihwb2lzKSB7XG4gICAgICAgICAgICAgICAgY3JlYXRlSWNvbnMoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2kgPSBwb2lzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFwLm1hcmtlcnNbJ3BvaV8nICsgaV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXI6ICdwb2lzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXQ6IHBvaS5sYSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbmc6IHBvaS5sbyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBpY29uc1twb2kudHlwZV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJzxoND4nICsgcG9pLnQgKyAnPC9oND48cD4nICsgcG9pLmQgKyAnPC9wPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXBPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCAtIDUwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNyZWF0ZVBvbHlnb25zID0gZnVuY3Rpb24ocG9seWdvbnMpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFwLnBhdGhzID0gcG9seWdvbnMubWFwKGZ1bmN0aW9uKHBvbHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhdGxuZ3M6IEpTT04ucGFyc2UoJ1snICsgcG9seS5wb2x5ICsgJ10nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBwb2x5LmMsXG4gICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHBvbHkuYyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdwb2x5Z29uJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNyZWF0ZUFyZWEgPSBmdW5jdGlvbihhcmVhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5tYXJrZXJzLmFyZWEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGxheWVyOiAncG9pcycsXG4gICAgICAgICAgICAgICAgICAgIGxhdDogYXJlYS5sYXQsXG4gICAgICAgICAgICAgICAgICAgIGxuZzogYXJlYS5sbmcsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGFyZWEudFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcC5jZW50ZXIgPSB7XG4gICAgICAgICAgICAgICAgICAgIGxhdDogYXJlYS5sYXQsXG4gICAgICAgICAgICAgICAgICAgIGxuZzogYXJlYS5sbmcsXG4gICAgICAgICAgICAgICAgICAgIHpvb206IE51bWJlcihhcmVhLnpvb20pID8gTnVtYmVyKGFyZWEuem9vbSkgOiA5XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ21hcERhdGEnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuY2VudGVyT25NZSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFwLmNlbnRlci5hdXRvRGlzY292ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihkYXRhLmFyZWFzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZU1hcmtlcnMoZGF0YS5hcmVhcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnBvaXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUG9pcyhkYXRhLnBvaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5wb2x5Z29ucykge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVQb2x5Z29ucyhkYXRhLnBvbHlnb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuYXJlYSkge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVBcmVhKGRhdGEuYXJlYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnc3lzdGVtQnJvd3NlcicsIFtdKVxuLmRpcmVjdGl2ZSgnc3lzdGVtQnJvd3NlcicsIFsnJGNvcmRvdmFJbkFwcEJyb3dzZXInLCBmdW5jdGlvbigkY29yZG92YUluQXBwQnJvd3Nlcikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xuICAgICAgICAgICAgZWwub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICRjb3Jkb3ZhSW5BcHBCcm93c2VyLm9wZW4oZWxbMF0uaHJlZiwgJ19zeXN0ZW0nKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XSlcbi5kaXJlY3RpdmUoJ2dsb2JhbFN5c3RlbUJyb3dzZXInLCBbJyRjb3Jkb3ZhSW5BcHBCcm93c2VyJywgZnVuY3Rpb24oJGNvcmRvdmFJbkFwcEJyb3dzZXIpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMpIHtcbiAgICAgICAgICAgIGVsLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQuaHJlZiAmJiBlLnRhcmdldC5ob3N0ICE9PSB3aW5kb3cubG9jYXRpb24uaG9zdCkge1xuICAgICAgICAgICAgICAgICAgICAkY29yZG92YUluQXBwQnJvd3Nlci5vcGVuKGUudGFyZ2V0LmhyZWYsICdfc3lzdGVtJyk7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnaWZpc2tlLmRpcmVjdGl2ZXMnLCBbXSlcbi5kaXJlY3RpdmUoJ2lvbmljVGFicycsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNjb3BlOiB0cnVlLFxuICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2RpcmVjdGl2ZXMvdGFicy90YWJzLmh0bWwnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2NvcGUpO1xuICAgICAgICB9LFxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUsICRpb25pY0hpc3RvcnksICRzdGF0ZSwgJGlvbmljVmlld1N3aXRjaGVyKSB7XG4gICAgICAgICAgICAvLyAkc2NvcGUgaXMgdGhlIGFwcHJvcHJpYXRlIHNjb3BlIGZvciB0aGUgZGlyZWN0aXZlXG4gICAgICAgICAgICAkc2NvcGUudGFicyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5hZGRDaGlsZCA9IGZ1bmN0aW9uKG5lc3RlZERpcmVjdGl2ZSkge1xuICAgICAgICAgICAgICAgICRzY29wZS50YWJzLnB1c2gobmVzdGVkRGlyZWN0aXZlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkc2NvcGUuZ290byA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgJGlvbmljSGlzdG9yeS52aWV3SGlzdG9yeSgpLmN1cnJlbnRWaWV3ID0gJGlvbmljSGlzdG9yeS52aWV3SGlzdG9yeSgpLmJhY2tWaWV3O1xuICAgICAgICAgICAgICAgICRpb25pY1ZpZXdTd2l0Y2hlci5uZXh0VHJhbnNpdGlvbignbm9uZScpO1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyhzdGF0ZSwgbnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogJ3JlcGxhY2UnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfTtcbn0pXG4uZGlyZWN0aXZlKCdpb25pY1RhYicsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNjb3BlOntcbiAgICAgICAgICAgIGljb246ICdAJyxcbiAgICAgICAgICAgIG5hbWU6ICdAJyxcbiAgICAgICAgICAgIHZpZXdOYW1lOiAnQCdcbiAgICAgICAgfSxcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgcmVxdWlyZTogJ15pb25pY1RhYnMnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbSwgYXR0cnMsIGNvbnRyb2xsZXJJbnN0YW5jZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2NvcGUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2NvcGUuJHBhcmVudC5hcmVhKTtcbiAgICAgICAgICAgIGNvbnRyb2xsZXJJbnN0YW5jZS5hZGRDaGlsZChzY29wZSk7XG4gICAgICAgIH1cbiAgICB9O1xufSk7XG5cbiIsIi8qYW5ndWxhci5tb2R1bGUoJ3RyZWVUYWJzJywgWydpb25pYyddKVxuICAgIC5kaXJlY3RpdmUoJ2lvblRhYnMnLCBbJyRyb290U2NvcGUnLCckc3RhdGUnLCckaW9uaWNIaXN0b3J5JywnJGlvbmljVmlld1N3aXRjaGVyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHN0YXRlLCAkaW9uaWNIaXN0b3J5LCAkaW9uaWNWaWV3U3dpdGNoZXIpIHtcblx0ZnVuY3Rpb24gZ2V0VGFiUm9vdFN0YXRlKHN0YXRlKSB7XG5cdCAgICB2YXIgaXNSb290U3RhdGU7XG5cblx0ICAgIGlmIChzdGF0ZS5wYXJlbnQuc2VsZi5hYnN0cmFjdCkge1xuXHRcdGlzUm9vdFN0YXRlID0gc3RhdGUuc2VsZi5uYW1lO1xuXHQgICAgfSBlbHNlIHtcblx0XHRpc1Jvb3RTdGF0ZSA9IGZhbHNlO1xuXHQgICAgfVxuXG5cdCAgICByZXR1cm4gIGlzUm9vdFN0YXRlIHx8IGdldFRhYlJvb3RTdGF0ZShzdGF0ZS5wYXJlbnQpO1xuXHR9XG5cblx0ZnVuY3Rpb24gaXNUYWJSb290U3RhdGUoc3RhdGUpIHtcblx0ICAgIHJldHVybiBzdGF0ZS5zZWxmLm5hbWUgPT09IGdldFRhYlJvb3RTdGF0ZShzdGF0ZSk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHQgICAgcmVzdHJpY3Q6ICdFQScsXG5cdCAgICByZXF1aXJlOiAnaW9uVGFicycsXG5cdCAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xuXHRcdGNvbnNvbGUubG9nKCdzOiAnLHNjb3BlKTtcblx0XHRjb25zb2xlLmxvZygnZTogJyxlbGVtZW50KTtcblx0XHRjb25zb2xlLmxvZygnYTogJyxhdHRyKTtcblx0XHRjb25zb2xlLmxvZygnYzogJyxjdHJsKTtcblx0XHR2YXIgc2VsZWN0VGFiID0gY3RybC5zZWxlY3Q7XG5cdFx0Y3RybC5zZWxlY3QgPSBmdW5jdGlvbih0YWIsIHNob3VsZEVtaXRFdmVudCkge1xuXHRcdCAgICB2YXIgc2VsZWN0ZWRUYWIgPSBjdHJsLnNlbGVjdGVkVGFiKCk7XG5cblx0XHQgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcblx0XHRcdHNob3VsZEVtaXRFdmVudCA9ICEhKHRhYi5uYXZWaWV3TmFtZSB8fCB0YWIudWlTcmVmKTtcblx0XHQgICAgfVxuXG5cdFx0ICAgIGlmIChzZWxlY3RlZFRhYiAmJiBzZWxlY3RlZFRhYi4kaGlzdG9yeUlkID09IHRhYi4kaGlzdG9yeUlkICYmICFpc1RhYlJvb3RTdGF0ZSgkc3RhdGUuJGN1cnJlbnQpKSB7XG5cdFx0XHRpZiAoc2hvdWxkRW1pdEV2ZW50KSB7XG5cdFx0XHQgICAgJGlvbmljSGlzdG9yeS5uZXh0Vmlld09wdGlvbnMoe1xuXHRcdFx0XHRkaXNhYmxlQmFjazogdHJ1ZSxcblx0XHRcdFx0aGlzdG9yeVJvb3Q6IGZhbHNlXG5cdFx0XHQgICAgfSk7XG5cdFx0XHQgICAgJGlvbmljVmlld1N3aXRjaGVyLm5leHREaXJlY3Rpb24oJ2JhY2snKTtcblx0XHRcdCAgICAkc3RhdGUuZ28oZ2V0VGFiUm9vdFN0YXRlKCRzdGF0ZS4kY3VycmVudCkpO1xuXHRcdFx0fVxuXHRcdCAgICB9IGVsc2UgaWYgKHNlbGVjdGVkVGFiICYmIHNlbGVjdGVkVGFiLiRoaXN0b3J5SWQgPT0gdGFiLiRoaXN0b3J5SWQgJiYgaXNUYWJSb290U3RhdGUoJHN0YXRlLiRjdXJyZW50KSkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdCAgICB9IGVsc2Uge1xuXHRcdFx0c2VsZWN0VGFiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0ICAgIH1cblx0XHR9O1xuXHQgICAgfVxuXHR9O1xuICAgIH1dKTtcbiovXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=